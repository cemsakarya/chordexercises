// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2021 Jean-Francois Moine - LGPL3+
// commit [04093e94c4]
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var x=0;return function(){return x<q.length?{done:!1,value:q[x++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(q,x,F){q!=Array.prototype&&q!=Object.prototype&&(q[x]=F.value)};$jscomp.getGlobal=function(q){q=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,q];for(var x=0;x<q.length;++x){var F=q[x];if(F&&F.Math==Math)return F}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(q,x){this.$jscomp$symbol$id_=q;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:x})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function q(F){if(this instanceof q)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(F||"")+"_"+x++,F)}var x=0;return q}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.iterator;q||(q=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[q]&&$jscomp.defineProperty(Array.prototype,q,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.asyncIterator;q||(q=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(q){$jscomp.initSymbolIterator();q={next:q};q[$jscomp.global.Symbol.iterator]=function(){return this};return q};
$jscomp.iteratorFromArray=function(q,x){$jscomp.initSymbolIterator();q instanceof String&&(q+="");var F=0,u={next:function(){if(F<q.length){var O=F++;return{value:x(O,q[O]),done:!1}}u.next=function(){return{done:!0,value:void 0}};return u.next()}};u[Symbol.iterator]=function(){return u};return u};
$jscomp.polyfill=function(q,x,F,u){if(x){F=$jscomp.global;q=q.split(".");for(u=0;u<q.length-1;u++){var O=q[u];O in F||(F[O]={});F=F[O]}q=q[q.length-1];u=F[q];x=x(u);x!=u&&null!=x&&$jscomp.defineProperty(F,q,{configurable:!0,writable:!0,value:x})}};$jscomp.polyfill("Array.prototype.keys",function(q){return q?q:function(){return $jscomp.iteratorFromArray(this,function(q){return q})}},"es6","es3");if("undefined"==typeof abc2svg)var abc2svg={};
abc2svg.C={BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8,SL_ALI_MSK:112,SL_ALIGN:16,SL_CENTER:32,SL_CLOSE:64};abc2svg.sym_name="bar clef custos  grace key meter Zrest note part rest yspace staves Break tempo  block remark".split(" ");
abc2svg.keys=[new Int8Array([-1,-1,-1,-1,-1,-1,-1]),new Int8Array([-1,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,0]),new Int8Array([0,0,0,1,0,0,0]),new Int8Array([1,0,0,1,0,0,0]),new Int8Array([1,0,0,1,1,0,0]),new Int8Array([1,1,0,1,1,0,0]),new Int8Array([1,1,0,1,1,1,0]),new Int8Array([1,1,1,1,1,1,0]),new Int8Array([1,1,1,1,1,
1,1])];abc2svg.p_b40=new Int8Array([2,8,14,19,25,31,37]);abc2svg.b40_p=new Int8Array([0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6]);abc2svg.b40_a=new Int8Array([-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2]);abc2svg.b40_m=new Int8Array([-2,-1,0,1,2,0,0,1,2,3,4,0,2,3,4,5,6,3,4,5,6,7,0,5,6,7,8,9,0,7,8,9,10,11,0,9,10,11,12,13]);
abc2svg.b40k=new Int8Array([36,1,2,3,8,2,2,7,8,13,14,2,8,13,14,19,20,13,14,19,20,25,2,19,24,25,30,31,2,25,30,31,36,37,2,31,36,37,38,3]);abc2svg.b40sf=new Int8Array([-2,-7,0,7,2,88,0,-5,2,-3,4,88,2,-3,4,-1,6,-3,4,-1,6,1,88,-1,-6,1,-4,3,88,1,-4,3,-2,5,88,3,-2,5,0,7]);abc2svg.isb40=new Int8Array([0,1,6,11,12,17,18,23,28,29,34,35]);abc2svg.ifb40=new Int8Array([0,5,6,11,12,17,22,23,28,29,34,39]);abc2svg.pab40=function(q,x){q+=19;q=40*(q/7|0)+abc2svg.p_b40[q%7];x&&3!=x&&(q+=x);return q};
abc2svg.b40p=function(q){return 7*(q/40|0)+abc2svg.b40_p[q%40]-19};abc2svg.b40a=function(q){return abc2svg.b40_a[q%40]};abc2svg.b40m=function(q){return 12*(q/40|0)+abc2svg.b40_m[q%40]};abc2svg.ch_alias={maj:"",min:"m","-":"m","\u00b0":"dim","+":"aug","+5":"aug",maj7:"M7","\u03947":"M7","\u0394":"M7",min7:"m7","-7":"m7","\u00f87":"m7b5","\u00b07":"dim7","min+7":"m+7",aug7:"+7","7+5":"+7","7#5":"+7",sus:"sus4","7sus":"7sus4"};
abc2svg.rat=function(q,x){for(var F,u,O=0,y=0,Va=1,Q=1;0!=x;)u=x,F=q/x|0,x=q%x,q=u,u=O+F*Va,O=Va,Va=u,u=Q+F*y,Q=y,y=u;return[Va,y]};abc2svg.pitcmp=function(q,x){return q.pit-x.pit};
abc2svg.Abc=function(q){function x(a,c){if(!a)return a;var d=new a.constructor,e;for(e in a)a.hasOwnProperty(e)&&(d[e]=c&&"object"==typeof a[e]?x(a[e],c-1):a[e]);return d}function F(a,c,d,e){var f,g;if(q.errbld){switch(a){case 0:a="warn";break;case 1:a="error";break;default:a="fatal"}q.errbld(a,c,d,e)}else{if(void 0!=e&&0<=e){for(f=g=0;;){var h=t.file.indexOf("\n",f);if(0>h||h>e)break;g++;f=h+1}f=e-f}e="";d&&(e=d,g&&(e+=":"+(g+1)+":"+(f+1)),e+=" ");switch(a){case 0:e+="Warning: ";break;case 1:e+=
"Error: ";break;default:e+="Internal bug: "}q.errmsg(e+c,g,f)}}function u(a,c,d,e,f,g,h){var l;if(a||!r.quiet){if(c){if(c.err)return;c.err=!0}q.textrans&&(l=q.textrans[d])&&(d=l);3<arguments.length&&(d=d.replace(/\$./g,function(a){switch(a){case "$1":return e;case "$2":return f;case "$3":return g;default:return h}}));c&&c.fname?F(a,d,c.fname,c.istart):F(a,d)}}function O(){this.index=0;O.prototype.char=function(){return this.buffer[this.index]};O.prototype.next_char=function(){return this.buffer[++this.index]};
O.prototype.get_int=function(){for(var a=0,c=this.buffer[this.index];"0"<=c&&"9">=c;)a=10*a+Number(c),c=this.next_char();return a}}function y(a,c,d,e,f,g){u(a,{fname:t.fname,istart:t.istart+t.line.index},c,d,e,f,g)}function Va(a){/eval *\(|Function|setTimeout|setInterval/.test(a)?y(1,"Unsecure code"):eval('"use strict";\n'+a)}function Q(a,c,d,e){a=A[a];var f=d/2|0;d=(d+e)/2|0;0>f&&(f=0);d>=Da&&(d=Da-1,f>d&&(f=d));if(c)for(c=a.top[f++];f<=d;)c<a.top[f]&&(c=a.top[f]),f++;else for(c=a.bot[f++];f<=d;)c>
a.bot[f]&&(c=a.bot[f]),f++;return c}function R(a,c,d,e,f){a=A[a];var g=d/2|0;d=(d+e)/2|0;0>g&&(g=0);d>=Da&&(d=Da-1,g>d&&(g=d));if(c)for(;g<=d;)a.top[g]<f&&(a.top[g]=f),g++;else for(;g<=d;)a.bot[g]>f&&(a.bot[g]=f),g++}function id(a,c){switch(c&7){case m.SL_ABOVE:return 1;case m.SL_BELOW:return 0}return a.multi?0<a.multi:1}function fc(a,c){switch(c&7){case m.SL_ABOVE:return!0;case m.SL_BELOW:return!1}return a.multi?0<a.multi:a.p_v.have_ly?(a.pos.voc&7)!=m.SL_ABOVE:!1}function jd(a){if(!a.ldst){var c,
d=a.s;var e=a.start;var f=e.s;var g=f.x+3;e=e.ix;0<e&&(c=ia[e-1]);a.st=d.st;a.lden=!1;a.has_val=!0;if(e=fc(d,d.pos.dyn))a.up=!0;if(c&&c.s==f&&(a.up&&!c.up||!a.up&&c.up)){var h=c.dd;Fb[h.func]&&(c=c.x+c.val+4,c>g&&(g=c))}a.defl.noen?(f=a.x-g,20>f&&(g=a.x-20-3,f=20)):(c=d.x,(d=ia[a.ix+1])&&d.s==f&&(a.up&&!d.up||!a.up&&d.up)&&(h=d.dd,Fb[h.func]&&(c-=5)),f=c-g-4,20>f&&(g-=.5*(20-f),f=20));a.val=f;a.x=g;a.y=Q(a.st,e,g,f);e||(g=a.dd,a.y-=g.h)}}function kd(a){if(!a.ldst){var c=a.dd,d=a.prev,e=a.s,f=e.st,
g=a.start.s,h=g.x;d&&(h=d.s.x+a.dd.wl+2,d.val-=d.dd.wr,8>d.val&&(d.val=8));a.st=f;if(4!=c.func)switch(c.glyph){case "8va":case "15ma":var l=1;break;default:l=6==c.func?fc(g,a.pos):id(g,a.pos)}if(a.defl.noen){var k=a.x-h;20>k&&(h=a.x-20-3,k=20)}else k=e.x-h-6,e.type==m.NOTE&&(k-=6),10>k&&(h-=10-k,k=10);var p=Q(f,l,h-c.wl-5,k);if(l){var C=A[g.st].topbar+2;p<C&&(p=C)}else C=A[g.st].botbar-2,p>C&&(p=C),p-=c.h;if(d)if(l)p<d.y&&(p=d.y);else if(p>=d.y)p=d.y;else{do d.y=p,d=d.prev;while(d)}a.lden=!1;a.has_val=
!0;a.val=k;a.x=h;a.y=p;l&&(p+=c.h);R(f,l,h,k,p);l?g.ymx=e.ymx=p:g.ymn=e.ymn=p}}function Dc(a){if(!a.ldst)if(a.start)kd(a);else{var c=a.s,d=a.dd,e=a.x,f=d.wl+d.wr,g=A[c.st].topbar+2+d.hd,h=A[c.st].botbar-2-d.h;switch(d.glyph){case "brth":case "lphr":case "mphr":case "sphr":var l=g+1;"brth"==d.glyph&&l<c.ymx&&(l=c.ymx);for(c=c.ts_next;c&&!c.seqst;c=c.ts_next);e+=.45*((c?c.x:ua)-e);a.x=e;a.y=l;return}c.nhd&&(e+=c.notes[0<=c.stem?0:c.nhd].shhd);var k=4==d.func?0:6==d.func?fc(c,a.pos):id(c,a.pos);0==d.name.indexOf("invert")&&
(a.inv=1);if(d.ty)switch(d.ty[0]){case "@":l=d.ty.slice(1).split(",");e+=Number(l[0]);l=Number(l[1]);break;case "<":case ">":l=a.y}if(void 0==l)if(k&&"invertedfermata"!=d.name)l=Q(c.st,!0,e-d.wl,f)+d.hd,l<g&&(l=g),a.y>l&&(l=a.y),c.ymx=l+d.h;else{l=Q(c.st,!1,e-d.wl,f)-d.h;l>h&&(l=h);a.y<l&&(l=a.y);if("fermata"==d.name||"accent"==d.glyph||"roll"==d.glyph)a.inv=1;c.ymn=l-d.hd}l>g?R(c.st,1,e-d.wl,f,l+d.h):l<h&&R(c.st,0,e-d.wl,f,l-d.hd);a.x=e;a.y=l}}function gc(a){var c,d=Ec[a];if(d)if(c=d.match(/(\d+)\s+(.+?)\s+([0-9.,]+)\s+([0-9.]+)\s+([0-9.]+)/)){var e=
Number(c[1]),f=c[3],g=parseFloat(c[4]),h=parseFloat(c[5]);if(isNaN(e))u(1,null,"%%deco: bad C function value '$1'",c[1]);else if(10<e&&(32>e||44<e))u(1,null,"%%deco: bad C function index '$1'",e);else{5==e&&(e=3);7==e&&(e=6);if(0<f.indexOf(",")){f=f.split(",");var l=f[1];f=f[0]}else l=0;if(50<f||80<g||80<h)u(1,null,"%%deco: abnormal h/wl/wr value '$1'",d);else{var k=qb[a];k||(k={name:a},qb[a]=k);k.func=0==a.indexOf("head-")?9:e;k.glyph=c[2];k.h=Number(f);k.hd=Number(l);k.wl=g;k.wr=h;if(c=d.replace(c[0],
"").trim()){'"'==c[0]&&(c=c.slice(1,-1));if("@"==c[0]&&!c.match(/^@([0-9.-]+),([0-9.-]+);?/)){u(1,null,"%%deco: bad position '$1'",c);return}k.str=c}6==k.func&&void 0==k.str&&(k.str=a);c=a.slice(-1);if("("==c||")"==c&&0>a.indexOf("("))if(k.str=null,l=a.slice(0,-1)+("("==c?")":"("),a=qb[l])"("==c?(k.dd_en=a,a.dd_st=k):(k.dd_st=a,a.dd_en=k);else if(a=gc(l),!a)return;return k}}}else u(1,null,"Invalid decoration '$1'",a);else r.decoerr&&u(1,null,"Unknown decoration '$1'",a)}function ld(a,c,d){var e=Gb[a],
f=a.slice(0,-1)+("("==a.slice(-1)?")":"(");e?u(1,c,"Conflict on !$1!",a):(d.s=c,(e=Gb[f])?(")"==a.slice(-1)&&(e=d,d=Gb[f]),Gb[f]=null,d.tie_ty=m.SL_AUTO,d.tie_n=e,d.s.tie_s=e.s):Gb[a]=d)}function Hb(a,c,d){var e,f,g=a.length;for(e=0;e<g;e++){var h=a[e];if(0<="<>^_@".indexOf(h[0])&&!/^(\^|>|<\(|<\)|>\(|>\))$/.test(h)){var l=h[0];if("@"==l){l=h.match(/@[-\d]+,[-\d]+/);if(!l){u(1,c,"Bad position in !$1!",h);continue}l=l[0]}h=h.replace(l,"")}var k=qb[h];if(!k&&(k=gc(h),!k))continue;l&&(k=Object.create(k),
k.ty=l,l=0);switch(k.func){case 0:if(c.type==m.BAR&&"dot"==h){c.bar_dotted=!0;break}case 1:case 2:if(!c.notes){u(1,c,J.must_note_rest,h);continue}break;case 8:if(c.type!=m.NOTE){u(1,c,J.must_note,h);continue}h=c.notes[c.nhd];h.a_dd||(h.a_dd=[]);h.a_dd.push(k);continue;case 9:if(!c.notes){u(1,c,J.must_note_rest,h);continue}for(f=0;f<=c.nhd;f++)h=c.notes[f],h.invis=!0,h.a_dd||(h.a_dd=[]),h.a_dd.push(k);continue;case 10:if(c.notes)for(f=0;f<=c.nhd;f++)c.notes[f].color=h;else c.color=h;break;case 32:c.invis=
!0;break;case 33:if(c.type!=m.BAR){u(1,c,"!beamon! must be on a bar");continue}c.beam_on=!0;break;case 34:if(c.type!=m.NOTE||!d||d.type!=m.NOTE||c.dur!=d.dur){u(1,c,"!$1! must be on the last of a couple of notes",h);continue}c.trem2=!0;c.beam_end=!0;c.beam_st=!1;d.beam_st=!0;d.beam_end=!1;c.ntrem=d.ntrem=Number(h[4]);for(f=0;f<=c.nhd;f++)c.notes[f].dur*=2;for(f=0;f<=d.nhd;f++)d.notes[f].dur*=2;break;case 35:if(c.type!=m.NOTE){u(1,c,J.must_note,h);continue}c.xstem=!0;break;case 36:if(c.type!=m.NOTE){u(1,
c,J.must_note,h);continue}"1"==h[6]?c.beam_br1=!0:c.beam_br2=!0;break;case 37:c.rbstop=1;break;case 38:if(c.type!=m.NOTE){u(1,c,J.must_note,h);continue}c.trem1=!0;c.ntrem=h.length;break;case 39:if(c.type!=m.NOTE){u(1,c,J.must_note,h);continue}c.feathered_beam="a"==h[5]?1:-1;break;case 40:c.stemless=!0;break;case 41:c.rbstop=2;break;case 42:if(!c.notes[0].acc)continue;h="sacc"+c.notes[0].acc.toString();k=qb[h];if(!k&&(k=gc(h),!k)){u(1,c,J.bad_val,"!editorial!");continue}delete c.notes[0].acc;n.acc[c.notes[0].pit+
19]=0;break;case 43:f=n.acc[c.notes[0].pit+19];if(c.notes[0].acc||!f)continue;c.notes[0].a_dcn||(c.notes[0].a_dcn=[]);c.notes[0].a_dcn.push("cacc"+f);break;case 44:ld(h,c,c.notes[0]);continue}c.a_dd||(c.a_dd=[]);c.a_dd.push(k)}}function Fc(a){var c,d=0,e=a.a_dd,f=e.length;for(c=0;c<f;c++){var g=e[c];switch(g.func){case 1:7>d&&(d=7);break;case 2:14>d&&(d=14);break;case 3:switch(g.glyph){case "brth":case "lphr":case "mphr":case "sphr":20>a.wr&&(a.wr=20)}default:switch(g.ty){case "<":g=g.wl+g.wr+6;d<
g&&(d=g);break;case ">":g=g.wl+g.wr+8,a.wr<g&&(a.wr=g)}}}d&&a.prev&&a.prev.type==m.BAR&&(d-=3);return d}function Ne(){function a(a){var c=a.x-a.wl,d=ia.length;for(a=0;a<d;a++){var e=ia[a];e.ix=a;e.s.x=e.x=c;e.defl.nost=!0}}function c(a){if(a.a_dd){var c,d=a.a_dd.length;void 0==a.y&&(a.y=0);for(c=0;c<d;c++){var e=a.a_dd[c];var f=a.x;var p=a.y;switch(e.func){default:if(10<=e.func)continue;var C=0;break;case 3:case 4:C=a.pos.orn;break;case 6:C=a.pos.vol;break;case 7:C=a.pos.dyn}switch(e.ty){case "^":C=
C&-8|m.SL_ABOVE;break;case "_":C=C&-8|m.SL_BELOW;break;case "<":case ">":C=C&7|m.SL_CLOSE;"<"==e.ty?(f-=e.wr+8,a.notes[0].acc&&(f-=5.5)):f+=e.wl+8;p=3*(a.notes[0].pit-18)-(e.h-e.hd)/2;break;default:if(e.ty&&"@"==e.ty[0]){var n=e.ty.slice(1).split(",");f+=Number(n[0]);p+=Number(n[1])}}if((C&7)!=m.SL_HIDDEN&&(C={s:a,dd:e,st:a.st,ix:ia.length,defl:{},x:f,y:p,pos:C},a.type!=m.BAR||e.ty||(C.x-=a.wl/2-2),ia.push(C),e.dd_en?C.ldst=!0:e.dd_st&&(C.lden=!0,C.defl.nost=!0),md[e.func]))md[e.func](C)}}if(a.notes)for(e=
0;e<a.notes.length;e++)if(a.notes[e].a_dd){p=a;n=e;var z=p.notes[n],v=z.a_dd.length,E=p.x;for(C=0;C<v;C++)d=z.a_dd[C],f={s:p,dd:d,st:p.st,m:n,ix:0,defl:{},x:E,y:3*(z.pit-18)},d.ty&&("@"==d.ty[0]?(c=d.ty.slice(1).split(","),f.x+=Number(c[0]),f.y+=Number(c[1])):(f.y-=(d.h-d.hd)/2,"<"==d.ty?f.x-=d.wr+8:">"==d.ty&&(f.x+=d.wr+8))),ia.push(f),d.dd_en?f.ldst=!0:d.dd_st&&(f.lden=!0,f.defl.nost=!0)}}var d,e;for(d=N;d;d=d.ts_next){switch(d.type){case m.CLEF:case m.KEY:case m.METER:continue}break}for(ia.length&&
a(d);d;d=d.ts_next){switch(d.type){case m.BAR:case m.MREST:case m.NOTE:case m.REST:case m.SPACE:break;case m.GRACE:for(e=d.extra;e;e=e.next)c(e);break;default:continue}c(d)}(function(){var a,c,d=ia.length;for(a=0;a<d;a++){var e=ia[a];if(e.ldst){var k=e.dd;var p=k.dd_en;var C=e.s;var n=C.v;for(c=a+1;c<d;c++){var z=ia[c];if(!z.start&&z.dd==p&&z.s.v==n)break}if(c==d)for(n=C.st,c=a+1;c<d&&(z=ia[c],z.start||z.dd!=p||z.s.st!=n);c++);c==d&&(z={s:C,st:e.st,dd:p,ix:ia.length-1,x:ua-6,y:C.y,cont:!0,lden:!0,
defl:{noen:!0}},z.x<C.x+10&&(z.x=C.x+10),void 0!=e.m&&(z.m=e.m),ia.push(z));z.start=e;z.defl.nost=e.defl.nost;0<a&&ia[a-1].s.time==e.s.time&&ia[a-1].dd.name.slice(0,k.name.length-1)==k.name.slice(0,k.name.length-1)&&(z.prev=ia[a-1])}}for(a=0;a<d;a++)if(z=ia[a],z.lden&&!z.start){C=z.s;a:{for(c=C;c.prev;)if(c=c.prev,c.rbstart)break a;for(c=c.p_v.sym;c.type!=m.CLEF;)c=c.ts_prev;c.next&&c.next.type==m.KEY&&(c=c.next);c=c.next&&c.next.type==m.METER?c.next:c}e={s:c,st:z.st,dd:z.dd.dd_st,ix:ia.length-1,
y:C.y,ldst:!0};e.x=e.s.x;void 0!=z.m&&(e.m=z.m);ia.push(e);z.start=e}})()}function Oe(){var a,c=ia.length;for(a=0;a<c;a++){var d=ia[a];var e=d.dd;e=e.func;if(nd[e]&&void 0==d.m)nd[e](d)}}function Pe(){var a,c,d=Array(U+1),e=ia.length;for(a=0;a<=U;a++)d[a]={ymin:0,ymax:0};for(a=0;a<e;a++){var f=ia[a];(c=f.dd)&&Fb[c.func]&&void 0==f.m&&(Fb[c.func](f),!c.dd_en&&((f.pos&m.SL_ALI_MSK)==m.SL_ALIGN||0==(f.pos&m.SL_ALI_MSK)&&0<f.s.fmt.dynalign)&&(f.up?f.y>d[f.st].ymax&&(d[f.st].ymax=f.y):f.y<d[f.st].ymin&&
(d[f.st].ymin=f.y)))}for(a=0;a<e;a++)if(f=ia[a],(c=f.dd)&&!c.dd_en&&Fb[c.func]){if((f.pos&m.SL_ALI_MSK)==m.SL_ALIGN||0==(f.pos&m.SL_ALI_MSK)&&0<f.s.fmt.dynalign){var g=f.up?d[f.st].ymax:d[f.st].ymin;f.y=g}else g=f.y;f.up&&(g+=c.h);R(f.st,f.up,f.x,f.val,g)}Qe();for(g=0;g<D.length;g++)if(a=D[g],!a.second&&a.sym){e=void 0;d=a;a=A[d.st].topbar+25;for(c=d.sym;c;c=c.next)if(c.type==m.BAR&&c.rbstart&&!c.norepbra){if(!c.next)break;e||(e=c,V("repeat"));for(f=c;c.next&&(c=c.next,!c.rbstop););var h=Q(d.st,!0,
f.x,c.x-f.x);a<h&&(a=h);f.text&&(h=sa(f.text),h=Q(d.st,!0,f.x+4,h[0])+h[1],a<h&&(a=h));c.rbstart&&(c=c.prev)}if(c=e)for(za(d.st,!0),h=a*A[d.st].staffscale;c;c=c.next)if(c.rbstart&&!c.norepbra){for(f=c;c.next&&(c=c.next,!c.rbstop););if(f==c)break;var l=f.x;0<r.measurenb&c.bar_num&&c.bar_num%r.measurenb&&(l+=6);e=c.type!=m.BAR?c.rbstop?0:c.x-ua+4:1<c.bar_type.length&&"[]"!=c.bar_type||"]"==c.bar_type?0<f.st&&!(L.staves[f.st-1].flags&64)?c.wl:":"==c.bar_type.slice(-1)?12:":"!=c.bar_type[0]?0:8:c.rbstop?
0:8;e=c.x-l-e;c.next||c.rbstop||d.bar_start||(d.bar_start=x(c),d.bar_start.type=m.BAR,d.bar_start.bar_type="",delete d.bar_start.text,d.bar_start.rbstart=1,delete d.bar_start.a_gch);f.text&&na(l+4,h-H.curfont.size-3,f.text);Ib(l,h);2==f.rbstart&&(G+="m0 20v-20");G+="h"+e.toFixed(1);2==c.rbstop&&(G+="v20");G+='"/>\n';R(f.st,!0,l,e,a+2);c.rbstart&&(c=c.prev)}}}function Re(){var a;var c=L;for(a=0;a<=U&&!c.st_print[a];a++);if(!(a>U)){za(a);if(1!=A[a].staffscale){var d=Ga("measure").size;rb("measurefont",
"* "+(d/A[a].staffscale).toString())}V("measure");var e=Rb("0");var f=N;var g=H.nbar;if(1<g)if(0==r.measurenb){var h=!0;var l=Q(a,!0,0,20);l<A[a].topbar+14&&(l=A[a].topbar+14);na(0,l,g.toString());R(a,!0,0,20,l+H.curfont.size+2)}else if(0==g%r.measurenb){for(;;f=f.ts_next){switch(f.type){case m.CLEF:case m.KEY:case m.METER:case m.STBRK:continue}break}if(f.type!=m.BAR||!f.bar_num){f.prev&&(f=f.prev);h=!0;var k=e;10<=g&&(k*=100<=g?3:2);H.curfont.pad&&(k+=2*H.curfont.pad);c=f.x+f.wr+1;l=Q(a,!0,c,k);
l<A[a].topbar+6&&(l=A[a].topbar+6);l+=2+H.curfont.pad;na(c,l,g.toString());l+=H.curfont.size+H.curfont.pad;R(a,!0,c,k,l)}}for(;f;f=f.ts_next){switch(f.type){case m.STAVES:c=f.sy;for(a=0;a<U&&!c.st_print[a];a++);za(a);continue;default:continue;case m.BAR:if(!f.bar_num||1>=f.bar_num)continue}g=f.bar_num;0!=r.measurenb&&0==g%r.measurenb&&f.next&&!f.bar_mrep&&(h||(h=!0),k=e,10<=g&&(k*=100<=g?3:2),H.curfont.pad&&(k+=2*H.curfont.pad),c=f.x-k*(f.text?.6:.4),l=Q(a,!0,c,k),l<A[a].topbar+3&&(l=A[a].topbar+
3),f.next.type==m.NOTE&&(0<f.next.stem?l<f.next.ys-H.curfont.size&&(l=f.next.ys-H.curfont.size):l<f.next.y&&(l=f.next.y)),l+=2+H.curfont.pad,na(c,l,g.toString()),l+=H.curfont.size+H.curfont.pad,R(a,!0,c,k,l))}H.nbar=g;d&&rb("measurefont","* "+d.toString())}}function Se(a,c,d,e){function f(a){return 6*Math.round((a+12)/6)-12-a}var g=a?3.5:5;a=a?1.8:3.2;if(0<c){c=e-(d-1)*g-a;if(26<c)return 0;d=e}else{d=e+(d-1)*g+a;if(-2>d)return 0;c=e}e=f(d-.25);c=f(c+.25);return e*e>c*c?c:e}function od(a){var c;a=
x(a);a.invis=!0;delete a.extra;delete a.text;delete a.a_gch;delete a.a_ly;delete a.a_dd;delete a.tp;a.notes=x(a.notes);for(c=0;c<=a.nhd;c++){var d=a.notes[c]=x(a.notes[c]);delete d.a_dcn}return a}function pd(a){function c(a,c,d,e,f,g){var h=f.s1,k=h.nflags;h.ntrem&&(k-=h.ntrem);h.trem2&&g>k&&(h.dur>=m.BLEN/2?(a=h.x+6,c=f.s2.x-6):h.dur<m.BLEN/4&&(a+=5,c-=6));d=f.a*a+f.b-d;c=(c-a)/I.scale;f=f.a*c;Ib(a,d,!0);G+="l"+c.toFixed(1)+" "+(-f).toFixed(1)+"v"+e.toFixed(1)+"l"+(-c).toFixed(1)+" "+f.toFixed(1)+
'z"/>\n'}var d,e,f,g,h=a.s1,l=a.s2;ta(h,"beam");if(h.grace){var k=3.5;var p=3.2;var C=.29;var n=1.8}else k=5,p=8,C=.34,n=3.2;var z=h.stem;h.stem!=l.stem&&h.nflags<l.nflags&&(z=l.stem);0>z&&(n=-n);c(h.xs-C,l.xs+C,0,n,a,1);var v=0;for(d=h;d.type==m.NOTE&&d.stem!=z&&(d.ys=a.a*d.xs+a.b-A[d.st].y+k*(d.nflags-1)*d.stem-n),d!=l;d=d.next);h.feathered_beam&&(v=k/(l.xs-h.xs),0<h.feathered_beam?(v=-v,k=v*h.xs):k=v*l.xs,v*=z);C=0;for(e=2;e<=a.nflags;e++)for(C+=k,0!=v&&(a.a+=v),d=h;;d=d.next){if(!(d.type!=m.NOTE||
d.nflags<e))if(d.trem1&&e>d.nflags-d.ntrem){var E=d.dur>=m.BLEN/2?d.x:d.xs;c(E-5,E+5,(C+2.5)*z,n,a,e)}else{for(f=d;d!=l;){var t=d.next;if(t.type==m.NOTE||t.type==m.REST)if(t.trem1){if(t.nflags-t.ntrem<e)break}else if(t.nflags<e)break;if(t.beam_br1||t.beam_br2&&2<e)break;d=t}for(g=d;g.type!=m.NOTE;)g=g.prev;E=f.xs;if(f==g)if(f==h)E+=p;else if(f==l)E-=p;else if(f.beam_br1||f.beam_br2&&2<e)E+=p;else{for(t=f.next;t.type!=m.NOTE;)t=t.next;if(t.beam_br1||t.beam_br2&&2<e)E-=p;else{for(f=f.prev;f.type!=m.NOTE;)f=
f.prev;E=f.nflags<t.nflags||f.nflags==t.nflags&&f.dots<t.dots?E+p:E-p}}c(E,g.xs,C*z,n,a,e)}if(d==l)break}h.tmp?sb(h):l.tmp&&sb(l);Wa(h,"beam")}function qd(a){function c(a,c,d){for(var e,f;!L.st_print[c];){if(L.staves[c].flags&d)return;c++}for(e=f=c;;){L.st_print[e]&&(f=e);if(L.staves[e].flags&d)break;e++}c=A[c].y+A[c].topbar*A[c].staffscale;f=A[f].y+A[f].botbar*A[f].staffscale;d&514?(a+=Vb-6,d=aa-f,c=(c-f)/24,G+='<text transform="translate('+a.toFixed(1)+","+d.toFixed(1)+") scale(2.5,"+c.toFixed(2)+
')">'+Gc.brace.c+"</text>\n"):(a+=Vb-5,d=aa-c-3,c=c-f+2,G+='<path d="m'+a.toFixed(1)+" "+d.toFixed(1)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+c.toFixed(1)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}var d,e,f=L.nstaff;for(d=e=0;;d++){var g=L.staves[d].flags;g&5&&e++;if(L.st_print[d])break;g&10&&e--;if(d==f)break}for(g=f;g>d&&!L.st_print[g];g--);if(d!=g||0!=e)for(e=A[g].y+A[g].botbar*A[g].staffscale,d=A[d].y+A[d].topbar*A[d].staffscale-e,Ib(a,e),G+="v"+(-d).toFixed(1)+
'"/>\n',d=0;d<=f;d++)g=L.staves[d].flags,g&1&&c(a,d,2),g&4&&c(a,d,8),g&256&&c(a-6,d,512),g&1024&&c(a-6,d,2048)}function rd(a){if(a.a_meter){var c=A[a.st];var d=c.y;"|||||"!=c.stafflines&&(d+=(c.topbar+c.botbar)/2-12);for(c=0;c<a.a_meter.length;c++){var e=a.a_meter[c];var f=a.x+a.x_meter[c];e.bot?Y('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',f,d+6,hc(e.top),hc(e.bot)):Y('<text x="X" y="Y" text-anchor="middle">A</text>\n',f,d+12,hc(e.top))}}}
function Hc(a,c,d){if("object"==typeof d){var e=d[0],f=d[1];var g=e+"_"+f;d=sd[g];d||(d=abc2svg.rat(Math.abs(e),f),f=d[1],d=(0>e?-d[0]:d[0]).toString(),1!=f&&(d+="_"+f),sd[g]=d)}ca(a,c,"acc"+d)}function Nb(a,c,d,e,f){var g;0<=c?(g=a.hlu[c])||(g=a.hlu[c]=[]):(g=a.hld[-c])||(g=a.hld[-c]=[]);for(a=0;a<g.length&&!(d>=g[a][0]);a++);a==g.length?g.push([d,e,f]):d>g[a][0]?g.splice(++a,0,[d,e,f]):(e<g[a][1]&&(g[a][1]=e),f>g[a][2]&&(g[a][2]=f))}function td(a,c,d){c-=3;10>d?ca(a-4,c,"mtr"+d):(ca(a-10,c,"mtr"+
(d/10|0)),ca(a-2,c,"mtr"+d%10))}function Te(a){var c,d,e=a;for(c=a.extra;c.next;)c=c.next;var f=c;if(d=(0<=c.stem||0>a.multi)&&28>=c.notes[0].pit||16>c.notes[0].pit){var g=127;for(c=a.extra;c;c=c.next)c.y<g&&(g=c.y,f=c);c=f.x;g=f.y-5;a.extra!=f&&(c-=4,g+=1);a=a.next;var h=a.x-1;0>a.stem&&-2<a.nflags&&(h-=4);var l=3*(a.notes[0].pit-18)-5;var k=.4*(h-c);3<k&&(k=3);var m=k;var C=.2;var n=.8;g>l+7?(c=f.x-1,g+=.5,l+=6.5,h=a.x-5.5,k=.8*(g-l),m=.2*(g-l),C=0):l>g+4&&(l=g+4,c=f.x+2,g=f.y-4)}else{g=-127;for(c=
a.extra;c;c=c.next)c.y>g&&(g=c.y,f=c);c=f.x;g=f.y+5;a.extra!=f&&(c-=4,--g);a=a.next;h=a.x-1;0<=a.stem&&-2<a.nflags&&(h-=2);l=3*(a.notes[a.nhd].pit-18)+5;k=.4*(c-h);-3>k&&(k=-3);m=k;C=.2;n=.8;g<l-7?(c=f.x-1,g-=.5,l-=6.5,h=a.x-5.5,k=.8*(g-l),m=.2*(g-l),C=0):l<g-4&&(l=g-4,c=f.x+2,g=f.y+4)}e.slur={x0:c,y0:g,x1:C*h+(1-C)*c-c,y1:g-C*l-(1-C)*g+k,x2:n*h+(1-n)*c-c,y2:g-n*l-(1-n)*g+m,x3:h-c,y3:g-l};g-=e.slur.y1;c=e.extra;d?g<c.ymn&&(c.ymn=g):g>c.ymx&&(c.ymx=g)}function ic(a,c){var d,e=Array(a.nhd+1);var f=
a.notes[0>a.stem?a.nhd:0];var g=a.x+f.shhd*I.scale;var h=A[a.st].y+3*(f.pit-18);f=A[a.st].y;if(a.dots){for(d=0;d<=a.nhd;d++){var l=3*(a.notes[d].pit-18);0==l%6&&(l=a.dot_low?l-3:l+3);e[d]=l}for(d=0;d<a.nhd;d++)if(!(e[d+1]>e[d])){for(l=d;0<l&&!(e[l]>e[l-1]+6);)l--;if(3*(a.notes[l].pit-18)-e[l]<e[d+1]-3*(a.notes[d+1].pit-18))for(;l<=d;)e[l++]-=6;else e[d+1]=e[d]+6}}X.draw_hl(a);a.stemless?a.xstem&&(l=a.ts_prev,d=(0<l.stem?l.y:l.ys)-a.y,d+=A[l.st].y-f,Ic(g,h,d)):(d=a.ys-a.y,l=a.nflags,a.ntrem&&(l-=a.ntrem),
!c||0>=l?(0<a.nflags&&(d=0<=a.stem?d-1:d+1),Ic(g,h,d,a.grace)):Ic(g,h,d,a.grace,l,a.fmt.straightflags));if(c&&a.trem1){c=a.ntrem||0;d=3*(a.notes[0<a.stem?a.nhd:0].pit-18);a.head==m.FULL||a.head==m.EMPTY?(g+=(a.grace?2.3:3.5)*a.stem,d=0<a.stem?d+(6+5.4*c):d-11.4):d=0<a.stem?d+(5+5.4*c):d-10.4;d/=a.p_v.scale;for(Y('<path d="mX Y\n\t',g-4.5,f+d);;){G+="l9 -3v3l-9 3z";if(0>=--c)break;G+="m0 5.4"}G+='"/>\n'}for(f=0;f<=a.nhd;f++){var k=void 0,p=void 0;g=a;var C=f;var n=e;c=!1;h=g.notes[C];d=A[g.st].y;l=
g.x;var z=3*(h.pit-18),v=l+h.shhd*I.scale,E=z+d,t=jc(g,h.dur);var r=t[0];var q=t[1];t=t[2];if(!h.invis)if(g.grace)p="ghd",v-=4.5*I.scale;else if(h.map&&h.map[0])r=g.head,(p=h.map[0][r])||(p=h.map[0][h.map[0].length-1]),r=p.indexOf("/"),0<=r&&(p=0<=g.stem?p.slice(0,r):p.slice(r+1));else if(g.type==m.CUSTOS)p="custos";else switch(r){case m.OVAL:p="HD";break;case m.OVALBARS:if(g.head!=m.SQUARE){p="HDD";break}case m.SQUARE:-4<t?p="breve":(p="longa",k=0<g.stem);Sa||!g.next||g.next.type!=m.BAR||g.next.next||
(q=0);v+=1;break;case m.EMPTY:p="Hd";break;default:p="hd"}void 0!=h.color&&(c=Ha(h.color));p&&(k&&(Jb(v,E,0,1,-1),v=E=0),X.psxygl(v,E,p)||ca(v,E,p),k&&Ob());if(q)for(k=l+(7.7+g.xmx)*I.scale,void 0==n[C]&&(n[C]=3*(g.notes[C].pit-18),0==(g.notes[C].pit&1)&&(n[C]+=3)),C=n[C]+d,r=h.dur/12>>5-t-q;0<q--;)ca(k,C,r&1<<q?"dot":"dot+"),k+=3.5;h.acc&&(l-=h.shac*I.scale,g.grace?(Jb(l,z+d,0,.75),Hc(0,0,h.acc),Ob()):Hc(l,z+d,h.acc));0!=c&&Ha(c)}}function Ue(a,c){var d;if(a.grace&&0<a.stem)return-1;var e=a.multi?
a.multi:c.multi?c.multi:0;if(e)return e;for(;;a=a.next){if(a.type==m.NOTE){if(!a.stemless){if(0>a.stem)return 1;var f=!0}22>a.notes[0].pit&&(d=!0)}if(a.time==c.time)break}return f||d?-1:1}function ud(a,c,d,e,f,g,h){var l=.3;var k=e-c;0>k&&(k=-k);var m=d-a;40<m&&.7>k/m&&(l=.3+.002*(m-40),.7<l&&(l=.7));var C=.5*(a+d);k=.5*(c+e);var n=a+.45*(C+l*(a-C)-a);var z=c+.45*(k+l*(c-k)+g-c);C=d+.45*(C+l*(d-C)-d);l=e+.45*(k+l*(e-k)+g-e);k=2*f;g=.2+.001*m;.6<g&&(g=.6);g*=f;m*=.03;G=h?G+'<path class="stroke" stroke-dasharray="5,5" d="M':
G+'<path d="M';Oa(a," ",c);G+="c"+((n-a)/I.scale).toFixed(1)+" "+(c-z).toFixed(1)+" "+((C-a)/I.scale).toFixed(1)+" "+(c-l).toFixed(1)+" "+((d-a)/I.scale).toFixed(1)+" "+(c-e).toFixed(1);h||(G+="\n\tv"+(-g).toFixed(1)+"c"+((C-m-d)/I.scale).toFixed(1)+" "+(e+g-l-k).toFixed(1)+" "+((n+m-d)/I.scale).toFixed(1)+" "+(e+g-z-k).toFixed(1)+" "+((a-d)/I.scale).toFixed(1)+" "+(e-c).toFixed(1));G+='"/>\n'}function vd(a,c,d){var e,f=d.ty,g=(f&7)==m.SL_ABOVE?1:-1;var h=a.length;var l=h-1,k=a[0],p=a[l];var n=1;
var B=k.st;var z=!1;za(k.st);for(e=1;e<h;e++){var v=a[e];if(v.type==m.NOTE||v.type==m.REST)n++,v.st!=B&&(z=!0,v.st<B&&(B=v.st))}z&&u(2,k,"*** multi-staves slurs not treated yet");h=k.x;k.notes&&k.notes[0].shhd&&(h+=k.notes[0].shhd);z=p.x;p.notes&&(z+=p.notes[0].shhd);c?(c=3*(c.pit-18)+2*g,h+=3):(c=0<g?k.ymx+2:k.ymn-2,k.type==m.NOTE&&(0<g?0<k.stem?(h+=5,k.beam_end&&-1<=k.nflags&&!k.in_tuplet?0<k.nflags?(h+=2,c=k.ys-3):c=k.ys-6:c=k.ys+3):c=k.y+8:0>k.stem?(--h,p.grace?c=k.y-8:k.beam_end&&-1<=k.nflags&&
(!k.in_tuplet||k.ys<c+3)?0<k.nflags?(h+=2,c=k.ys+3):c=k.ys+6:c=k.ys-3):c=k.y-8));d.is_note?(d=3*(d.note.pit-18)+2*g,z-=3):(d=0<g?p.ymx+2:p.ymn-2,p.type==m.NOTE&&(0<g?0<p.stem?(z+=1,d=p.beam_st&&-1<=p.nflags&&!p.in_tuplet?p.ys-6:p.ys+3):d=p.y+8:0>p.stem?(z-=5,d=p.beam_st&&-1<=p.nflags&&!p.in_tuplet?p.ys+6:p.ys-3):d=p.y-8));k.type!=m.NOTE&&(c=d+1.2*g,h=k.x+.5*k.wr,h>z-12&&(h=z-12));p.type!=m.NOTE&&(d=k.type==m.NOTE?c+1.2*g:c,k!=p&&(z=p.x-.3*p.wl));if(3<=n){v=a[1];if(v.type!=m.BAR&&v.x<h+48)if(0<g){var E=
v.ymx-2;c<E&&(c=E)}else E=v.ymn+2,c>E&&(c=E);v=a[l-1];v.type!=m.BAR&&v.x>z-48&&(0<g?(E=v.ymx-2,d<E&&(d=E)):(E=v.ymn+2,d>E&&(d=E)))}var t=(d-c)/(z-h);if(.5<t||-.5>t)t=.5<t?.5:-.5,0<t*g?c=d-t*(z-h):d=c+t*(z-h);E=d-c;8<E?E=8:-8>E&&(E=-8);e=E;0>e&&(e=-e);var r=.5*e;e=.3*E;0<E*g?(z-=r,d-=e):(h+=r,c+=e);k.grace&&(h=k.x-1.15);p.grace&&(z=p.x+2.3*1.5);r=0;t=(d-c)/(z-h);if(k!=p&&k.v==p.v){var q=c-t*h;for(e=1;e<l;e++)if(v=a[e],v.st==B)switch(v.type){case m.NOTE:case m.REST:0<g?(E=3*(v.notes[v.nhd].pit-18)+
6,E<v.ymx&&(E=v.ymx),E-=t*v.x+q,E>r&&(r=E)):(E=3*(v.notes[0].pit-18)-6,E>v.ymn&&(E=v.ymn),E-=t*v.x+q,E<r&&(r=E));break;case m.GRACE:for(v=v.extra;v;v=v.next)0<g?(E=3*(v.notes[v.nhd].pit-18)+6,E<v.ymx&&(E=v.ymx),E-=t*v.x+q,E>r&&(r=E)):(E=3*(v.notes[0].pit-18)-6,E>v.ymn&&(E=v.ymn),E-=t*v.x+q,E<r&&(r=E))}c+=.45*r;d+=.45*r;r*=.65}n=3<n?(.08*(z-h)+12)*g:(.03*(z-h)+8)*g;0<g?(n<3*r&&(n=3*r),40<n&&(n=40)):(n>3*r&&(n=3*r),-40>n&&(n=-40));E=d-c;0>E&&(E=-E);0<g?n<.8*E&&(n=.8*E):n>-.8*E&&(n=-.8*E);n*=k.fmt.slurheight;
ud(h,c,z,d,g,n,f&m.SL_DOTTED);t=(d-c)/(z-h);q=c-t*h;q=0<n?q+(4*Math.sqrt(n)-2):q-(4*Math.sqrt(-n)-2);for(e=0;e<l;e++)v=a[e],v.st==B&&v.type!=m.BAR&&(E=t*v.x+q,v.ymx<E?v.ymx=E:v.ymn>E&&(v.ymn=E),e==l-1?(r=z,p.sl1&&(r-=5),e&&(E-=n/3)):r=a[e+1].x,0!=e?h=v.x:E-=n/3,r-=h,R(B,0<g,h,r,E))}function kc(a,c){function d(a,d,f){var g=[];var h=d.note.s;if(!(c&&h.time>c.time)){if(Sa&&h.time>=Sa.time){a.p_v.sls.push(d);for(h=a.p_v.s_next.prev;h.next;)h=h.next;d=Object.create(d);d.note={s:h}}switch(d.ty&7){case m.SL_ABOVE:var k=
1;break;case m.SL_BELOW:k=-1;break;default:k=a.v!=h.v?1:Ue(a,h),d.ty&=-8,d.ty|=0<k?m.SL_ABOVE:m.SL_BELOW}var l=L.voices[a.v]&&L.voices[h.v]?0<k*(L.voices[a.v].range<=L.voices[h.v].range?1:-1)?a.v:h.v:a.v>h.v?a.v:h.v;if(!e||h.grace&&a.v==h.v&&a.time==h.time)g.push(a),a=a.grace?a.next:a.ts_next;else{do g.push(a),a=a.next;while(a);a=e.next}if(h.grace){if(!a.grace){for(k=h;k.prev;)k=k.prev;for(;;){a.v==l&&g.push(a);if(a.extra==k)break;a=a.ts_next}a=k}for(;;){g.push(a);if(a==h)break;a=a.next}}else for(;a;){a.v==
l&&g.push(a);if(a==h)break;a=a.ts_next}for(h=1;h<g.length-1;h++)a=g[h],(a.sls||a.sl1)&&kc(a,c),a.tp&&Jc(a);vd(g,f,d);return 1}}for(var e,f,g,h,l,k;;){if(!a||a==c){if(!e||!(a=e.next)||a==c)break;e=null}if(a.type==m.GRACE)e=a,a=a.extra;else{if(a.sls){l=a.sls;a.sls=null;k=[];for(f=0;f<l.length;f++)d(a,l[f])||k.push(l[f]);k.length&&(a.sls=k)}if(a.sl1)for(g=0;g<=a.nhd;g++)if(h=a.notes[g],h.sls){l=h.sls;h.sls=null;k=[];for(f=0;f<l.length;f++)d(a,l[f],h)||k.push(l[f]);k.length&&(h.sls=k)}a=a.next}}}function Jc(a){var c,
d,e,f,g=a.tp.shift();a.tp.length||delete a.tp;var h=a.st;za(a.st);for(c=a;c;c=c.next){switch(c.type){case m.GRACE:for(e=c.extra;e;e=e.next)(e.sls||e.sl1)&&kc(e);default:continue;case m.NOTE:case m.REST:}(c.sls||c.sl1)&&kc(c);c.st<h&&(h=c.st);c.tp&&Jc(c);if(c.tpe)break}c&&c.tpe--;if(1!=g.f[0])if(c){e=g.f[3];if(!e){for(d=a;d.type!=m.NOTE;)d=d.next;e=0<d.stem?m.SL_ABOVE:m.SL_BELOW}if(a==c||2==g.f[1])var l=!0;else if(1==g.f[1])l=!0,vd([a,c],null,{ty:e});else if(2!=g.f[0]&&a.type==m.NOTE&&c.type==m.NOTE){l=
!0;for(d=a;;d=d.next){if(d.type!=m.NOTE&&d.type!=m.REST){if(d.type==m.GRACE||d.type==m.SPACE)continue;l=!1;break}if(d==c)break;if(d.beam_end){l=!1;break}}if(l&&!a.beam_st&&!a.beam_br1&&!a.beam_br2)for(d=a.prev;d;d=d.prev)if(d.type==m.NOTE||d.type==m.REST){d.nflags>=a.nflags&&(l=!1);break}if(l&&!c.beam_end)for(d=c.next;d;d=d.next)if(d.type==m.NOTE||d.type==m.REST){!d.beam_br1&&!d.beam_br2&&d.nflags>=c.nflags&&(l=!1);break}}if(l){if(1!=g.f[2]){V("tuplet");l=(c.x+a.x)/2;var k=e==m.SL_ABOVE?Q(h,1,l-4,
8):Q(h,0,l-4,8)-H.curfont.size;0<a.stem*c.stem&&(l=0<a.stem?l+1.5:l-1.5);0==g.f[2]?na(l,k,g.p.toString(),"c"):na(l,k,g.p+":"+g.q,"c");for(d=a;!(d.x>=l);d=d.next);e==m.SL_ABOVE?(k+=H.curfont.size,d.ymx<k&&(d.ymx=k),R(h,!0,l-3,6,k)):(d.ymn>k&&(d.ymn=k),R(h,!1,l-3,6,k))}}else{var p=a.x-4;if(c.dur>c.prev.dur){d=c.next;if(!d||d.time!=c.time+c.dur)for(d=c.ts_next;d&&!(d.seqst&&d.time>=c.time+c.dur);d=d.ts_next);var n=d?d.x-d.wl-5:ua-6}else n=c.x+4,l=0<=c.stem?0:c.nhd,0<c.notes[l].shhd&&(n+=c.notes[l].shhd),
c.st==h&&0<c.stem&&(n+=3.5);if(e==m.SL_ABOVE){if(a.st==c.st)var B=f=A[h].topbar+2;else B=a.ymx,f=c.ymx;if(a.st==h){for(d=a;!d.dur;d=d.next);k=Q(h,1,d.x-4,8);k>B&&(B=k);0<a.stem&&(p+=3)}if(c.st==h){for(d=c;!d.dur;d=d.prev);k=Q(h,1,d.x-4,8);k>f&&(f=k)}l=.5*(p+n);k=.5*(B+f);var z=(f-B)/(n-p);B=3*(c.notes[c.nhd].pit-a.notes[a.nhd].pit)/(n-p);0<B?0>z?z=0:z>B&&(z=B):0<z?z=0:z<B&&(z=B);z*z<.1*.1&&(z=0);f=0;for(d=a;;d=d.next){if(d.dur&&d.st==h){var v=k+(d.x-l)*z;B=Q(h,1,d.x-4,8)+2;B-v>f&&(f=B-v)}if(d==c)break}k+=
f;B=k+z*(p-l);f=k+z*(n-l);k+=6;for(d=a;d.st==h&&(v=k+(d.x-l)*z,d.ymx<v&&(d.ymx=v),R(h,!0,d.x,d.next.x-d.x,v)),d!=c;d=d.next);}else{0>a.stem&&(p-=2);if(a.st==h){for(d=a;!d.dur;d=d.next);B=Q(h,0,d.x-4,8)}else B=0;if(c.st==h){for(d=c;!d.dur;d=d.prev);f=Q(h,0,d.x-4,8)}else f=0;l=.5*(p+n);k=.5*(B+f);z=(f-B)/(n-p);B=3*(c.notes[0].pit-a.notes[0].pit)/(n-p);0<B?(0>z?z=0:z>B&&(z=B),.35<z&&(z=.35)):(0<z?z=0:z<B&&(z=B),-.35>z&&(z=-.35));z*z<.1*.1&&(z=0);f=0;for(d=a;d.dur&&d.st==h&&(v=k+(d.x-l)*z,B=Q(h,0,d.x-
4,8),B-v<f&&(f=B-v)),d!=c;d=d.next);k+=f-8;B=k+z*(p-l);f=k+z*(n-l);k-=2;for(d=a;d.st==h&&(v=k+(d.x-l)*z,d.ymn>v&&(d.ymn=v),d.next&&R(h,!1,d.x,d.next.x-d.x,v)),d!=c;d=d.next);}1==g.f[2]?(h=f-B,v=e==m.SL_ABOVE?-3:3,e=(n-p)/I.scale,G+='<path class="stroke" d="m',Oa(p," ",B+4+v),G+="v"+v.toFixed(1)+"l"+e.toFixed(1)+" "+(-h).toFixed(1)+"v"+(-v).toFixed(1)+'"/>\n'):(a=p,c=B,p=n-p,n=f-B,B=e==m.SL_ABOVE,f=0==g.f[2]?g.p.toString():g.p+":"+g.q,g=10*f.length,d=B?-3:3,V("tuplet"),na(a+p/2,c+n/2-.5*H.curfont.size+
2,f,"c"),p/=I.scale,B||(c+=6),G+='<path class="stroke" d="m',Oa(a," ",c),B=p-g+1,g=0<n?g+n/8:g-n/8,G+="v"+d.toFixed(1)+"m"+p.toFixed(1)+" "+(-n).toFixed(1)+"v"+(-d).toFixed(1)+'"/>\n<path class="stroke" stroke-dasharray="'+(B/2).toFixed(1)+" "+g.toFixed(1)+'" d="m',Oa(a," ",c-d),G+="l"+p.toFixed(1)+" "+(-n).toFixed(1)+'"/>\n',e==m.SL_ABOVE?R(h,!0,l-3,6,v+2):R(h,!1,l-3,6,v))}}else u(1,a,"No end of tuplet in this music line")}function wd(a,c){var d,e=a.tie_n;var f=2==c?a.pit:e.pit;var g=(a.tie_ty&7)==
m.SL_ABOVE?1:-1,h=a.s,l=h.st,k=e.s;var p=k.x;var n=a.shhd;for(d=0;d<h.nhd&&h.notes[d]!=a;d++);0<g?d<h.nhd&&f+1==h.notes[d+1].pit&&h.notes[d+1].shhd>n&&(n=h.notes[d+1].shhd):0<d&&f==h.notes[d-1].pit+1&&h.notes[d-1].shhd>n&&(n=h.notes[d-1].shhd);var B=h.x+n;if(2!=c){for(d=0;d<k.nhd&&k.notes[d]!=e;d++);n=k.notes[d].shhd;0<g?d<k.nhd&&f+1==k.notes[d+1].pit&&k.notes[d+1].shhd<n&&(n=k.notes[d+1].shhd):0<d&&f==k.notes[d-1].pit+1&&k.notes[d-1].shhd<n&&(n=k.notes[d-1].shhd);p+=n}switch(c){case 0:f=a.pit&1?
a.pit:e.pit;break;case 3:g=-g;case 1:B=h.x;B>p-20&&(B=p-20);f=e.pit;l=k.st;break;default:if(h!=k)p-=k.wl,k.type==m.BAR&&(p+=5);else{c=h.time+h.dur;for(p=h.ts_next;p&&!(p.time>c);p=p.ts_next);p=p?p.x:ua}p<B+16&&(p=B+16)}20<p-B?(B+=3.5,p-=3.5):(B+=1.5,p-=1.5);!h.dots||a.pit&1||!(0<g&&!h.dot_low||0>g&&h.dot_low)||(B+=5);f=A[l].y+3*(f-18)+g;ud(B,f,p,f,g,(.03*(p-B)+16)*g*h.fmt.tieheight,a.tie_ty&m.SL_DOTTED)}function lc(a,c,d){var e;var f=[];var g=a.nhd;if(2==d)for(e=0;e<=g;e++){var h=a.notes[e];h.tie_ty&&
(f=h.tie_n,h.tie_n={s:c||a},wd(h,d),h.tie_n=f)}else{for(e=0;e<=g;e++)h=a.notes[e],h.tie_ty&&(h.s||(h.s=a),h.tie_n?wd(h,d):f.push(h));f.length&&u(1,a,"Bad tie")}}function Ve(a){function c(a,c,d){if(a.type==m.GRACE)for(a=a.extra;a;a=a.next)a.tie_s&&lc(a,c,d);else lc(a,c,d)}var d=a.sym;for(Ha(d.color);;){for(a=d;a;a=a.next){if(a.ti2&&(a!=d||!d.prev)){var e=a.ti2;e.x=a.x;var f=e.next;e.next=a;e.st=a.st;var g=e.time;e.time=a.time-e.dur;lc(e,a,1);e.next=f;e.time=g}if(a.tie_s)break}if(!a)break;f=a.tie_s;
e=a;if(f.v==a.v)for(d=f;;){if(!e.next){f=e;e=null;break}e=e.next;if(e==f)break}else{for(d=a.next;;){if(!e.ts_next){e=null;break}e=e.ts_next;if(e==f)break}if(!e)for(f=a;f.next;)f=f.next}if(!e){c(a,f,2);a.tie_s.ti2=a;break}g=a.time+e.dur;for(e=a.ts_next;e!=f;e=e.ts_next)if(e.st==a.st){if(e.time>g)break;if(e.type==m.CLEF){var h=!0;break}}h||a.st!=f.st?(h=!1,g=.4*(f.x-a.x),e=f.x,f.x-=g,f.x>a.x+32&&(f.x=a.x+32),c(a,f,2),f.x=e,e=a.x,a.x+=g,a.x<f.x-24&&(a.x=f.x-24),lc(a,f,3),a.x=e):c(a,f,f.type==m.NOTE?
0:2)}}function We(){function a(a,c){var d=ua/Da,e=a.x/d|0,f=c.x/d|0,g=(a.ys-c.ys)/(a.xs-c.xs);c=a.ys-a.xs*g;var h=A[a.st];d*=g;if(0<a.stem)for(;e<=f;)a=d*e+c,h.top[e]<a&&(h.top[e]=a),e++;else for(;e<=f;)a=d*e+c,h.bot[e]>a&&(h.bot[e]=a),e++}var c,d,e,f=G;G="";Da=Math.ceil(ua/2);for(c=0;c<=U;c++){var g=A[c];g.top=new Float32Array(Da);g.bot=new Float32Array(Da);for(d=0;d<Da;d++)g.top[d]=0,g.bot[d]=24}for(d=0;d<D.length;d++){var h={},l=!0;c=D[d];for(g=c.sym;g;g=g.next)switch(g.type){case m.GRACE:var k=
0;for(e=g.extra;e;e=e.next)e.beam_st&&!e.beam_end&&(X.calculate_beam(h,e),h.s2&&a(e,h.s2)),(e.sls||e.sl1)&&k++;g.p_v.ckey.k_bagpipe||!g.fmt.graceslurs||g.gr_shift||k||g.tie_s||!g.next||g.next.type!=m.NOTE||Te(g)}for(g=c.sym;g;g=g.next)switch(g.type){case m.NOTE:if(g.beam_st&&!g.beam_end||l&&!g.beam_st)l=!1,X.calculate_beam(h,g),h.s2&&a(g,h.s2)}}Xe();Ne();for(g=N;g;g=g.ts_next)if(!g.invis){switch(g.type){case m.GRACE:for(e=g.extra;e;e=e.next)R(g.st,!0,e.x-2,4,e.ymx+1),R(g.st,!1,e.x-2,4,e.ymn-5);continue;
case m.MREST:R(g.st,!0,g.x+16,32,g.ymx+2);continue;default:R(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx+2);R(g.st,!1,g.x-g.wl,g.wl+g.wr,g.ymn-2);continue;case m.NOTE:}0<g.stem?(g.stemless?(c=-5,d=10):g.beam_st?(c=3,d=g.beam_end?4:10):(c=-8,d=g.beam_end?11:16),R(g.st,!0,g.x+c,d,g.ymx),d=g.ymn,g.notes[0].acc&&d>3*(g.notes[0].pit-18)-9&&(d=3*(g.notes[0].pit-18)-9),R(g.st,!1,g.x-g.wl,g.wl+g.wr,d)):(R(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx),g.stemless?(c=-5,d=10):g.beam_st?(c=-6,d=g.beam_end?4:10):(c=-8,d=g.beam_end?
5:16),c+=g.notes[0].shhd,R(g.st,!1,g.x+c,d,g.ymn));g.notes[g.nhd].acc&&(d=g.y+8,g.ymx<d&&(g.ymx=d),R(g.st,!0,g.x,0,d));g.notes[0].acc&&(d=g.y,d=1==g.notes[0].acc||3==g.notes[0].acc?d-7:d-5,g.ymn>d&&(g.ymn=d),R(g.st,!1,g.x,0,d))}Oe();for(d=0;d<D.length;d++)if(c=D[d],g=c.sym)for(Ha(g.color),c=c.st;g;g=g.next)g.play||(g.tp&&Jc(g),(g.sls||g.sl1)&&kc(g));Ha();for(c=0;c<=U;c++)for(g=A[c],e=g.topbar+2,k=g.botbar-2,d=0;d<Da;d++)e>g.top[d]&&(g.top[d]=e),k<g.bot[d]&&(g.bot[d]=k);0<=r.measurenb&&Re();Pe();za(-1);
for(d=0;d<D.length;d++)if(c=D[d],c.have_ly){Ye();break}za(-1);G=f}function Ze(a,c){var d,e,f=[];for(d=c.length;0<=d&&!c[d];d--);if(!(0>d)){for(e=0;e<D.length;e++){var g=D[e];if(g.sym&&L.voices[e]&&(d=L.voices[e].st,c[d])){if(g.new_name){var h=2;break}g.snm&&(h=1)}}if(h){for(e=0;e<D.length;e++)g=D[e],g.sym&&L.voices[e]&&(d=L.voices[e].st,c[d]&&(g.new_name&&delete g.new_name,(g=2==h?g.nm:g.snm)&&(f[d]=f[d]?f[d]+("\n"+g):g)));if(f.length){V("voice");var l=H.curfont.size;var k=l/2;a=.5*-a;for(d=0;d<f.length;d++)if(f[d])for(e=
f[d].split("\n"),h=A[d].y+.5*A[d].topbar*A[d].staffscale+k*(e.length-2),L.staves[d].flags&1&&d+1<f.length&&L.staves[d+1].flags&2&&!f[d+1]&&(h-=.5*(A[d].y-A[d+1].y)),c=0;c<e.length;c++)g=e[c],na(a,h,g,"c"),h-=l}}}}function $e(){var a,c,d,e,f=N.fmt;var g=L;for(c=0;c<D.length;c++){var h=D[c];1!=h.scale&&(h.scale_str='transform="scale('+h.scale.toFixed(2)+')"')}for(c=0;c<=U&&!H.st_print[c];c++);var l=0;c>U&&c--;h=A[c];for(a=0;a<Da;a++){var k=h.top[a];l<k&&(l=k)}a=l;k=c;var p=0,n=0,t=A[k].topbar+8,z=0,
v=1,E=-100;for(e=N;e;e=e.ts_next)if(e.type==m.TEMPO&&!e.invis){d||(d=e);var y=e.tempo_wh[0];0==e.time&&40<e.x&&(e.x=40);var lb=Q(k,!0,e.x-16,y);lb>t&&(t=lb);E>=e.x-16&&!(z&v>>1)&&(z|=v);v<<=1;E=e.x-16+y}if(d){Aa(-1);V("tempo");n=H.curfont.size+8;lb=2-n;var u=lb-n;0!=z&&(n*=2);l<t+n&&(p=t+n-l);for(e=d;e;e=e.ts_next)if(e.type==m.TEMPO&&!e.invis){if(q.anno_start||q.anno_stop)e.wl=16,e.wr=30,e.ymn=z&1?u:lb,e.ymx=e.ymn+14,ta(e);xd(e,e.x-16,z&1?u:lb);Wa(e);for(z>>=1;e.ts_next&&e.ts_next.type==m.TEMPO;)e=
e.ts_next}}t=A[k].topbar+6;for(e=N;e;e=e.ts_next)if(e.type==m.PART&&!e.invis){if(!x){var x=e;V("parts");u=H.curfont.size+2+2*H.curfont.pad}y=sa(e.text)[0];lb=Q(k,!0,e.x-10,y+3);t<lb&&(t=lb)}if(x)for(Aa(-1),l+p<t+u+n&&(p=t+u+n-l),e=x;e;e=e.ts_next)if(e.type==m.PART&&!e.invis){e.x-=10;if(q.anno_start||q.anno_stop)y=sa(e.text)[0],e.wl=0,e.wr=y,e.ymn=-n-u,e.ymx=e.ymn+u,ta(e);na(e.x,2-n-u,e.text);for(Wa(e);e.ts_next&&e.ts_next.type==m.PART;)e=e.ts_next}l=a+p;if(!H.st_print[c])return h.y=-l,l;l*=h.staffscale;
d=.5*f.staffsep+h.topbar*h.staffscale;l<d&&(l=d);l<h.ann_top&&(l=h.ann_top);h.y=-l;x=c;u=g.staves[x];for(c++;c<=U;c++)if(H.st_print[c]){h=A[c];d=u.sep||r.sysstaffsep;e=u.maxsep||r.maxsysstaffsep;u=0;if(h.staffscale==A[x].staffscale){for(a=0;a<Da;a++)k=h.top[a]-A[x].bot[a],u<k&&(u=k);u*=h.staffscale}else for(a=0;a<Da;a++)k=h.top[a]*h.staffscale-A[x].bot[a]*A[x].staffscale,u<k&&(u=k);d+=h.topbar*h.staffscale;u<d&&(u=d);e+=h.topbar*h.staffscale;u>e&&(u=e);l+=u;h.y=-l;for(x=c;!(u=g.staves[x]);)g=g.next}for(a=
g=0;a<Da;a++)k=A[x].bot[a],g>k&&(g=k);g>h.ann_bot&&(g=h.ann_bot);g*=A[x].staffscale;for(c=0;c<=U;c++)h=A[c],u=h.y,1!=h.staffscale&&(h.scale_str='transform="translate(0,'+(aa-u).toFixed(1)+") scale("+h.staffscale.toFixed(2)+')"');if(0==g){for(c=U;0<=c&&!H.st_print[c];c--);if(0>c)return l}u=-g;d=.5*f.staffsep;u<d&&(u=d);e=.5*f.maxstaffsep;u>e&&(u=e);return l+u}function af(a){function c(){var a,c=0;for(a=0;a<=L.nstaff;a++)if(0>l[a])p[a]=n[a]=0;else{var d=A[a].staffscale;var e=A[a].topbar*d;d*=A[a].botbar;
0==c&&(c=A[a].y+e);p[a]=A[a].y+d;n[a]=c-p[a];c=L.staves[a].flags&64?0:p[a]}}function d(a,c,d){var e,f,g=0,h="",k=A[a].stafflines,l=k.length;if(/[\[|]/.test(k)){d-=c;Aa(a);var m=d/I.scale;if($b&&$b.st_l==k&&$b.st_ws==(m|0))ca(c,A[a].y,"stdef"+r.fullsvg);else{for(e=0;e<l;e++,g-=6)if("."!=k[e]){for(f=0;e<l;e++,g-=6,f-=6){switch(k[e]){case ".":case "-":continue;case p:h+="m-"+m.toFixed(1)+" "+f+"h"+m.toFixed(1);f=0;continue}void 0!=p&&(h+='"/>\n');var p=k[e];h+='<path class="'+("["==p?"slthW":"slW")+
'" d="m0 '+g+"h"+m.toFixed(1);f=0}h+='"/>'}g=A[a].y;!$b&&d>Wb()-10?($b={st_l:k,st_ws:m|0},e="stdef"+r.fullsvg,0>h.indexOf("<path",1)?Kb[e]=h.replace("path",'path id="'+e+'"'):Kb[e]='<g id="'+e+'">\n'+h+"\n</g>",ca(c,g,e)):Y('<g transform="translate(X, Y)">\n'+h+"\n</g>\n",c,g)}}}var e,f,g,h,l=[],k=[],p=[],n=[],t=[],z="",v="";for(g=0;g<=U;g++)l[g]=L.st_print[g]?0:-1,k[g]=L.st_print[g];c();qd(0);for(e=N;e;e=e.ts_next){if(h&&e.time!=h){for(g=h=0;g<=U;g++)L.st_print[g]||(l[g]=-1);c()}switch(e.type){case m.STAVES:var E=
e.ts_prev.type==m.BAR?e.ts_prev.x:0;if(!E){for(f=e.ts_next;f&&f.time==e.time;f=f.ts_next){switch(f.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:E=f.x;continue}break}f||(E=ua)}var q=e.sy;for(g=0;g<=U;g++){var u=l[g];0>u?q.st_print[g]&&(l[g]=E?E:e.x-e.wl-2,k[g]=!0):q.st_print[g]&&q.staves[g].stafflines==L.staves[g].stafflines||(E?(f=E,h=e.time):(f=e.x-e.wl-2,l[g]=-1),d(g,u,f),q.st_print[g]&&(l[g]=f))}L=q;c();continue;case m.BAR:if(e.invis||!e.bar_type)break;if(e.second&&(!e.ts_prev||e.ts_prev.type==
m.BAR&&e.ts_prev.st==e.st))break;t.push([e,p[e.st],n[e.st]]);break;case m.STBRK:if(L.voices[e.v]&&0==L.voices[e.v].range&&14<e.xmx){for(u=g=0;u<D.length;u++)L.voices[u]&&0<L.voices[u].range&&g++;for(f=e.ts_next;f&&f.type==m.STBRK;f=f.ts_next)g--;0==g&&qd(e.x)}g=e.st;u=l[g];0<=u&&(f=e.prev)&&(f=f.type==m.BAR?f.x:e.x-e.xmx,u>=f||(d(g,u,f),l[g]=e.x))}}for(g=0;g<=U;g++)if(!h||L.st_print[g])u=l[g],0>u||u>=ua||d(g,u,ua);(function(){var a,c,d=t.length;V("annotation");if(c=H.curfont.box)H.curfont.box=0;for(a=
0;a<d;a++){var e=t[a];var f,g,h=e[0],k=e[1],l=e[2],p=h.bar_type,n=h.st,C=A[n],r=h.x;0!=n&&h.ts_prev&&h.ts_prev.type!=m.BAR&&(l=C.topbar*C.staffscale);h.ymx=h.ymn+l;Aa(-1);ta(h);h.color&&Ha(h.color);e=C.y+12;"|||||"!=C.stafflines&&(e+=(C.topbar+C.botbar)/2-12);if(h.bar_mrep){Aa(n);if(1==h.bar_mrep){for(f=h.prev;f.type!=m.REST;f=f.prev);ca(f.x,e,"mrep")}else ca(r,e,"mrep2"),h.v==L.top_voice&&td(r,e+C.topbar,h.bar_mrep);Aa(-1)}"||:"==p&&(p="[|:");for(g=p.length;0<=--g;){switch(p[g]){case "|":h.bar_dotted?
(f=(5*C.staffscale).toFixed(1),Y('<path class="bW" stroke-dasharray="A,A" d="MX Yv-G"/>\n',r,k,f,l)):h.color?Y('<path class="bW" d="MX Yv-F"/>\n',r,k,l):z+="M"+ab(r).toFixed(1)+" "+X.sy(k).toFixed(1)+"v-"+l.toFixed(1);break;default:r-=3;h.color?Y('<path class="bthW" d="MX Yv-F"/>\n',r+1.5,k,l):v+="M"+ab(r+1.5).toFixed(1)+" "+X.sy(k).toFixed(1)+"v-"+l.toFixed(1);break;case ":":r-=2,Aa(n),ca(r+1,e-12,"rdots"),Aa(-1)}r-=3}Ha();Wa(h)}c&&(H.curfont.box=c);Aa(-1);z&&(G+='<path class="bW" d="'+z+'"/>\n');
v&&(G+='<path class="bthW" d="'+v+'"/>\n')})();Ze(a,k)}function bf(){var a,c=D.length;for(a=0;a<c;a++){var d=D[a];d.sym&&void 0!=d.sym.x&&(X.draw_symbols(d),Ve(d),Ha())}X.draw_all_deco();(function(){function a(a,c){var e,f,g,h=a.length;if(h)for(f=0;f<h;f++)if((e=a[f])&&e.length){var l=ab(e[0][0]);G+='<path class="stroke" stroke-width="1" d="M'+l.toFixed(1)+" "+eb(d.y+c*f).toFixed(1);for(g=0;;){var m=e.shift();if(!m)break;var n=ab(m[0]);G+="m"+(n-l+m[1]-g).toFixed(2)+" 0h"+(-m[1]+m[2]).toFixed(2);
l=n;g=m[2]}G+='"/>\n'}}var c;for(c=0;c<=U;c++){var d=A[c];d.hlu&&(Aa(c),a(d.hlu,6),a(d.hld,-6))}})();fb();cf();Aa(-1)}function Xe(){var a,c,d,e;for(c=0;c<D.length;c++){var f=D[c];if(f=f.sym)if(f=f.next){for(e=f;e;e=e.next)if(e.tie_s)if(0!=e.multi){var g=0<e.multi?m.SL_ABOVE:m.SL_BELOW;for(d=0;d<=e.nhd;d++){var h=e.notes[d].tie_ty;(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|g)}}else{g=a=0;h=128;for(d=0;d<=e.nhd;d++)e.notes[d].tie_ty&&(a++,128>h&&e.notes[d].pit<=h+1&&g++,h=e.notes[d].pit);if(1>=
a)for(g=0>e.stem?m.SL_ABOVE:m.SL_BELOW,d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty){(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|g);break}}else if(0==g)if(a&1)for(a=(a-1)/2,g=m.SL_BELOW,d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty)0==a&&22<=e.notes[d].pit&&(g=m.SL_ABOVE),(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|g),0==a--&&(g=m.SL_ABOVE)}else for(a/=2,g=m.SL_BELOW,d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty)(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|g),0==--a&&(g=m.SL_ABOVE)}else{h=128;
for(d=0;d<=e.nhd;d++)if(e.notes[d].tie_ty){if(128>h&&e.notes[d].pit<=h+1){a=d;break}h=e.notes[d].pit}g=m.SL_BELOW;for(d=0;d<=e.nhd;d++)if(h=e.notes[d].tie_ty)a==d&&(g=m.SL_ABOVE),(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|g)}}for(;f;f=f.next)if(f.tie_s&&(20>f.notes[0].pit&&f.notes[0].tie_ty&&(f.notes[0].tie_ty&7)==m.SL_BELOW||24<f.notes[f.nhd].pit&&f.notes[f.nhd].tie_ty&&(f.notes[f.nhd].tie_ty&7)==m.SL_ABOVE)){for(a=f.next;a&&a.type!=m.NOTE;)a=a.next;if(a){if(a.st!=f.st)continue;d=a.x-f.x-
10}else d=ua-f.x-10;h=100>d?9:300>d?12:16;24<f.notes[f.nhd].pit&&(e=3*(f.notes[f.nhd].pit-18)+h,f.ymx<e&&(f.ymx=e),a&&a.ymx<e&&(a.ymx=e),R(f.st,!0,f.x+5,d,e));20>f.notes[0].pit&&(e=3*(f.notes[0].pit-18)-h,f.ymn>e&&(f.ymn=e),a&&a.ymn>e&&(a.ymn=e),R(f.st,!1,f.x+5,d,e))}}}}function Ta(a){return!a||!/^(0|n|f)/i.test(a)}function yd(a){var c=zd[a.name];c||(c=1.1);a.swfac=a.size*c}function rb(a,c){var d;if("-"==a[a.length-2]){a=a[a.length-1];if("1">a||"9"<a)return;a="u"+a+"font"}var e=(e=r[a])?{name:e.name,
size:e.size,box:e.box,pad:e.pad||0}:{pad:0};r[a]=e;if(d=c.match(/\s+(no)?box(\s|$)/))d[1]?(e.box=!1,e.pad=0):(e.box=!0,e.pad=.4*e.size-3),c=c.replace(d[0],d[2]);if(d=c.match(/\s+padding=([\d.]+)(\s|$)/))e.pad=d[1]?Number(d[1]):0,c=c.replace(d[0],d[2]);if(d=c.match(/\s+class=(.*?)(\s|$)/))e.class=d[1],c=c.replace(d[0],d[2]);if(d=c.match(/\s+wadj=(.*?)(\s|$)/)){if("undefined"==typeof document)switch(d[1]){case "none":e.wadj="";break;case "space":e.wadj="spacing";break;case "glyph":e.wadj="spacingAndGlyphs";
break;default:y(1,J.bad_val,"%%"+a)}c=c.replace(d[0],d[2])}if(d=c.match(/\s+([0-9.]+|\*)$/))"*"!=d[1]&&(e.size=Number(d[1])),c=c.replace(d[0],"");if(d=c.match(/[- ]?[nN]ormal/))e.normal=!0,c=c.replace(d[0],"");if(d=c.match(/[- ]?[bB]old/))e.weight="bold",c=c.replace(d[0],"");if(d=c.match(/[- ]?[iI]talic/))e.style="italic",c=c.replace(d[0],"");if(d=c.match(/[- ]?[oO]blique/))e.style="oblique",c=c.replace(d[0],"");e.size?yd(e):e.swfac=0;if("u"==c[0]&&"url("==c.slice(0,4)){a=c.indexOf(")",1);if(0>a){y(1,
"No end of url in font family");return}c=c.slice(0,a+1)}else if('"'==c[0]){a=c.indexOf('"',1);if(0>a){y(1,"No end of string in font family");return}c=c.slice(1,a)}else a=c.indexOf(" ",1),0<=a&&(c=c.slice(0,a));switch(c){case "":case "*":return;case "Times-Roman":case "Times":c="serif";break;case "Helvetica":c="sans-serif";break;case "Courier":c="monospace";break;case "music":c=r.musicfont.name;break;default:0<c.indexOf("Fig")&&(e.figb=!0)}"("==c[3]&&(e.src=c,e.fid=gb.length,gb.push(e),c="ft"+e.fid);
e.name=c}function Ea(a){a=a.toLowerCase().match(/([\d.]+)(.*)/);if(!a)return NaN;a[1]=Number(a[1]);switch(a[2]){case "cm":return 37.8*a[1];case "in":return 96*a[1];case "pt":return.75*a[1];case "px":case "":return a[1]}return NaN}function Ad(a,c){a=a.slice(0,3);"ste"==a&&(a="stm");ac("pos",'"'+a+" "+c+'"')}function ac(a,c){a=[a+"=",c];n?mc(a):Kc("*",a)}function wa(){da.chg&&(da.chg=!1,da.lm=r.leftmargin-r.printmargin,0>da.lm&&(da.lm=0),da.rm=r.rightmargin-r.printmargin,0>da.rm&&(da.rm=0),da.width=
r.pagewidth-2*r.printmargin,100>da.width-da.lm-da.rm&&(u(0,void 0,"Bad staff width"),da.width=da.lm+da.rm+150),Vb=da.lm/r.scale)}function Bd(a){var c=a.name,d="";a.weight&&(d+=a.weight+" ");a.style&&(d+=a.style+" ");0>c.indexOf('"')&&0<c.indexOf(" ")&&(c='"'+c+'"');return d+a.size.toFixed(1)+"px "+c}function Lc(a){return"font:"+Bd(a)}function bb(a){var c="f"+a.fid+r.fullsvg;a.class&&(c+=" "+a.class);a.box&&(c+=" box");return c}function tb(a){a.used||(a.used=!0,void 0==a.fid&&(a.fid=gb.length,gb.push(a),
a.swfac||yd(a),a.pad||(a.pad=0)),Cd(".f"+a.fid+(r.fullsvg||"")+"{"+Lc(a)+"}"),a.src&&Cd("@font-face{\n font-family:"+a.name+";\n src:"+a.src+"}"))}function Ga(a){a+="font";var c=r[a];if(!c)return y(1,"Unknown font $1","$"+a[1]),H.curfont;if(!c.name||!c.size){a=Object.create(H.curfont);c.name&&(a.name=c.name);c.normal?(a.weight&&(a.weight=null),a.style&&(a.style=null)):(c.weight&&(a.weight=c.weight),c.style&&(a.style=c.style));c.size&&(a.size=c.size);var d=Bd(a);c.class&&(a.class=c.class,d+=" "+c.class);
c=Dd[d];if(void 0!=c)return gb[c];Dd[d]=gb.length;a.fid=a.used=void 0;c=a}tb(c);return c}function Ed(a,c){var d,e,f="";for(d=0;;){var g=a.indexOf("\\",d);if(0>g)break;f+=a.slice(d,g);d=a[++g];if(!d)return f+"\\";switch(d){case "0":case "2":if("0"!=a[g+1])break;if(e=df[a[g+2]]){f+=e;d=g+3;continue}break;case "u":d=Number("0x"+a.slice(g+1,g+5));if(isNaN(d)||32>d){f+=a[++g]+"\u0306";d=g+1;continue}d=String.fromCharCode(d);if("\\"==d){g+=4;break}f+=d;d=g+5;continue;case "t":f+=" ";d=g+1;continue;case "n":f+=
"\n";d=g+1;continue;default:if(e=ef[a.slice(g,g+2)]){f+=e;d=g+2;continue}if((e=a[g+1])&&/[A-Za-z]/.test(e))switch(d){case "`":f+=e+"\u0300";d=g+2;continue;case "'":f+=e+"\u0301";d=g+2;continue;case "^":f+=e+"\u0302";d=g+2;continue;case "~":f+=e+"\u0303";d=g+2;continue;case "=":f+=e+"\u0304";d=g+2;continue;case "_":f+=e+"\u0305";d=g+2;continue;case ".":f+=e+"\u0307";d=g+2;continue;case '"':f+=e+"\u0308";d=g+2;continue;case "o":f+=e+"\u030a";d=g+2;continue;case "H":f+=e+"\u030b";d=g+2;continue;case "v":f+=
e+"\u030c";d=g+2;continue;case "c":f+=e+"\u0327";d=g+2;continue;case ";":f+=e+"\u0328";d=g+2;continue}}"w"==c&&(f+="\\");f+=d;d=g+1}return f+a.slice(d)}function ff(a){var c;if(q.read_file)if(2<Lb)y(1,"Too many include levels");else if(c=q.read_file(a)){Lb++;var d=x(t);Mc(a,c);d.state=t.state;t=d;Lb--}else y(1,"Cannot read file '$1'",a);else y(1,"No read_file support")}function Mc(a,c,d,e){function f(){var a=c.indexOf("K:",d);if(0>a)return!1;a=c.indexOf("\n",a);if(t.select.test(c.slice(t.bol,a)))return!0;
var f=/\n\w*\n/;f.lastIndex=a;B=f.exec(c)?f.lastIndex:e;return!1}function g(a,c){if(!a)return a;var d=a.indexOf("%");if(0==d)return"";0<d&&(a=a.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%"));a=a.replace(/\s+$/,"");return c&&0<=a.indexOf("\\")?Ed(a,c):a}function h(){var a;t.tp&&(y(1,"No end of tuplet"),(a=t.tps)&&delete a.tp,delete t.tp);ea&&(y(1,"No end of voice overlay"),bc(ea.bar?"|":")"));3>t.state&&Fa();Fd();var c,d,e=D.length,f=[],g=[];var h=L;for(c=0;c<e;c++)f.push(D[c].sym);var k=e;var l=
-1;for(c=0;c<e;c++)h.voices[c]&&(a=h.voices[c].range,a<k&&(k=a),g[a]=c,l++);c=g[k];if(N=k=f[c])for(f[c]=N.next,k.seqst=!0,d=!Pa[k.type]||N.type==N.next;;){if(p){h=p;var p=null;l=-1;g=[];for(c=0;c<e;c++)h.voices[c]&&(a=h.voices[c].range,g[a]=c,l++)}var n=h=1E7;for(a=0;a<e;a++){c=g[a];if(void 0==c)break;!(l=f[c])||l.time>h||(c=Pa[l.type],l.time<h?(h=l.time,n=c):c<n&&(n=c))}if(127<n)break;for(a=0;a<e;a++){c=g[a];if(void 0==c)break;(l=f[c])&&l.time==h&&Pa[l.type]==n&&(l.type==m.STAVES&&(p=l.sy),d&&(d=
0,l.seqst=!0),l.ts_prev=k,k=k.ts_next=l,f[c]=l.next)}d=n}if(N){X.set_bar_num();for(a=D.length;0<=--a;)if(e=D[a],void 0!=e.vtransp)for(e.key.k_transp?(p=e.key,Gd(p),p.k_old_sf=p.k_sf):p=null,f=e.sym;f;){if(!p)for(;f&&(f.type!=m.KEY||!f.k_transp);f=f.next);for(;f;f=f.next){switch(f.type){case m.GRACE:for(g=f.extra;g;g=g.next)for(e=0;e<=g.nhd;e++)Hd(g,p,g.notes[e]);continue;case m.NOTE:for(e=0;e<=f.nhd;e++)Hd(f,p,f.notes[e]);continue;case m.KEY:p&&(f.k_sf=p.k_sf);Gd(f);if(!f.k_transp)break;p=f;default:continue}break}p=
null}S.P&&(N.parts=S.P);q.get_abcmodel&&q.get_abcmodel(N,D,abc2svg.sym_name,S);q.img_out&&X.output_music();N&&Nc.push([N,D,S,r])}wa();S.W&&gf(S.W);a=r.infoname.split("\n");e=a.length;for(p=0;p<e;p++)if(f=a[p][0],!(0>r.writefields.indexOf(f))&&(f=S[f])){if(!v){var v=!0;V("history");ma(r.textspace);var z=H.curfont.size*r.lineskipfac}c=a[p].slice(2);'"'==c[0]&&(c=c.slice(1,-1));ma(z);g=sa(c);na(0,0,c,null,null,g);c=g[0];f=f.split("\n");na(c,0,f[0]);for(g=1;g<f.length;g++)ma(z),na(c,0,f[g]);ma(.3*z);
tb(H.curfont)}t.state=0;hb();r=Ka.cfmt;S=Ka.info;La=Ka.char_tb;oa=Ka.glovar;mb=Ka.maps;ub=Ka.mac;nc=Ka.maci;t.tune_v_opts=null;t.scores=null;t.ufmt=!1;Id();da.chg=!0;wa()}function l(a,d){if("end"!=a){d?(t.tune_v_opts||(t.tune_v_opts={}),d=t.tune_v_opts):(t.voice_opts||(t.voice_opts={}),d=t.voice_opts);for(d[a]=[];;){var e=++B;if("%"!=c[e])break;B=c.indexOf("\n",B);if(c[e+1]==v){e+=2;u=0>B?c.slice(e):c.slice(e,B);p=u.match(/\S+/);switch(p[0]){default:d[a].push(g(u,!0));continue;case "score":case "staves":case "tune":case "voice":e-=
2}break}}B=t.eol=e-1}}function k(){var a,e=c.indexOf("K:",d);e=c.indexOf("\n",e);var f=c.slice(t.bol,e);for(e in t.tune_opts)if(t.tune_opts.hasOwnProperty(e)&&(new RegExp(e)).test(f)){var g=t.tune_opts[e];for(a=0;a<g.t_opts.length;a++){var h=g.t_opts[a];switch(h.match(/\S+/)[0]){case "score":case "staves":t.scores||(t.scores=[]);t.scores.push(h);break;default:X.do_pscom(h)}}if(g=g.v_opts)for(a in g)g.hasOwnProperty(a)&&(t.tune_v_opts||(t.tune_v_opts={}),t.tune_v_opts[a]=t.tune_v_opts[a]?t.tune_v_opts[a].concat(g[a]):
g[a])}}var p,n="\n";abc2svg.modules&&(abc2svg.modules.hooks.length||abc2svg.modules.g_hooks.length)&&hf();t.file=c;t.fname=a;void 0==d&&(d=0);e||(e=c.length);for("%abc-"==c.slice(d,d+5)&&(r["abc-version"]=/[1-9.]+/.exec(c.slice(d+5,d+10)));d<e;d=t.eol+1){var B=c.indexOf("\n",d);if(0>B||B>e)B=e;for(t.eol=B;;){B--;switch(c[B]){case " ":case "\t":continue}break}B++;if(B==d)1==t.state?(t.istart=d,y(1,"Empty line in tune header - ignored")):2<=t.state&&(h(),t.select&&(B=c.indexOf("\nX:",t.eol),0>B&&(B=
e),t.eol=B));else{t.istart=t.bol=d;t.iend=B;t.line.index=0;var z=c[d];var v=c[d+1];if("%"==z){if(0>t.prefix.indexOf(v))continue;if("a"==c[d+2]&&"b"==c[d+3]&&"c"==c[d+4]&&" "==c[d+5])d+=6,z=c[d],v=c[d+1];else var E=!0}else"I"==z&&":"==v&&(E=!0);if(E){E=!1;d+=2;var u=c.slice(d,B);if((p=u.match(/([^\s]+)\s*(.*)/))&&"%"!=p[1][0]){switch(p[1]){case "abcm2ps":case "ss-pref":t.prefix=p[2];continue;case "abc-include":ff(g(p[2]));continue}if("begin"==p[1].slice(0,5)){a=p[1].substr(5);var lb="\n"+z+v+"end"+
a;z=c.indexOf(lb,B);0>z?(y(1,"No $1 after %%$2",lb.slice(1),p[1]),t.eol=e):(X.do_begin_end(a,g(p[2]),c.slice(B+1,z).replace(/^%?%/gm,"")),t.eol=c.indexOf("\n",z+6),0>t.eol&&(t.eol=e))}else{switch(p[1]){case "select":if(0!=t.state){y(1,J.not_in_tune,"%%select");continue}a=g(u.slice(7));'"'==a[0]&&(a=a.slice(1,-1));if(!a){delete t.select;continue}a=a.replace(/\(/g,"\\(");a=a.replace(/\)/g,"\\)");t.select=new RegExp(a,"m");continue;case "tune":if(0!=t.state){y(1,J.not_in_tune,"%%tune");continue}a=g(p[2]);
if(!a){t.tune_opts={};continue}if("end"==a)continue;t.tune_opts||(t.tune_opts={});for(t.tune_opts[a]=a={t_opts:[]};;){d=++B;if("%"!=c[d])break;B=c.indexOf("\n",B);if(c[d+1]==v){d+=2;u=0>B?c.slice(d):c.slice(d,B);p=u.match(/([^\s]+)\s*(.*)/);switch(p[1]){case "tune":break;case "voice":l(g(p[2],!0),!0);continue;default:a.t_opts.push(g(u,!0));continue}break}}t.tune_v_opts&&(a.v_opts=t.tune_v_opts,t.tune_v_opts=null);t.eol=d-1;continue;case "voice":if(0!=t.state){y(1,J.not_in_tune,"%%voice");continue}a=
g(p[2]);if(!a){t.voice_opts=null;continue}l(a);continue}X.do_pscom(g(u,!0))}}}else if(":"==v&&/[A-Za-z+]/.test(z)){for(d+=2;;){switch(c[d]){case " ":case "\t":d++;continue}break}if("+"==z){if(!A){y(1,"+: without previous info field");continue}n=" ";z=A}u=g(c.slice(d,B),z);switch(z){case "X":if(0!=t.state){y(1,J.ignored,z);continue}if(t.select&&!f()){B=c.indexOf("\nX:",t.eol);0>B&&(B=e);t.eol=B;continue}Ka.cfmt=x(r);Ka.info=x(S,2);Ka.char_tb=x(La);Ka.glovar=x(oa);Ka.maps=x(mb,1);Ka.mac=x(ub);Ka.maci=
x(nc);S.X=u;t.state=1;q.page_format&&1>Ua&&(Ua=1);t.tune_opts&&k();continue;case "T":switch(t.state){case 0:continue;case 1:case 2:S.T=void 0==S.T?u:S.T+("\n"+u);continue}a=Ia("title");a.text=u;continue;case "K":switch(t.state){case 0:continue;case 1:S.K=u}Oc(z,u);continue;case "W":if(0==t.state||0>r.writefields.indexOf(z))break;S.W=void 0==S.W?u:S.W+(n+u);break;case "m":if(2<=t.state){y(1,J.ignored,z);continue}p=u.match(/(.*?)[= ]+(.*)/);if(!p||!p[2]){y(1,J.bad_val,"m:");continue}ub[p[1]]=p[2];nc[p[1][0]]=
!0;break;case "s":if(3!=t.state||0>r.writefields.indexOf(z))break;jf(u," "==n);break;case "w":if(3!=t.state||0>r.writefields.indexOf(z))break;kf(u," "==n);break;case "|":if(2>t.state)continue;t.line.buffer=u;Jd();continue;default:if(0<="ABCDFGHNOSZ".indexOf(z)){if(2<=t.state){y(1,J.ignored,z);continue}S[z]=S[z]?S[z]+(n+u):u}else{Oc(z,u);continue}}n="\n";var A=z}else A=void 0,2>t.state||(t.line.buffer=g(c.slice(d,B)),t.line.buffer&&Jd())}}Lb||(2<=t.state&&h(),t.state=0)}function jc(a,c){var d,e=0,
f=c;0!=f%12&&u(1,a,"Invalid note duration $1",f);(f/=12)||u(1,a,"Note too short");for(d=5;0!=f&&!(f&1);f>>=1,d--);f>>=1;for(f+1&f&&(a.type!=m.REST||c!=a.p_v.wmeasure)&&u(0,a,"Non standard note duration $1",c);0<f>>e;)e++;d-=e;if(0<=d)a=m.FULL;else switch(d){default:u(1,a,"Note too long"),d=-4;case -4:a=m.SQUARE;break;case -3:a=a.fmt.squarebreve?m.SQUARE:m.OVALBARS;break;case -2:a=m.OVAL;break;case -1:a=m.EMPTY}return[a,e,d]}function Kd(a){var c,d=a.stem;if(c=a.nhd){var e=.74*Ld[a.head];a.grace&&(e*=
.6);if(0<=d){var f=1;var g=c+1;c=a.notes[0].pit}else e=-e,f=c-1,g=-1,c=a.notes[c].pit;for(var h=!1,l=0;f!=g;f+=d){var k=a.notes[f].pit-c;c=a.notes[f].pit;if(!k){if(h){k=a.notes[f].shhd=a.notes[f-d].shhd+e;l<k&&(l=k);continue}if(f+d!=g&&c+d==a.notes[f+d].pit){a.notes[f].shhd=-e;l<-e&&(l=-e);continue}}0>k&&(k=-k);if(3<k||2<=k&&a.head!=m.SQUARE)h=!1;else if(h=!h)a.notes[f].shhd=e,l<e&&(l=e)}a.xmx=l}}function Md(a,c){var d,e,f,g,h=a.length;for(d=h-1;0<=--d;)if((g=a[d].shhd)&&!(0<g)){g=c-g;var l=a[d].pit;
for(e=h;0<=--e;)if(a[e].acc){var k=a[e].pit;if(k<l-3)break;!(k>l+3)&&a[e].shac<g&&(a[e].shac=g)}}for(e=h;0<=--e;)if(a[e].acc){k=a[e].pit;var m=a[e].shac;m||(m=a[e].shhd,m=0>m?c-m:c);break}if(!(0>e)){for(f=0;f<e;f++)if(a[f].acc){l=a[f].pit;var n=a[f].shac;n||(n=a[f].shhd,n=0>n?c-n:c);break}if(e==f)a[e].shac=m;else for(k>l+4?(m>n&&(n=m),a[e].shac=a[f].shac=n):(a[e].shac=m,k!=l&&(m+=7),a[f].shac=n=m),n+=7,d=e;--d>f;)if(c=a[d].acc){g=a[d].shac;g<n&&(g=n);l=a[d].pit;for(e=h;--e>d;)a[e].acc&&(k=a[e].pit,
!(k>=l+4&&(k>l+4||0>c||0>a[e].acc))&&g>a[e].shac-6&&(m=a[e].shac+7,m>g&&(g=m)));a[d].shac=g}}}function oc(a,c){a.next=c;a.prev=c.prev;a.prev?a.prev.next=a:a.p_v.sym=a;c.prev=a}function Sb(a,c){(a.ts_next=c)?(a.ts_prev=c.ts_prev,a.ts_prev&&(a.ts_prev.ts_next=a),c.ts_prev=a):(u(2,a,"Bad linkage"),a.ts_prev=null);a.seqst=!a.ts_prev||a.time!=a.ts_prev.time||Pa[a.ts_prev.type]!=Pa[a.type]&&0!=Pa[a.ts_prev.type]||a.ts_prev.v>=a.v;c&&(c.seqst=c.time!=a.time||Pa[a.type]!=Pa[c.type]&&0!=Pa[a.type],c.seqst&&
(X.set_width(c),c.a_ly&&pc(c),c.shrink=c.wl,c.prev&&(c.shrink+=c.prev.wr),c.space=0))}function sb(a){a.next&&(a.next.prev=a.prev);a.prev?a.prev.next=a.next:a.p_v.sym=a.next;a.ts_next&&(a.seqst?a.ts_next.seqst?(a.ts_next.shrink+=a.shrink,a.ts_next.space+=a.space):(a.ts_next.seqst=!0,a.ts_next.shrink=a.shrink,a.ts_next.space=a.space):a.ts_next.seqst&&a.ts_prev&&a.ts_prev.seqst&&!Pa[a.ts_prev.type]&&(a.ts_next.seqst=!1,a.shrink=a.ts_next.shrink,a.space=a.ts_next.space),a.ts_next.ts_prev=a.ts_prev);a.ts_prev&&
(a.ts_prev.ts_next=a.ts_next);N==a&&(N=a.ts_next);Sa==a&&(Sa=a.ts_next)}function Nd(a,c,d){var e=a.p_v,f=a.st;a.type==m.BAR&&a.prev&&a.prev.type==m.BAR&&":"!=a.prev.bar_type[0]&&(a=a.prev);e.last_sym=a.prev;e.last_sym||(e.sym=null);e.time=a.time;e=Od(e,m.CLEF);e.next=a;a.prev=e;e.clef_type=c;e.clef_line=d;e.st=f;e.clef_small=!0;delete e.second;e.notes=[];e.notes[0]={pit:a.notes[0].pit};for(e.nhd=0;!a.seqst;)a=a.ts_prev;a.type==m.STAVES?(e.ts_next=a.ts_next,e.ts_next.ts_prev=a.ts_next=e,e.ts_prev=
a):(Sb(e,a),a.soln&&(e.soln=!0,delete a.soln));return e}function Pd(a,c,d){var e,f=0;for(e=0;e<a.a_gch.length;e++){var g=a.a_gch[e];switch(g.type){case "<":g=g.text.wh[0]+c;g>d&&(d=g);break;case ">":g=g.text.wh[0]+a.wr,g>f&&(f=g)}}a.wr<f&&(a.wr=f);return d}function Qd(a,c){Pc>=m.BLEN/2?c=Pc>=m.BLEN?c/4:c/2:!a.next&&c>=m.BLEN&&(c/=2);a=c>=m.BLEN/4?c<m.BLEN/2?5:c<m.BLEN?6:c<2*m.BLEN?7:c<4*m.BLEN?8:9:c>=m.BLEN/8?4:c>=m.BLEN/16?3:c>=m.BLEN/32?2:c>=m.BLEN/64?1:0;var d=c-(m.BLEN/16/8<<a);var e=vb[a];d&&
(0>d?e=vb[0]*c/(m.BLEN/16/8):(9<=a&&(a=8),e+=(vb[a+1]-vb[a])*d/(m.BLEN/16/8<<a)));return e}function Qc(a,c){var d;var e=a.time-c;if(!e){switch(a.type){case m.MREST:return a.wl}return 0}if(a.ts_prev.type==m.MREST)return 71;for(d=Qd(a,e);!a.dur;){switch(a.type){case m.BAR:return.9*d-7;case m.CLEF:return d-a.wl-a.wr;case m.BLOCK:case m.PART:case m.REMARK:case m.STAVES:case m.TEMPO:a=a.ts_next;if(!a)return d;continue}break}if(a.dur&&e<=m.BLEN/4)for(e=a;e;){if(!e.beam_st){d*=.9;break}e=e.ts_next;if(!e||
e.seqst)break}if(a.type==m.NOTE&&-1<=a.nflags&&0<a.stem){var f=!0;for(e=a.ts_prev;e&&e.time==c;e=e.ts_prev)if(e.type==m.NOTE&&(-1>e.nflags||0<e.stem)){f=!1;break}if(f){for(e=a.ts_next;e&&e.time==a.time;e=e.ts_next)if(e.type==m.NOTE&&(-1>e.nflags||0>e.stem)){f=!1;break}f&&(d*=.9)}}return d}function Rd(a){return{type:m.BAR,bar_type:"|",fname:a.fname,istart:a.istart,iend:a.iend,v:a.v,p_v:a.p_v,st:a.st,dur:0,nhd:0,notes:[{pit:a.notes?a.notes[0].pit:22}],prev:a,fmt:a.fmt}}function qc(a){var c=x(a);c.prev.next=
a.ts_prev=a.prev=c.ts_prev.ts_next=c;c.next=c.ts_next=a;a.seqst=!1;a.invis=a.play=!0;c.type=m.REST;delete c.in_tuplet;delete c.sl1;delete c.a_dd;delete c.a_gch;delete c.sls;return c}function lf(a){var c,d,e,f=a.repeat_n,g=a.repeat_k,h=a.st,l=a.v;a.repeat_n=0;if(0>f){var k=f=-f;for(d=a.prev;d;d=d.prev)if(!d.dur){if(d.type==m.BAR){u(1,d,"Bar in repeat sequence");return}}else if(0>=--k)break;if(d){var p=a.time-d.time;k=g*f;for(c=a;c;c=c.next)if(!c.dur){if(c.type==m.BAR){u(1,c,"Bar in repeat sequence");
return}}else if(0>=--k)break;if(c&&c.next){for(c=a.prev;c!=d;c=c.prev)if(c.type==m.NOTE){c.beam_end=!0;break}for(e=g;0<=--e;){k=f;a.dur&&k--;for(c=a.ts_next;0<k;)c.st==h&&(c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1),c.v==l&&c.dur&&k--),c=c.ts_next;a=qc(a);a.dur=a.notes[0].dur=p;a.rep_nb=-1;a.beam_st=!0;X.set_width(a);a.head=m.SQUARE;for(a=c;a&&(a.st!=h||a.v!=l||!a.dur);a=a.ts_next);}}else u(1,a,J.not_enough_n)}else u(1,a,J.not_enough_n)}else{k=f;for(c=a.prev.prev;c&&(c.type!=m.BAR&&c.time!=
N.time||!(0>=--k));c=c.prev);if(c){p=a.time-c.time;k=1==f?g:f;for(c=a;c&&!(c.type==m.BAR&&0>=--k);c=c.next);if(c){k=g;if(2==f&&1<k){c=c.next;if(!c){u(1,a,J.not_enough_m);return}c.repeat_n=f;c.repeat_k=--k}p/=f;if(2==f){for(c=a.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==l)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=qc(a);d.dur=d.notes[0].dur=p;d.invis=!0;c.bar_mrep=2;d=c.next;for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==l)break}else c.invis=
c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=qc(d);d.dur=d.notes[0].dur=p;d.invis=!0;X.set_width(d)}else for(d=a,e=g;0<=--e;){for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==l)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=qc(d);d.dur=d.notes[0].dur=p;d.beam_st=!0;if(1==g){d.rep_nb=1;break}d.rep_nb=g-e+1;d=c.next}}else u(1,a,J.not_enough_m)}else u(1,a,J.not_enough_m)}}function rc(a){function c(a){if(r.custos&&1==D.length)a:{for(var c=a,d,e,f=c;f.type!=
m.NOTE;)if(f=f.next,!f)break a;d=c.p_v;d.last_sym=c.prev;d.time=c.time;d=Od(d,m.CUSTOS);d.next=c;c.prev=d;Sb(d,c);d.shrink=c.shrink;12>d.shrink&&(d.shrink=12);d.space=f.space;d.wl=0;d.wr=4;d.nhd=f.nhd;d.notes=[];for(e=0;e<c.notes.length;e++)d.notes[e]={pit:f.notes[e].pit,shhd:0,dur:m.BLEN/4};d.stemless=!0}a.nl=!0;a=a.ts_prev;a.type!=m.BAR&&(c=Rd(a),c.seqst=!0,c.invis=!0,c.time=a.time+a.dur/2,c.wl=0,c.wr=0,c.ts_prev=a,c.next=a.next,c.ts_next=a.ts_next,c.shrink=a.wr+3,a.next&&(a.next.prev=c),a.ts_next.ts_prev=
c,a.next=a.ts_next=c,c.space=Qc(c,a.time))}var d;a=function(a){var c,d;for(c=a;c.ts_prev&&c.ts_prev.time==a.time;)c=c.ts_prev,c.bar_type&&(d=c);if(!d)return a;for(c=a;;c=c.ts_next){switch(c.type){default:if(Pa[c.type])break;case m.KEY:case m.METER:case m.CLEF:continue}break}for(;d!=a;){if(d.bar_type&&(":"==d.bar_type.slice(-1)||d.text)&&":"!=d.bar_type){var e=d.bar_type.match(/(:*)([^:]*)(:*)/);if(e[3])if(e[1]){var f=e[2].length/2|0;var p=e[1]+"|"+e[2].slice(0,f);e=e[2].slice(f)+"|"+e[3]}else p="["==
e[2][0]?e[2].slice(1):e[2],e="[|"+e[3];else p=e[1]+e[2],e="[";f=x(d);d.bar_type=p;delete d.rbstop;f.bar_type=e;for(oc(f,d.next);!(c.type!=m.BAR||c.v>f.v);)c=c.ts_next;Sb(f,c);c==a&&(a=f);d.text&&(f.invis=!0,delete d.text,delete d.rbstart);delete f.a_dd}d=d.ts_next}return a}(a);(function(a){var c,d;for(d=a;d;d=d.ts_next){switch(d.type){case m.KEY:if(!a.fmt.keywarn||d.invis)continue;for(c=a.ts_prev;c&&c.type==m.METER;c=c.ts_prev);case m.METER:if(d.type==m.METER){if(!a.fmt.timewarn)continue;c=a.ts_prev}case m.CLEF:if(!d.prev)continue;
if(d.type==m.CLEF)for(c=a.ts_prev;c;c=c.ts_prev){switch(c.type){case m.BAR:case m.KEY:case m.METER:continue}break}var e=x(d);Sb(e,c.ts_next);e.ts_next==a&&(a.seqst=!0);for(c=e;c=c.ts_next,c.v!=d.v;);oc(e,c);e.seqst&&(e.shrink=e.wl,e.prev&&(e.shrink+=e.prev.wr),e.space=Qc(e,e.ts_prev.time),e.next.shrink=e.wr+e.next.wl);continue}if(Pa[d.type])break}})(a);switch(a.ts_prev.type){case m.STAVES:break;case m.GRACE:if(a=a.next,!a)return a;default:return c(a),a}for(a=a.ts_prev;a&&(!a.seqst||a.type==m.CLEF);a=
a.ts_prev);var e=0;for(d=a.type;;a=a.ts_next){if(!a)return a;if(a.type!=d){d=a.type;if(0>e)break;switch(a.type){case m.STAVES:if(!a.ts_prev)return;if(a.ts_prev.type==m.BAR)break;for(;a.ts_next&&(0==Pa[a.ts_next.type]||a.ts_next.type==m.CLEF);)a=a.ts_next;if(!a.ts_next||a.ts_next.type!=m.BAR)continue;a=a.ts_next;case m.BAR:if(e)break;e=1;continue;case m.STBRK:a.stbrk_forced?e=-1:sb(a);continue;case m.CLEF:if(e)break;continue;default:if(!e||a.prev&&a.prev.type==m.GRACE)continue}break}}c(a);return a}
function Sd(){var a=D[0];X.set_width(a.clef);X.set_width(a.ckey);X.set_width(a.meter);return[a.clef.wl+a.clef.wr+a.ckey.wl+a.ckey.wr,a.meter.wl+a.meter.wr]}function Td(a,c){for(var d,e,f=0,g=0,h=1-a.fmt.maxshrink;a!=c;)a.seqst&&(d=a.shrink,g+=d,f=(e=a.space)<d?f+d:f+(d*a.fmt.maxshrink+e*h),a.x=f),a=a.ts_next;c&&(g+=c.wr);return[f,g]}function mf(a,c,d,e){var f,g=c?c.ts_prev:null;var h=Td(a,c);a.fmt.keywarn&&c&&c.type==m.KEY&&!g.dur&&(h[0]+=c.wr,h[1]+=c.wr);if(h[1]+e<d)return c&&(c=rc(c)),c||g;for(f=
h[0]+e;;){var l=Math.ceil(f/d);if(1>=l)return c&&(c=rc(c)),c||g;var k=h=a;var p=a.x-a.shrink-e;var n=p+d;e=p+f/l;p+=f/l*a.fmt.breaklimit;for(a=a.ts_next;a!=c&&!(a.x&&(a.type==m.BAR&&(k=a),a.x>=p));a=a.ts_next);if(a==c)return c&&(c=rc(c)),c;for(l=null;a!=c;a=a.ts_next)if(p=a.x){if(p>n)break;if(a.type==m.BAR)if(p<e)l=a;else{if(!l||p-e<e-l.x)l=a;break}}if(!l){var t=0,z=k.time;n-=8;for(a=k;a!=c;a=a.ts_next)if(a.beam_st&&t++,a.beam_end&&0<t&&t--,p=a.x){if(p+a.wr>=n)break;if(!t&&!a.in_tuplet)if(0==(a.time-
z)%(m.BLEN/4))l=a;else if(!l||a.x<e)l=a;else{if(l>e)break;if(e-l.x<a.x-e)break;l=a;break}}}if(!l)for(l=a=k;a!=c;a=a.ts_next)if(p=a.x)if(a.x<e)l=a;else{if(l>e)break;if(e-l.x<a.x-e)break;l=a;break}for(a=l;a.ts_next&&(a=a.ts_next,!a.seqst););if(a.nl)for(u(0,a,"Line split problem - adjust maxshrink and/or breaklimit"),l=2,a=a.ts_next;a!=c&&!(a.x&&0>=--l);a=a.ts_next);a=rc(a);if(!a||c&&a.time>=c.time)break;f-=a.x-h.x;e=0}return a}function Rc(a){switch(a.type){case m.CLEF:if(a.second||a.invis){a.ymx=a.ymn=
12;break}a.y=6*(a.clef_line-1);switch(a.clef_type){default:a.ymx=a.y+28;a.ymn=a.y-14;break;case "c":a.ymx=a.y+13;a.ymn=a.y-11;break;case "b":a.ymx=a.y+7,a.ymn=a.y-12}a.clef_small&&(a.ymx-=2,a.ymn+=2);26>a.ymx&&(a.ymx=26);-1<a.ymn&&(a.ymn=-1);a.clef_octave&&(0<a.clef_octave?a.ymx+=12:a.ymn-=12);break;case m.KEY:a.ymx=2<a.k_sf?34:0<a.k_sf?30:26;a.ymn=-2;break;default:a.ymx=24,a.ymn=0}}function nf(){function a(a,c,d){var e=["15mb(","8vb(",null,"8va(","15ma("],f=["15mb)","8vb)",null,"8va)","15ma)"];Hb([(d?
e:f)[2+c]],a)}var c,d,e,f,g=U+1,h=new Int16Array(Array(2*g)),l=new Int8Array(Array(g));for(d=0;d<=U;d++)h[d]=0,l[d]=0;for(c=N;c;c=c.ts_next){d=c.st;if(void 0!=c.ottava)for(;c.ottava.length;)(e=c.ottava.shift())?0==l[d]++&&(a(c,e,!0),h[d]=7*-e):0==--l[d]&&(a(c,-h[d]/7),h[d]=0);switch(c.type){case m.REST:if(1==D.length)break;case m.NOTE:if((e=h[d])&&!c.p_v.ckey.k_drum)for(g=c.nhd;0<=g;g--){var k=c.notes[g];k.opit||(k.opit=k.pit);k.pit+=e}break;case m.GRACE:for(f=c.extra;f;f=f.next)if((e=h[d])&&!c.p_v.ckey.k_drum)for(g=
0;g<=f.nhd;g++)k=f.notes[g],k.opit||(k.opit=k.pit),k.pit+=e}}}function Sc(a,c,d){var e;var f=12;var g=20;for(e=c;e&&(e.type!=m.STAVES||e==c);e=e.ts_next)if(e.st==a)if(e.type!=m.NOTE){if(e.type==m.CLEF){if("a"!=e.clef_type)break;sb(e)}}else e.notes[0].pit<g&&(g=e.notes[0].pit),e.notes[e.nhd].pit>f&&(f=e.notes[e.nhd].pit);if(19<=g||13<=g&&"b"!=d)return"t";if(13>=f||19>=f&&"t"!=d)return"b";"a"==d&&(d=16<=(f+g)/2?"t":"b");g=d;var h=e,l=null;for(e=c;e!=h&&(e.type!=m.STAVES||e==c);e=e.ts_next)if(e.st==
a&&e.type==m.NOTE){var k=e.time;if("t"==g){if(12<e.notes[0].pit||20<e.notes[e.nhd].pit){20<e.notes[0].pit&&(l=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==m.NOTE&&19<=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==m.NOTE&&19<=f.notes[0].pit)continue}else{if(12>e.notes[0].pit||20>e.notes[e.nhd].pit){12>e.notes[e.nhd].pit&&(l=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==m.NOTE&&13>=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==
m.NOTE&&13>=f.notes[0].pit)continue}if(l){k=e;for(f=e.ts_prev;f!=l;f=f.ts_prev)if(f.st==a){if(f.type==m.BAR&&f.v==e.v){k=":"!=f.bar_type[0]?f:f.next;break}f.type==m.NOTE&&f.beam_st&&!f.p_v.second&&(k=f)}k.time==l.time?l=e:(l=e,g="t"==g?"b":"t",f=Nd(k,g,"t"==g?2:4),f.clef_auto=!0)}else g=d="t"==g?"b":"t",l=e}return d}function sc(a,c,d){a.p_v=c;a.v=c.v;a.st=c.st;a.time=d.time;c.last_sym&&(a.next=c.last_sym.next,a.next&&(a.next.prev=a),c.last_sym.next=a,a.prev=c.last_sym);c.last_sym=a;Sb(a,d)}function of(){var a,
c,d;var e=D.length;for(c=0;c<e;c++)if(L.voices[c]){var f=D[c];f.second=L.voices[c].second;f.last_sym=f.sym;for(a=L.voices[c].st;a<U&&!L.st_print[a];)a++;f.st=a;f.second||(A[a].key=f.ckey,A[a].meter=f.meter)}var g=N;for(d=g.fmt;g;){switch(g.type){case m.CLEF:case m.KEY:case m.METER:switch(g.type){case m.CLEF:A[g.st].clef=g;break;case m.KEY:g.p_v.ckey=g;break;case m.METER:g.p_v.meter=g,Zb|=1}sb(g);case m.PART:case m.TEMPO:case m.BLOCK:case m.REMARK:g=g.ts_next;continue}break}var h=N;for(c=0;c<e;c++)f=
D[c],!L.voices[c]||L.voices[c].second&&!f.bar_start||(a=L.voices[c].st,A[a]&&A[a].clef&&(g=x(A[a].clef),g.v=c,g.p_v=f,g.st=a,g.time=N.time,g.prev=null,g.next=f.sym,g.next&&(g.next.prev=g),f.sym=f.last_sym=g,g.ts_next=h,g.ts_prev=h?h.ts_prev:null,g.ts_prev?(g.ts_prev.ts_next=g,delete g.seqst):N=g,h&&(h.ts_prev=g,h.type==m.CLEF&&delete h.seqst),delete g.clef_small,g.second=L.voices[c].second,L.st_print[a]||(g.invis=!0),g.fmt=d));for(c=0;c<e;c++)L.voices[c]&&!L.voices[c].second&&L.st_print[L.voices[c].st]&&
(f=D[c],a=f.ckey,a.k_sf||a.k_a_acc)&&(g=x(a),sc(g,f,h),delete g.invis,g.k_old_sf=a.k_sf,g.fmt=d);if(Zb&1){for(c=0;c<e;c++)f=D[c],a=f.meter,L.voices[c]&&!L.voices[c].second&&L.st_print[L.voices[c].st]&&a.a_meter.length&&(g=x(a),sc(g,f,h),g.fmt=d);Zb&=-2}for(c=0;c<e;c++)f=D[c],f.sls.length&&(g={type:m.BAR,fname:h.fname,bar_type:"|",dur:0,multi:0,invis:!0,sls:f.sls,fmt:d},sc(g,f,h),f.sls=[]);for(c=0;c<e;c++){f=D[c];a=f.bar_start;f.bar_start=null;for(g=h;g&&g.time==h.time;g=g.ts_next)if(g.rbstop){a=null;
break}a&&L.voices[c]&&L.st_print[L.voices[c].st]&&(f.last_sym.type==m.BAR?f.last_sym.rbstop||(f.last_sym.rbstart=1):(sc(a,f,h),a.fmt=d))}X.set_pitch(h);g=N;g.seqst=!0;for(e=0;;){a=g;d=c=0;do X.set_width(g),f=g.wl+e,f>c&&(c=f),g.wr>d&&(d=g.wr),g=g.ts_next;while(g!=h&&!g.seqst);a.shrink=c;a.space=0;if(g==h)break;e=d}f=0;do X.set_width(g),g.a_ly&&pc(g),f<g.wl&&(f=g.wl),g=g.ts_next;while(g&&!g.seqst);h.shrink=d+f;h.space=0}function Tc(a){var c,d,e=D.length,f=0;for(c=0;c<e;c++){var g=D[c];if(L.voices[c]&&
(d=(a||g.new_name)&&g.nm?g.nm:g.snm)){if(!h){V("voice");var h=H.curfont}for(g=0;;){var l=d.indexOf("\n",g);g=0>l?sa(d.slice(g)):sa(d.slice(g,l));g=g[0];g>f&&(f=g);if(0>l)break;g=l+1}}}h&&(f+=4*Rb(" "));g=.5;for(c=0;c<=L.nstaff;c++){if(L.staves[c].flags&1280){g=12;break}L.staves[c].flags&5&&(g=6)}f+=g;a&&(f+=r.indent);return f}function pf(a,c){var d,e,f,g=a.fmt.shiftunison||0;if(3<=g||(e=a.dur)>=m.BLEN||(f=c.dur)>=m.BLEN||a.stemless&&c.stemless||a.dots!=c.dots&&(g&1||0!=a.dots*c.dots)||0<a.stem*c.stem)return!1;
var h=d=0;if(a.notes[0].pit>c.notes[0].pit){if(0>a.stem)return!1;for(;c.notes[d].pit!=a.notes[0].pit;)if(++d>c.nhd)return!1}else if(a.notes[0].pit<c.notes[0].pit){if(0>c.stem)return!1;for(;c.notes[0].pit!=a.notes[h].pit;)if(++h>a.nhd)return!1}if(c.notes[d].acc!=a.notes[h].acc)return!1;var l=h;var k=d;var p=a.notes[h].shhd;var n=c.notes[d].shhd;do{h++;d++;if(h>a.nhd)break;if(d>c.nhd)break;if(c.notes[d].acc!=a.notes[h].acc)return!1;p<a.notes[h].shhd&&(p=a.notes[h].shhd);n<c.notes[d].shhd&&(n=c.notes[d].shhd)}while(c.notes[d].pit==
a.notes[h].pit);if(h<=a.nhd){if(d<=c.nhd||0<c.stem)return!1}else if(d<=c.nhd&&0<a.stem)return!1;var t=h;h=d;d=0;if(e!=f)if(e<f&&(e=f,f=a.dur),e<m.BLEN/2)c.dots?d=2:a.dots&&(d=1);else if(f<m.BLEN/4){if(g&2)return!1;d=c.dur>=m.BLEN/2?2:1}else return!1;d||(d=a.p_v.scale<c.p_v.scale?2:1);if(1==d){for(d=k;d<h;d++)c.notes[d].invis=!0,delete c.notes[d].acc;for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=p}else{for(h=l;h<t;h++)a.notes[h].invis=!0,delete a.notes[h].acc;for(h=0;h<=a.nhd;h++)a.notes[h].shhd+=n}return!0}
function qf(a,c,d,e){var f;if(f=c.notes[e].acc){e=2*tc[a.head]+a.xmx+c.notes[e].shac+2;"object"==typeof f&&(e+=2);a.dots&&(e+=6);for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=e,c.notes[d].shac-=e;c.xmx+=e}else{e=2*tc[c.head]+c.xmx+a.notes[d].shac+2;f=a.notes[d].acc;"object"==typeof f&&(e+=2);c.dots&&(e+=6);for(d=0;d<=a.nhd;d++)a.notes[d].shhd+=e,a.notes[d].shac-=e;a.xmx+=e}}function Uc(a){var c,d=tc[a.head],e=d,f=[];for(c=0;96>c;c++)f.push(-100);if(-2<a.nflags){if(0<a.stem){e=-e;c=2*a.notes[0].pit;var g=
2*(Math.ceil((a.ymx-2)/3)+18)}else c=2*(Math.ceil((a.ymn+2)/3)+18),g=2*a.notes[a.nhd].pit;0>c&&(c=0);for(96<=g&&(g=95);c<=g;)f[c++]=e}var h=a.notes[0<a.stem?0:a.nhd].shhd;for(g=0;g<=a.nhd;g++)e=-a.notes[g].shhd+d+h,c=2*a.notes[g].pit,0>c?c=0:95<=c&&(c=94),e>f[c]&&(f[c]=e),a.head!=m.SQUARE&&--e,e>f[c-1]&&(f[c-1]=e),e>f[c+1]&&(f[c+1]=e);return f}function Vc(a){var c,d=tc[a.head],e=d,f=0<a.nflags&&a.beam_st&&a.beam_end,g=[];for(c=0;96>c;c++)g.push(-100);if(-2<a.nflags){if(0>a.stem){e=-e;c=2*(Math.ceil((a.ymn+
2)/3)+18);var h=2*a.notes[a.nhd].pit;var l=c+4}else c=2*a.notes[0].pit,h=2*(Math.ceil((a.ymx-2)/3)+18);0>c&&(c=0);for(96<h&&(h=96);c<h;)g[c++]=e}if(f)if(0<a.stem)for(c=0==a.xmx?2*a.notes[a.nhd].pit:2*a.notes[0].pit,c+=4,0>c&&(c=0);96>c&&c<=h-4;c++)g[c]=11;else for(c=l,0>c&&(c=0);96>c&&c<=2*a.notes[0].pit-4;c++)g[c]=3.5;l=a.notes[0<a.stem?0:a.nhd].shhd;for(h=0;h<=a.nhd;h++)e=a.notes[h].shhd+d-l,c=2*a.notes[h].pit,0>c?c=0:95<=c&&(c=94),e>g[c]&&(g[c]=e),a.head!=m.SQUARE&&--e,e>g[c-1]&&(g[c-1]=e),e>g[c+
1]&&(g[c+1]=e);return g}function rf(){function a(){p=d;d=c;v=q;x=u;A=n;l=h}var c,d,e,f,g,h,l,k=L;for(c=N;c;c=c.ts_next)if(c.type!=m.NOTE||c.invis)c.type==m.STAVES&&(k=c.sy);else{if(c.xstem&&0>c.ts_prev.stem)for(e=0;e<=c.nhd;e++)c.notes[e].shhd-=7,c.notes[e].shac+=16;for(d=c;;){d=d.ts_next;if(!d)break;if(d.time!=c.time){d=null;break}if(d.type==m.NOTE&&!d.invis&&d.st==c.st)break}if(d){var p=c;k.voices[p.v].range<k.voices[d.v].range?d.dot_low=!0:p.dot_low=!0;if(!(p.ymn>d.ymx||p.ymx<d.ymn||pf(p,d)))if(p.dots||
d.dots||!(0<p.stem&&0>d.stem&&p.notes[0].pit==d.notes[d.nhd].pit+1||0>p.stem&&0<d.stem&&p.notes[p.nhd].pit+1==d.notes[0].pit)){var n=Vc(p);var t=Uc(d);if((e=p.ts_prev)&&e.time==p.time&&e.st==p.st&&e.type==m.NOTE&&!e.invis){var z=Vc(e);for(f=0;96>f;f++)z[f]>n[f]&&(n[f]=z[f])}else e=null;var v=-10;for(f=0;96>f;f++)t[f]+n[f]>v&&(v=t[f]+n[f]);if(!(-3>v&&(d.notes[0].pit&1||!p.dots&&!d.dots||!(p.notes[p.nhd].pit==d.notes[0].pit+2&&p.dot_low||p.notes[p.nhd].pit+2==d.notes[0].pit&&d.dot_low)))){var r=Vc(d);
var u=Uc(p);if(e)for(z=Uc(e),f=0;96>f;f++)z[f]>u[f]&&(u[f]=z[f]);var q=h=l=-100;for(f=0;96>f;f++)u[f]+r[f]>q&&(q=u[f]+r[f]),r[f]>l&&(l=r[f]),n[f]>h&&(h=n[f]);f=0;z=p.nhd;for(g=d.nhd;;){var y=p.notes[z].pit-d.notes[g].pit;switch(y){case 2:p.notes[z].pit&1||(p.dot_low=!1);break;case 1:p.notes[z].pit&1?d.dot_low=!0:p.dot_low=!1;break;case 0:if(p.notes[z].acc!=d.notes[g].acc){f=-1;break}d.notes[g].acc&&(p.notes[z].acc||(p.notes[z].acc=d.notes[g].acc),d.notes[g].acc=0);p.dots&&d.dots&&p.notes[z].pit&1&&
(f=1);break;case -1:p.notes[z].pit&1?d.dot_low=!1:p.dot_low=!0;break;case -2:p.notes[z].pit&1||(d.dot_low=!1)}if(0>f)break;if(0<=y&&0>--z)break;if(0>=y&&0>--g)break}if(0>f)qf(p,d,z,g);else{g=0;p.dots?d.dots?f||(g=1):a():d.dots&&q+h<v+l&&(g=1);var x=t;var A=r;!e&&q+h<v+l&&a();v+=3;0>v&&(v=0);e=0<=p.stem?0:p.nhd;v+=p.notes[e].shhd;e=0<=d.stem?0:d.nhd;v-=d.notes[e].shhd;if(p.dots)if(e=7.7+p.xmx+3.5*p.dots-3.5+3,!g){q=-100;for(z=0;z<=p.nhd;z++)f=p.notes[z].pit,f&1||(p.dot_low?f--:f++),f*=2,1>f?f=1:95<=
f&&(f=94),x[f]>q&&(q=x[f]),x[f-1]+1>q&&(q=x[f-1]+1),x[f+1]+1>q&&(q=x[f+1]+1);e+q+2>v&&(v=e+q+2)}else if(e<v+l+d.xmx){for(z=q=0;z<=p.nhd;z++)f=p.notes[z].pit,f&1||(p.dot_low?f--:f++),f*=2,1>f?f=1:95<=f&&(f=94),A[f]>q&&(q=A[f]),A[f-1]+1>q&&(q=A[f-1]=1),A[f+1]+1>q&&(q=A[f+1]+1);4.5<q&&7.7+p.xmx+2<v+q+d.xmx&&(d.xmx=q+3-7.7)}for(e=d.nhd;0<=e;e--)d.notes[e].shhd+=v;d.xmx+=v;g&&(p.xmx=d.xmx)}}}else{0>p.stem&&(p=d,d=c);v=p.notes[0].shhd+7;for(e=0;e<=d.nhd;e++)d.notes[e].shhd+=v;d.xmx+=v;p.xmx=d.xmx}}}}function sf(a){for(var c=
N;c&&!c.nl;c=c.ts_next)c.st==a&&c.type!=m.CLEF&&(c.st++,c.invis=!0)}function tf(){function a(a){var c=A[a],d=h.staves[a];c||(c=A[a]={});c.y=0;c.stafflines=d.stafflines;c.staffscale=d.staffscale;c.ann_top=c.ann_bot=0}function c(){var a,c,d=h.staves.length;for(a=0;a<d;a++)if(h.staves[a].flags&257){var e=0;for(c=a;a<d;){e|=f[a]?1:2;if(h.staves[a].flags&514)break;a++}if(3==e)for(;c<=a;)f[c]=!0,g[c++]=!0}}var d,e,f=[],g=[],h=L;if(N.type==m.STAVES){var l=N;N=N.ts_next;N.ts_prev=null;l.seqst&&(N.seqst=!0);
if(l.p_v.sym=l.next)l.next.prev=null}U=h.nstaff;for(d=0;d<=U;d++)a(d);for(l=N;l&&!l.nl;l=l.ts_next){switch(l.type){case m.STAVES:c();h.st_print=new Uint8Array(f);for(h=l.sy;U<h.nstaff;)a(++U);f=[];continue;case m.BLOCK:l.play?l.ts_next&&l.ts_next.shrink&&(l.ts_next.shrink=0):(uc.push(l),sb(l));continue}d=l.st;if(d>U){switch(l.type){case m.CLEF:A[d].clef=l;break;case m.KEY:l.p_v.ckey=l;break;case m.METER:l.p_v.meter=l}sb(l)}else if(!f[d]){switch(l.type){default:continue;case m.BAR:if(l.bar_mrep||1<
h.staves[d].staffnonote)break;continue;case m.GRACE:break;case m.NOTE:case m.REST:case m.SPACE:case m.MREST:if(!(1<h.staves[d].staffnonote)){if(l.invis)continue;if(!h.staves[d].staffnonote&&l.type!=m.NOTE)continue}}g[d]=f[d]=!0}}Sa=l;c();h.st_print=new Uint8Array(f);(function(){var a,c,d;for(a=0;a<=U;a++){var e=A[a];e.hlu=[];e.hld=[];if(g[a]){var f=e.stafflines.length;e.topbar=6*(f-1);for(c=0;c<f-1;c++){switch(e.stafflines[c]){case ".":case "-":continue}break}e.botline=e.botbar=6*c;if(c>=f-2)if("."!=
e.stafflines[c])e.botbar-=6,e.topbar+=6;else{e.botbar-=12;e.topbar+=12;continue}e.hll=17+2*c;e.hlmap=new Int8Array(Array(2*(f-c+1)));for(d=1;c<f;c++,d+=2)switch(e.stafflines[c]){case "|":case "[":e.hlmap[d-1]=1,e.hlmap[d]=1,e.hlmap[d+1]=1}}else e.botbar=e.topbar=0}})();for(d=0;d<U;d++)g[d]||sf(d);g[U]||(A[U].topbar=0);of();H.st_print=new Uint8Array(g);if(Sa){l=Sa;delete l.nl;l=l.ts_prev;l.ts_next=null;var k=D.length;for(e=0;e<k;e++){d=D[e];if(d.sym&&d.sym.time<=Sa.time){for(l=Sa.ts_prev;l;l=l.ts_prev)if(l.v==
e){d.s_next=l.next;l.next=null;break}if(l)continue}d.s_next=d.sym;d.sym=null}}}function Ud(){for(var a=N,c=a.time;a;a=a.ts_next){if(a.time!=c){wa();return}switch(a.type){case m.NOTE:case m.REST:case m.MREST:case m.SPACE:wa();return;default:continue;case m.STAVES:L=a.sy;continue;case m.BLOCK:if(a.play)continue;X.block_gen(a)}sb(a);a.p_v.s_next==a&&(a.p_v.s_next=a.next)}N=null}function cc(a){a.fname=t.fname;a.istart=t.istart;a.iend=t.iend}function Vd(a){var c={type:m.CLEF,clef_line:2,clef_type:"t",
v:n.v,p_v:n,time:n.time,dur:0},d=1;cc(c);switch(a[0]){case '"':d=a.indexOf('"',1);c.clef_name=a.slice(1,d);d++;break;case "a":if("u"==a[1]){c.clef_type="a";c.clef_auto=!0;d=4;break}d=4;case "C":c.clef_type="c";c.clef_line=3;break;case "b":d=4;case "F":c.clef_type="b";c.clef_line=4;break;case "n":d=4;c.invis=!0;break;case "t":if("e"==a[1]){c.clef_type="c";c.clef_line=4;break}d=6;case "G":break;case "p":d=4;case "P":c.clef_type="p";c.clef_line=3;n.key.k_sf=0;n.ckey.k_sf=0;n.ckey.k_map=abc2svg.keys[7];
n.ckey.k_b40=2;n.ckey.k_drum=!0;break;default:y(1,"Unknown clef '$1'",a);return}"1"<=a[d]&&"9">=a[d]&&(c.clef_line=Number(a[d]),d++);delete n.snd_oct;if("8"!=a[d+1])return c;switch(a[d]){case "^":c.clef_oct_transp=!0;case "+":c.clef_octave=7;c.clef_oct_transp||(n.snd_oct=12);break;case "_":c.clef_oct_transp=!0;case "-":c.clef_octave=-7,c.clef_oct_transp||(n.snd_oct=-12)}return c}function nb(a,c){var d;var e=new O;e.buffer=a;var f=[];for(a=0;2>a;a++)if(d=e.buffer[e.index]?ib(e):null)f[a]=abc2svg.pab40(d.pit,
d.acc);else{if(1!=a||!c){y(1,J.bad_transp);return}f[a]=242}return f[1]-f[0]}function Wd(a){var c;if(c=a.match(/(.)[=\s]*(\[I:.+\]|".+"|!.+!)$/)){a=c[1];var d=c[2];"\\"==a[0]&&("t"==a[1]?a="\t":a[1]||(a=" "));c=a.charCodeAt(0);if(128<=c)y(1,J.not_ascii);else{switch(La[c][0]){case "0":case "d":case "i":case " ":break;case '"':case "!":case "[":if(1<La[c].length)break;default:y(1,"Bad user character '$1'",a);return}switch(d){case "!beambreak!":d=" ";break;case "!ignore!":d="i";break;case "!nil!":case "!none!":d=
"d"}La[c]=d}}else y(1,'Lack of starting [, ! or " in U: / %%user')}function uf(a){if(a){if(/^[\]\[|.-]+$/.test(a))return a.replace(/\]/g,"[");a=parseInt(a);switch(a){case 0:return"...";case 1:return"..|";case 2:return".||";case 3:return".|||"}if(!(isNaN(a)||0>a||16<a))return"||||||||||||||||".slice(0,a)}}function Ia(a){var c={type:m.BLOCK,subtype:a,dur:0};2==t.state&&Fa();"midi"!=a.slice(0,4)&&(n=D[0]);va(c);return c}function mc(a){n.init||(n.init=!0,S.V&&(S.V["*"]&&(a=S.V["*"].concat(a)),S.V[n.id]&&
(a=S.V[n.id].concat(a))));a.length&&X.set_vp(a)}function Kc(a,c){c.length&&(S.V||(S.V={}),S.V[a]?Array.prototype.push.apply(S.V[a],c):S.V[a]=c)}function vf(a){function c(a){var c;if((c=a.match(/(\d+)\/(\d+)/))&&(a=Number(c[2]))&&!isNaN(a)&&!(a&a-1)&&(c=Number(c[1]),!isNaN(c)))return m.BLEN*c/a;y(1,"Invalid note duration $1",f)}var d=a,e={type:m.TEMPO,dur:0};cc(e);0>r.writefields.indexOf("Q")&&(e.invis=!0);if('"'==a[0]){var f=a.match(/"([^"]*)"/);if(!f){y(1,"Unterminated string in Q:");return}e.tempo_str1=
f[1];a=a.slice(f[0].length).replace(/^\s+/,"")}if('"'==a.slice(-1)){var g=a.indexOf('"');e.tempo_str2=a.slice(g+1,-1);a=a.slice(0,g).replace(/\s+$/,"")}g=a.indexOf("=");if(0<g){var h=a.slice(0,g).split(/\s+/);for(a=a.slice(g+1).replace(/^\s+/,"");;){f=h.shift();if(!f)break;g=c(f);if(!g)return;e.tempo_notes||(e.tempo_notes=[]);e.tempo_notes.push(g)}"ca. "==a.slice(0,4)&&(e.tempo_ca="ca. ",a=a.slice(4));g=a.indexOf("/");if(0<g){g=c(a);if(!g)return;e.new_beat=g}else if(e.tempo=Number(a),!e.tempo||isNaN(e.tempo)){y(1,
"Bad tempo value");return}}if(3!=t.state){if(1==t.state){S.Q=d;oa.tempo=e;return}Fa()}va(e);oa.tempo&&0==n.time&&(oa.tempo.invis=!0)}function Oc(a,c){var d;if(!n||!n.ignore||"V"==a)switch(a){case "I":X.do_pscom(c);break;case "L":2==t.state&&Fa();if(d=c.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){var e=Number(d[1]);if(!e||0!=(e&e-1))break;e=m.BLEN/e;var f=d[2]?(f=Number(d[4]))?Number(d[3])/f*m.BLEN:0:e}else"auto"==c&&(e=f=-1);if(!f){y(1,"Bad L: value");break}2>t.state?oa.ulen=e:(n.ulen=e,n.dur_fact=f/e);
break;case "M":a:{d={type:m.METER,dur:0,a_meter:[]};var g={},h=0;var l=0;cc(d);if(0==c.indexOf("none"))l=4,a=1;else for(a=0;l<c.length&&"="!=c[l];){switch(c[l]){case "C":g.top=c[l++];if(!h)var k=h=4;break;case "c":case "o":g.top=c[l++];if(!h)switch(h="c"==c[l-1]?2:3,k=4,c[l]){case "|":k/=2;break;case ".":h*=3,k*=2}break;case ".":case "|":h=0;g.top=c[l++];break;case "(":if("("==c[l+1]){var p=!0;g.top=c[l++];d.a_meter.push(g);g={}}for(e=l+1;e<c.length&&")"!=c[e]&&"/"!=c[e];)e++;if(")"==c[e]&&"/"==c[e+
1]){l++;continue}case ")":p="("==c[l];g.top=c[l++];d.a_meter.push(g);g={};continue;default:if("0">=c[l]||"9"<c[l]){y(1,"Bad char '$1' in M:",c[l]);break a}k=2;for(g.top=c[l++];;){for(;"0"<=c[l]&&"9">=c[l];)g.top+=c[l++];if(")"==c[l]){if("/"!=c[l+1])break;l++}if("/"==c[l]){l++;if("0">=c[l]||"9"<c[l]){y(1,"Bad char '$1' in M:",c[l]);break a}for(g.bot=c[l++];"0"<=c[l]&&"9">=c[l];)g.bot+=c[l++];break}if(" "!=c[l]&&"+"!=c[l])break;if(l>=c.length||"("==c[l+1])break;g.top+=c[l++]}h=parseInt(g.top)}p||(g.bot&&
(k=parseInt(g.bot)),a+=h*m.BLEN/k);d.a_meter.push(g);for(g={};" "==c[l];)l++;"+"==c[l]&&(g.top=c[l++],d.a_meter.push(g),g={})}if("="==c[l]){k=c.substring(++l).match(/^(\d+)\/(\d+)$/);if(!k){y(1,"Bad duration '$1' in M:",c.substring(l));break a}a=m.BLEN*k[1]/k[2]}d.wmeasure=a;0>r.writefields.indexOf("M")&&(d.a_meter=[]);if(3!=t.state){if(S.M=c,oa.meter=d,1<=t.state)for(oa.ulen||(oa.ulen=1>=a||a>=3*m.BLEN/4?m.BLEN/8:m.BLEN/16),l=0;l<D.length;l++)D[l].meter=d,D[l].wmeasure=a}else n.wmeasure=a,vc()?(n.meter=
d,Zb=0<=r.writefields.indexOf("M")?3:2):va(d)}break;case "U":Wd(c);break;case "P":if(0==t.state)break;if(1==t.state){S.P=c;break}2==t.state&&Fa();d={type:m.PART,text:c,dur:0};0>r.writefields.indexOf(a)&&(d.invis=!0);va(d);break;case "Q":if(0==t.state)break;vf(c);break;case "V":Wc(c);3==t.state&&(n.ignore=!P.voices[n.v]);break;case "K":if(!t.state)break;a:{b:{k="FCGDAEB".indexOf(c[0])-1;p=0;a={type:m.KEY,dur:0};cc(a);e=1;if(-1>k)switch(c[0]){case "H":if("p"!=c[1].toLowerCase()){y(1,"Unknown bagpipe-like key");
g=!0;break}a.k_bagpipe=c[1];k="P"==c[1]?0:2;e++;r.temper||(r.temper=new Float32Array([11.62,12.55,2.37,2.37,3.49,0,2.37,2.37,3.49,4.41,5.53,0,3.49,4.41,5.53,7.35,7.35,4.41,5.53,7.35,7.35,8.19,0,7.35,7.35,8.19,9.39,10.51,0,8.19,9.39,10.51,11.62,12.55,0,10.51,11.62,12.55,2.37,2.37]));break;case "P":y(1,"K:P is deprecated");k=0;g=a.k_drum=!0;break;case "n":if(0==c.indexOf("none")){k=0;a.k_none=!0;e=4;break}default:a.k_map=[];a.k_mode=0;c=[a,dc(c)];break b}if(!g){switch(c[e]){case "#":k+=7;e++;break;
case "b":k-=7,e++}c=c.slice(e).trim();switch(c.slice(0,3).toLowerCase()){default:if("m"!=c[0]||" "!=c[1]&&"\t"!=c[1]&&"\n"!=c[1]){g=!0;break}case "aeo":case "m":case "min":k-=3;p=5;break;case "dor":k-=2;p=1;break;case "ion":case "maj":break;case "loc":k-=5;p=6;break;case "lyd":k+=1;p=3;break;case "mix":--k;p=4;break;case "phr":k-=4,p=2}g||(c=c.replace(/\w+\s*/,""));0==c.indexOf("exp ")&&((c=c.replace(/\w+\s*/,""))||y(1,"No accidental after 'exp'"),h=!0);e=c[0];if("^"==e||"_"==e||"="==e){a.k_a_acc=
[];g=new O;g.buffer=c;do{f=ib(g);if(!f)break;a.k_a_acc.push(f);for(e=c[g.index];" "==e;)e=c[++g.index]}while("^"==e||"_"==e||"="==e);if(!h){var C=k,u;e=[];f=[];if(0<C)for(h=0;h<C;h++)e[h]=1,f[h]=[26,23,27,24,21,25,22][h];else for(h=0;h<-C;h++)e[h]=-1,f[h]=[22,25,21,24,20,23,26][h];var z=a.k_a_acc.length;for(C=0;C<z;C++){var v=a.k_a_acc[C];for(u=0;u<h;u++)if(f[u]==v.pit){e[u]=v.acc;break}u==h&&(e[u]=v.acc,f[u]=v.pit,h++)}for(C=0;C<h;C++)(v=a.k_a_acc[C])||(v=a.k_a_acc[C]={}),v.acc=e[C],v.pit=f[C]}c=
c.slice(g.index)}else h&&0==c.indexOf("none")&&(k=0,c=c.replace(/\w+\s*/,""))}a.k_sf=k;if(a.k_a_acc)for(a.k_map=[],e=a.k_a_acc.length;0<=--e;)f=a.k_a_acc[e],a.k_map[(f.pit+19)%7]=f.acc;else a.k_map=abc2svg.keys[k+7];a.k_mode=p;a.k_b40=[1,24,7,30,13,36,19,2,25,8,31,14,37,20,3][k+7];c=[a,dc(c)]}k=c[0];c=c[1];switch(t.state){case 1:void 0!=k.k_sf||k.k_a_acc||(k.k_sf=0,k.k_none=!0,k.k_map=abc2svg.keys[7]);for(d=0;d<D.length;d++)l=D[d],l.key=x(k),l.okey=x(k),l.ckey=x(k);t.ckey=k;c.length&&Kc("*",c);oa.ulen||
(oa.ulen=m.BLEN/8);t.state=2;break a;case 2:Fa(!0)}c.length&&mc(c);n.ckey.k_bagpipe||n.ckey.k_drum||void 0==r.transp&&void 0==n.transp&&void 0==n.shift||(d=(r.transp||0)+(n.transp||0)+(n.shift||0));if(void 0!=n.sndtran||void 0!=n.sndsh)l=(n.sndtran||0)+(n.sndsh||0);if(void 0==k.k_sf){if(!k.k_a_acc&&void 0==d){if(void 0==l)break a;k.invis=!0}k.k_sf=n.okey.k_sf}n.okey=x(k);void 0!=d&&(n.vtransp=d,k.k_transp=d);void 0!=l&&(k.k_sndtran=l);k.k_old_sf=n.ckey.k_sf;k.k_a_acc&&k.k_a_acc.length||k.k_sf||k.k_old_sf||
(k.invis=!0);k.k_b40||(k.k_b40=n.ckey.k_b40);n.ckey=k;vc()?(k.fmt=r,n.key=x(k),k.k_none&&(n.key.k_sf=0)):va(k)}break;case "N":case "R":S[a]=S[a]?S[a]+("\n"+c):c;break;case "r":if(!q.keep_remark||3!=t.state)break;d={type:m.REMARK,text:c,dur:0};va(d);break;default:y(0,"'$1:' line ignored",a)}}function Xd(){var a,c=t.line,d={type:m.BAR,fname:t.fname,istart:t.bol+c.index,dur:0,multi:0};la.length&&"dot"==la[la.length-1]&&(d.bar_dotted=!0,la.pop());ea&&ea.bar&&bc("|");oa.new_nbar&&(d.bar_num=oa.new_nbar,
oa.new_nbar=0);for(a=c.char();;){var e=c.next_char();switch(e){case "|":case "[":case "]":case ":":a+=e;continue}break}":"==a[0]&&(":"==a?(a="|",d.bar_dotted=!0):d.rbstop=2);Xa&&wc(d);la.length&&(Hb(la,d),la=[]);if(t.ottava.length){var f=d;n.cst!=n.st&&(f={type:m.SPACE,fname:t.fname,istart:t.bol+c.index,dur:0,multi:0,invis:!0,width:1},va(f));f.ottava=t.ottava;t.ottava=[]}"["!=a.slice(-1)||/[0-9" ]/.test(e)||(a=a.slice(0,-1),c.index--,e="[");":"==a.slice(-1)&&(d.rbstop=2);if("0"<e&&"9">=e){for(d.text=
e;;){e=c.next_char();if(0>"0123456789,.-".indexOf(e))break;d.text+=e}d.rbstop=2;d.rbstart=2}else if('"'==e&&"["==a.slice(-1)){for(d.text="";;){e=c.next_char();if(!e){y(1,"No end of repeat string");return}if('"'==e){c.index++;break}d.text+=e}d.rbstop=2;d.rbstart=2}"]"==a[0]&&(d.rbstop=2,1!=a.length?a=a.slice(1):d.invis=!0);d.iend=t.bol+c.index;d.rbstart&&n.norepbra&&!n.second&&(d.norepbra=!0);if(d.text)if("["==a.slice(-1)&&"["!=a&&(a=a.slice(0,-1)),"1"==d.text[0])n.tie_s&&(n.tie_s_rep=n.tie_s),n.acc_tie?
n.acc_tie_rep=n.acc_tie.slice():n.acc_tie_rep&&(n.acc_tie_rep=null);else{if(n.tie_s_rep)for(n.tie_s=x(n.tie_s_rep),n.tie_s.notes=x(n.tie_s.notes),f=0;f<=n.tie_s.nhd;f++)n.tie_s.notes[f]=x(n.tie_s.notes[f]),n.tie_s.notes[f].s=n.tie_s;n.acc_tie_rep&&(n.acc_tie=n.acc_tie_rep.slice())}if(0>n.ulen&&(f=n.last_sym)&&f.type!=m.MREST&&f.type!=m.BAR){for(;f.type!=m.BAR&&f.prev;)f=f.prev;e=f.time;var g=n.time-e;c=n.wmeasure/g;if(0==e){for(;f&&!f.dur;)f=f.next;f&&f.type==m.REST&&f.invis&&(e+=f.dur*c,f.prev?f.prev.next=
f.next:n.sym=f.next,f.next&&(f.next.prev=f.prev),f=f.next)}if(n.wmeasure!=g){for(;f;f=f.next)if(f.time=e,f.dur&&!f.grace&&(f.dur*=c,f.dur_orig*=c,e+=f.dur,f.type==m.NOTE||f.type==m.REST))for(g=0;g<=f.nhd;g++)f.notes[g].dur*=c;n.time=d.time=e}}if(("["==a||"|:"==a)&&!n.eoln&&(f=n.last_sym)&&f.time==n.time&&f&&f.type==m.BAR){if("["==a&&!f.text&&(0==n.st||P.staves[n.st-1].flags&64||d.norepbra)||"|"==f.bar_type){"["!=a&&(f.bar_type=a);d.text&&(f.text=d.text);d.a_gch&&(f.a_gch=d.a_gch);d.norepbra&&(f.norepbra=
d.norepbra);d.rbstart&&(f.rbstart=d.rbstart);d.rbstop&&(f.rbstop=d.rbstop);return}if("|:"==a){if(":|"==f.bar_type){f.bar_type="::";f.rbstop=2;return}if("||"==f.bar_type){f.bar_type="||:";f.rbstop=2;return}}}switch(a){case "[":d.rbstop=2;case "[]":case "[|]":d.invis=!0;a=d.rbstart?"[":"[]";break;case ":|:":case ":||:":a="::";break;case "||":if("2.2"<=r["abc-version"])break;case "[|":case "|]":d.rbstop=2}d.bar_type=a;n.lyric_restart||(n.lyric_restart=d);n.sym_restart||(n.sym_restart=d);va(d);d.st=n.st;
d.rbstart&&"["!=a&&!n.norepbra&&0<d.st&&!(P.staves[d.st-1].flags&64)&&(f={type:m.BAR,fname:d.fname,istart:d.istart,iend:d.iend,bar_type:"[",multi:0,invis:!0,text:d.text,rbstart:2},va(f),f.st=d.st,delete d.text,d.rbstart=0);d.bar_dotted||d.invis||(n.acc=[])}function dc(a){if(!a)return[];a=a.match(/[^\s"=]+=?|"[^"]+"/g);return a?a:(y(1,"Unterminated string"),[])}function xc(a){Xc.lastIndex=a.index;var c=Xc.exec(a.buffer);if(!c[0])return[1,1];var d=c[1]||1;var e=c[3]||1;c[3]||(e*=1<<c[2].length);a.index=
Xc.lastIndex;return[d,e]}function ib(a){var c=a.char();switch(c){case "^":c=a.next_char();if("^"==c){var d=2;c=a.next_char()}else d=1;break;case "=":d=3;c=a.next_char();break;case "_":c=a.next_char(),"_"==c?(d=-2,c=a.next_char()):d=-1}if(1==d||-1==d)if("1"<=c&&"9">=c||"/"==c){var e=xc(a);0>d&&(e[0]=-e[0]);r.nedo&&1==e[1]&&(e[0]*=12,e[1]*=r.nedo);d=e;c=a.char()}e=wb.indexOf(c)+16;c=a.next_char();if(16>e)y(1,"'$1' is not a note",a.buffer[a.index-1]);else{for(;"'"==c;)e+=7,c=a.next_char();for(;","==
c;)e-=7,c=a.next_char();a={pit:e,shhd:0,shac:0};d&&(a.acc=d);return a}}function yc(){var a=t.line,c=0;la.length&&"dot"==la[la.length-1]&&(c=m.SL_DOTTED,la.pop());switch(a.next_char()){case "'":return a.index++,c+m.SL_ABOVE;case ",":return a.index++,c+m.SL_BELOW}return c+m.SL_AUTO}function Yc(a,c){var d;for(d=n.sls.length;0<=--d;){var e=n.sls[d];var f=e.note;var g=e.is_note;delete e.is_note;if(f.s!=a.s){e.note=a;c&&(e.is_note=c);var h=g?f:f.s;h.sls||(h.sls=[]);h.sls.push(e);n.sls.splice(d,1);g&&(f.s.sl1=
!0);e.grace&&(e.grace.sl1=!0);a.s.grace&&(a.s.sl2=!0);return}}if(a.grace)u(1,a.s,J.bad_slur_end);else{for(h=a.s.prev;h;h=h.prev)if(h.type==m.BAR&&":"==h.bar_type[0]&&h.text){h.sls||(h.sls=[]);h.sls.push({note:a,ty:m.SL_AUTO});c&&(h.sls[h.sls.length-1].is_note=c);return}y(1,"End of slur without start")}}function Yd(a,c){var d=[0,2,4,5,7,9,11][a%7],e=12*(a/7|0);n.snd_oct&&(e+=n.snd_oct);3==c&&(c=0);if(c)if("object"==typeof c){var f=c[0]/c[1];if(100==c[1])return d+e+f}else f=c;else return r.temper?r.temper[abc2svg.p_b40[a%
7]]+e:d+e;if(r.nedo){if("object"!=typeof c)return a=abc2svg.p_b40[a%7]+c,r.temper[a]+e;if(c[1]==r.nedo)return a=abc2svg.p_b40[a%7],r.temper[a]+e+f}else if(!r.temper)return d+(e+f);c=r.temper[abc2svg.p_b40[a%7]];0<f?(a=r.temper[(abc2svg.p_b40[a%7]+1)%40],a<c&&(a+=12)):(a=r.temper[(abc2svg.p_b40[a%7]+39)%40],a>c&&(a-=12),f=-f);return c+e+(a-c)*f}function Jd(){function a(a){for(var c=wb[a];0>a;)a+=7,c+=",";for(;14<a;)a-=7,c+="'";return c}function c(c,d){var e,f="",g=c.length;for(e=0;e<g;e++){var h=c[e];
f="h"<=h&&"z">=h?f+a(d+h.charCodeAt(0)-110):f+h}return f}function d(z){for(var v,E,q,B;;){v=C.char();if(!v)break;if(n.ignore)for(;"["!=v||"V"!=C.buffer[C.index+1]||":"!=C.buffer[C.index+2];)if(v=C.next_char(),!v)return;if(!z&&nc[v]){B=0;for(q in ub)if(ub.hasOwnProperty(q)&&q[0]==v){if(0>q.indexOf("n")){if(C.buffer.indexOf(q,C.index)!=C.index)continue;C.index+=q.length}else{a:{E=void 0;var x=q;var A=1;for(B=C.index+1;A<x.length;A++,B++)if(x[A]!=C.buffer[B]){if("n"!=x[A]){B=void 0;break a}E=wb.indexOf(C.buffer[B]);
if(0>E){B=void 0;break a}for(;"'"==C.buffer[B+1];)E+=7,B++;for(;","==C.buffer[B+1];)E-=7,B++}C.index=B;B=E}if(!B)continue}var D=q;E=ub[q];A=C;x=t.istart;t.line=C=new O;t.istart+=A.index;if(0>r.writefields.indexOf("m")){C.buffer=D.replace("n",a(B));D=n.last_sym;var F=n.time;d(!0);D||(D=n.sym);for(D=D.next;D;D=D.next)D.noplay=!0;var G=n.time;var H=n;n=Zd(H.id+"-p");P.voices[n.v]||(n.second=!0,P.voices[n.v]={st:H.st,second:!0,range:n.v});n.time=F;D=n.last_sym;t.line=C=new O;t.istart+=A.index;C.buffer=
B?c(E,B):E;d(!0);n.time!=G&&y(1,"Bad length of the macro sequence");D||(D=n.sym);for(;D;D=D.next)D.invis=D.play=!0;n=H}else C.buffer=B?c(E,B):E,d(!0);t.line=C=A;t.istart=x;B=1;break}if(B)continue}E=v.charCodeAt(0);if(128<=E){y(1,J.not_ascii);C.index++;break}E=La[E];switch(E[0]){case " ":if(B=n.last_note)B.beam_end=!0,e&&(e.gr_shift=!0);break;case "\n":if(r.barsperstaff)break;n.eoln=!0;break;case "&":if(e){y(1,J.bad_grace);break}v=C.next_char();if(")"==v){bc(")");break}bc("&");continue;case "(":v=
C.next_char();if("0"<v&&"9">=v){if(e){y(1,J.bad_grace);break}E=C.get_int();B=wf[E];A=E;v=C.char();if(":"==v&&(v=C.next_char(),"0"<v&&"9">=v&&(B=C.get_int(),v=C.char()),":"==v))if(v=C.next_char(),"0"<v&&"9">=v)A=C.get_int(),C.char();else{y(1,"Invalid 'r' in tuplet");continue}if(0==B||void 0==B)B=0==n.wmeasure%9?3:2;0>k&&(k=l.length);v=r.tuplets;if(n.pos.tup)switch(v=Object.create(v),n.pos.tup&7){case m.SL_ABOVE:v[3]=1;break;case m.SL_BELOW:v[3]=2;break;case m.SL_HIDDEN:v[2]=1}l.push({p:E,q:B,r:A,ro:A,
f:v});continue}if("&"==v){if(e){y(1,J.bad_grace);break}bc("(");break}C.index--;p.push(yc());continue;case ")":if(B=n.last_sym)switch(B.type){case m.SPACE:B.notes||(B.notes=[],B.notes[0]={});case m.NOTE:case m.REST:break;case m.GRACE:for(B=B.extra;B.next;B=B.next);break;default:B=null}if(!B){y(1,J.bad_char,v);break}B.notes[0].s=B;Yc(B.notes[0]);break;case "!":if(1<E.length)B=E.slice(1,-1);else{B="";for(E=C.index;;){v=C.next_char();if(!v)break;if("!"==v)break;B+=v}if(!v){C.index=E;y(1,"No end of decoration");
break}}void 0!=$d[B]?(oa.ottava=!0,t.ottava.push($d[B])):la.push(B);break;case '"':if(e){y(1,J.bad_grace);break}ae(E);break;case "[":if(1<E.length){X.do_pscom(E.slice(3,-1));break}B=C.buffer[C.index+1];if(0<='|[]: "'.indexOf(B)||"1"<=B&&"9">=B){if(e){y(1,J.bar_grace);break}Xd();continue}if(":"==C.buffer[C.index+2]){if(e){y(1,J.bad_grace);break}E=C.buffer.indexOf("]",C.index+1);if(0>E){y(1,"Lack of ']'");break}v=C.buffer.slice(C.index+3,E).trim();t.istart=t.bol+C.index;t.iend=t.bol+ ++E;C.index=0;
Oc(B,v);C.index=E;continue}case "n":B=X.new_note(e,p);if(!B)continue;if(e||!B.notes)continue;if(0<=k)B.tp=l.slice(k),k=-1,u&&(B.tp[0].s=u),u=B;else if(!u)continue;q=l[l.length-1];if(0<--q.r)continue;for(;;){v=u;E=q.q/q.p;B=v.time;for(n.time=B+(n.time-B)*E;;){v.in_tuplet=!0;v.grace||(v.time=B,v.dur&&(v.dur*=E,B+=v.dur));if(!v.next){v.tpe?v.tpe++:v.tpe=1;break}v=v.next}E=q.ro;q.s&&(u=q.s);l.pop();if(!l.length){u=null;break}q=l[l.length-1];q.r-=E;if(0<q.r)break}continue;case "<":if(!n.last_note){y(1,
"No note before '<'");break}if(e){y(1,"Cannot have a broken rhythm in grace notes");break}for(B="<"==v?1:-1;"<"==v||">"==v;)B*=2,v=C.next_char();n.brk_rhythm=B;continue;case "i":break;case "{":if(e){y(1,"'{' in grace note");break}f=n.last_note;n.last_note=null;g=la;la=[];e={type:m.GRACE,fname:t.fname,istart:t.bol+C.index,dur:0,multi:0};switch(n.pos.gst&7){case m.SL_ABOVE:e.stem=1;break;case m.SL_BELOW:e.stem=-1;break;case m.SL_HIDDEN:e.stem=2}va(e);v=C.next_char();if("/"==v){e.sappo=!0;break}continue;
case "|":if(e){y(1,J.bar_grace);break}Xd();continue;case "}":B=n.last_note;if(!e||!B){y(1,J.bad_char,v);break}la.length&&y(1,"Decoration ignored");e.extra=e.next;e.extra.prev=null;e.next=null;n.last_sym=e;e=null;if(!B.prev&&!n.ckey.k_bagpipe){for(E=0;E<=B.nhd;E++)B.notes[E].dur*=2;B.dur*=2;B.dur_orig*=2}n.last_note=f;la=g;break;case "\\":if(!C.buffer[C.index+1]){h=!0;break}default:y(1,J.bad_char,v)}C.index++}}var e,f,g,h,l=[],k=-1,p=[],C=t.line;if(3!=t.state){if(2!=t.state)return;Fa()}if(t.tp){l=
t.tp;k=t.tpn;var u=t.tps;t.tp=null}d();l.length&&(t.tp=l,t.tps=u,t.tpn=k);p.length&&y(1,"Start of slur without note");la.length&&(y(1,"Decoration without symbol"),la=[]);e&&(y(1,"No end of grace note sequence"),n.last_sym=e.prev,n.last_note=f,e.prev&&(e.prev.next=null));r.breakoneoln&&n.last_note&&(n.last_note.beam_end=!0);h||r.barsperstaff||"\n"!=La[10]||(n.eoln=!0)}function Zc(a){a=a.charCodeAt(0);if(128<=a){if(768<=a&&880>a)return 0;a=97}return be[a]}function Rb(a){return Zc(a)*H.curfont.swfac}
function xb(a){if("object"==typeof a)return a;var c,d=H.curfont,e=d;var f=a.replace(/<|>|&[^&]*?;|&|  |\$./g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case "  ":return" \u00a0";default:if("$"==a[0]){if("0"==a[1])c=H.deffont;else if("1"<=a[1]&&"9">=a[1])c=Ga("u"+a[1]);else break;a="";if(c!=e&&(e!=d&&(a="</tspan>"),e=c,e!=d)){var f=e.class&&e.name==d.name&&e.size==d.size&&e.weight==d.weight&&e.style==d.style?e.class:bb(e);return a+('<tspan\n\tclass="'+
f+'">')}}}return a});e!=d&&(f+="</tspan>",H.curfont=e);f=new String(f);"undefined"!=typeof document?sa(f):f.wh=sa(a);return f}function V(a){"string"==typeof a&&(a=Ga(a));be="sans"==a.name.slice(0,4)?xf:ce;H.curfont=H.deffont=a}function na(a,c,d,e,f,g){g||(g=d.wh||sa(d));G+='<text class="'+bb(H.curfont);"j"!=e&&5<d.length&&H.curfont.wadj&&(G+='" lengthAdjust="'+H.curfont.wadj+'" textLength="'+g[0].toFixed(1));G+='" x="';Oa(a,'" y="',c+.2*g[1]);switch(e){case "c":G+='" text-anchor="middle">';break;
case "j":G+='" textLength="'+f.toFixed(1)+'">';break;case "r":G+='" text-anchor="end">';break;default:G+='">'}G+=xb(d);G+="</text>\n"}function de(a,c){if(r.titletrim){var d=a.lastIndexOf(", ");if(0>d||"A">a[d+2]||"Z"<a[d+2])d=0;else if(1==r.titletrim){if(d<a.length-7||0<=a.indexOf(" ",d+3))d=0}else d<a.length-r.titletrim-2&&(d=0);d&&(a=a.slice(d+2).trim()+" "+a.slice(0,d))}!c&&0<=r.writefields.indexOf("X")&&(a=S.X+".  "+a);return r.titlecaps?a.toUpperCase():a}function Wb(){return(da.width-da.lm-da.rm-
2)/r.scale}function $c(a,c){if(a){wa();a=de(a,c);c?(V("subtitle"),c=r.subtitlespace):(V("title"),c=r.titlespace);var d=sa(a);d[1]+=2*H.curfont.pad;ma(d[1]+c+H.curfont.pad);c=H.curfont.pad;r.titleleft?na(0,c,a,null,null,d):na(Wb()/2,c,a,"c",null,d)}}function ee(a,c,d,e,f){if(!d){if(!e)return;d=e;e=null}e?na(a,c,d+" ("+e+")",f):na(a,c,d,f)}function zc(a,c){if("s"!=c){wa();var d=Wb(),e=H.curfont.size,f=e*r.lineskipfac;e*=r.parskipfac;var g,h;switch(c){default:var l=H.curfont;switch(c){case "c":d/=2;
break;case "r":d-=l.pad;break;default:d=l.pad}for(g=0;;){var k=a.indexOf("\n",g);if(0>k){var m=xb(a.slice(g));ma(m.wh[1]*r.lineskipfac+2*l.pad);na(d,l.pad,m,c);break}if(k==g){ma(e);hb();for(tb(H.curfont);"\n"==a[k+1];)ma(f),k++;if(k==a.length)break}else m=xb(a.slice(g,k)),ma(m.wh[1]*r.lineskipfac+2*l.pad),na(d,l.pad,m,c);g=k+1}ma(e);hb();break;case "f":case "j":for(g=0;;){k=a.indexOf("\n\n",g);l=0>k?a.slice(g):a.slice(g,k);l=l.split(/\s+/);for(g=m=h=0;g<l.length;g++){var n=sa(l[g])[0];m+=n;m>=d&&
(m=xb(l.slice(h,g).join(" ")),ma(m.wh[1]*r.lineskipfac),na(0,0,m,c,d),h=g,m=n);m+=Rb(" ")}0!=m&&(m=xb(l.slice(h).join(" ")),ma(m.wh[1]*r.lineskipfac),na(0,0,m));ma(e);hb();if(0>k)break;for(;"\n"==a[k+2];)ma(f),k++;if(k==a.length)break;tb(H.curfont);g=k+2}}}}function gf(a){function c(a,c){var d=0;"$"==a[d]&&"0"<=a[d+1]&&"9">=a[d+1]&&(d+=2);var e=0;var f=d;if("0"<=a[d]&&"9">=a[d]||"."==a[d+1]){for(;d<a.length&&(d++," "!=a[d]&&":"!=a[d-1]&&"."!=a[d-1]););for(e=d;" "==a[d];)d++}0!=e&&na(c,0,a.slice(f,
e),"r");d<a.length&&na(c+5,0,a.slice(d),"l")}var d,e;var f=0;var g=1;V("words");ma(r.wordsspace);Pb();a=a.split("\n");var h=a.length;for(d=0;d<h;d++){var l=a[d];if(!l){for(;d+1<h&&!a[d+1];)d++;g++}else if(l.length>f){f=l.length;var k=d}}f=Wb()/2;var m=sa(a[k])[0];k=e=0;if(m<f){var n=g>>1;for(d=0;d<h;d++)if(l=a[d],!l){for(0>=--n&&(k=d);d+1<h&&!a[d+1];)d++;if(0>=n){e=d+1;break}}g>>=1}if(e){var t=(f-m)/2+10;n=t+f}else n=f-m/2+10;var z=!0;for(d=0;d<k||e<h;d++,e++)ma(r.lineskipfac*H.curfont.size),d<k&&
((l=a[d])?c(l,t):tb(H.curfont)),e<h&&((l=a[e])?c(l,n):0==--g&&(d<k?g++:e<h-1&&(n=f-m/2+10,Pb()))),a[d+1]||a[e+1]?z=!0:z&&(Pb(),z=!1)}function hc(a){return a.replace(/[Cco]\||[co]\.|./g,function(a){return(a=Gc["mtr"+a])?a.c:0})}function fe(a){var c,d;if(!ad[a])if(ad[a]=!0,d=Kb[a]){for(c=0;;){a=d.indexOf('xlink:href="#',c);if(0>a)break;a+=13;c=d.indexOf('"',a);fe(d.slice(a,c))}Ac+="\n"+d}else u(1,null,"Unknown glyph: '$1'",a)}function ge(a){var c=0;for(a=a.replace(/\x3c!--.*?--\x3e/g,"");;){var d=a.indexOf("<",
c);if(0>d)break;var e=a.indexOf('id="',d);if(0>e)break;e+=4;c=a.indexOf('"',e);if(0>c)break;var f=a.slice(e,c);c=a.indexOf(">",c);if(0>c)break;if("/"==a[c-1])c++;else{e=a.indexOf(" ",d);if(0>e)break;e=a.slice(d+1,e);c=a.indexOf("</"+e+">",c);if(0>c)break;c+=3+e.length}"<filter"==a.substr(d,7)?bd+=a.slice(d,c)+"\n":Kb[f]=a.slice(d,c)}}function cd(){I.started&&(I.started=!1,fb(),G+="</g>\n");if(1!=I.scale||I.color)fb(),G+="<g ",1!=I.scale&&(G=0>I.st?G+D[I.v].scale_str:0>I.v?G+A[I.st].scale_str:G+('transform="translate(0,'+
(aa-I.dy).toFixed(1)+") scale("+I.scale.toFixed(2)+')"')),I.color&&(1!=I.scale&&(G+=" "),G+='color="'+I.color+'" fill="'+I.color+'"'),G+=">\n",I.started=!0}function Ha(a){if(a!=I.color){var c=I.color;I.color=a;cd();return c}}function Aa(a){a!=I.st&&1!=I.scale&&(I.scale=0);var c=0<=a?A[a].staffscale:1;var d=0<=a&&1!=c?A[a].y:aa;if(c!=I.scale||d!=I.dy)I.scale=c,I.dy=d,I.st=a,I.v=-1,cd()}function jb(a){var c=a.p_v.scale;if(1==c)Aa(a.st);else{var d=aa;1!=A[a.st].staffscale&&(c*=A[a.st].staffscale,d=A[a.st].y);
if(c!=I.scale||I.dy!=aa)I.scale=c,I.dy=d,I.st=1==A[a.st].staffscale?-1:a.st,I.v=a.v,cd()}}function za(a,c){G&&(0>I.st?A[0].output+=G:1==I.scale?A[I.st].output+=G:A[I.st].sc_out+=G,G="");I.scale=0>a?1:c?1:A[a].staffscale;I.st=a;I.dy=0}function he(a,c,d){if(void 0!=a.istart){var e=a.type,f=a.ymx-a.ymn+4,g=a.wl||2,h=a.wr||2;a.grace&&(e=m.GRACE);d(c||abc2svg.sym_name[e],a.istart,a.iend,a.x-g-2,A[a.st].y+a.ymn+f-2,g+h+4,f,a)}}function yf(a,c){he(a,c,q.anno_start)}function zf(a,c){he(a,c,q.anno_stop)}function Bc(){}
function cf(){for(var a;;){a=cb.shift();if(!a)break;switch(a.type){case m.CLEF:case m.METER:case m.KEY:case m.REST:if(a.type!=m.REST||a.rep_nb){Aa(a.st);break}case m.GRACE:case m.NOTE:case m.MREST:jb(a)}Wa(a)}}function Y(a,c,d,e,f){c=ab(c);d=eb(d);G+=a.replace(/X|Y|A|B|F|G/g,function(a){switch(a){case "X":return c.toFixed(1);case "Y":return d.toFixed(1);case "A":return e;case "B":return f;case "F":return e.toFixed(1);default:return f.toFixed(1)}})}function Jb(a,c,d,e,f){fb();Y('<g transform="translate(X,Y',
a,c);d&&(G+=") rotate("+d.toFixed(2));e&&(G=f?G+(") scale("+e.toFixed(2)+", "+f.toFixed(2)):G+(") scale("+e.toFixed(2)));G+=')">\n';I.g++}function Ob(){fb();I.g--;G+="</g>\n"}function ab(a){return I.g?a:(a+Vb)/I.scale}function eb(a){return I.g?-a:1==I.scale?aa-a:0<=I.v?(I.dy-a)/D[I.v].scale:I.dy-a}function Oa(a,c,d){a=ab(a);d=eb(d);G+=a.toFixed(1)+c+d.toFixed(1)}function Ib(a,c,d){d?Y('<path d="mX Y',a,c):Y('<path class="stroke" d="mX Y',a,c)}function fb(){var a=[];if(Ja[0].length){for(;;){var c=
Ja[0].shift();if(void 0==c)break;a.push(c.toFixed(1))}G+='<text x="'+a.join(",");for(a=[];;){c=Ja[1].shift();if(void 0==c)break;a.push(c.toFixed(1))}G+='"\ny="'+a.join(",");G+='"\n>'+Ja[2]+"</text>\n";Ja[2]=""}if(Ja[3].length){for(G+='<path class="sW" d="';;){c=Ja[3].shift();if(void 0==c)break;G+="M"+c.toFixed(1)+" "+Ja[3].shift().toFixed(1)+"v"+Ja[3].shift().toFixed(1)}G+='"/>\n'}}function ca(a,c,d){if(Kb[d])fe(d),Y('<use x="X" y="Y" xlink:href="#A"/>\n',a,c,d);else{var e=Gc[d];e?(a+=e.x*I.scale,
c-=e.y,e.sc?Y('<text transform="translate(X,Y) scale(A)">B</text>\n',a,c,e.sc,e.c):(Ja[0].push(ab(a)),Ja[1].push(eb(c)),Ja[2]+=e.c)):u(1,null,"no definition of $1",d)}}function ie(a,c,d){var e=25+3*(d/20|0);var f=15<d?(d-15)/e|0:0;Y('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',a+(d-e*f-5)/2,c+6,Math.round((e-5)/I.scale),e*f+5)}function Ic(a,c,d,e,f,g){var h=e?2.3:3.5,l=-d;0>d&&(h=-h);a+=h*I.scale;0<=I.v&&(l/=D[I.v].scale);Ja[3].push(ab(a));Ja[3].push(eb(c));
Ja[3].push(l);if(f){c+=d;if(0<d)if(g)if(G+='<path d="',e)for(;0<=--f;)Y("MX Yl3 1.5 0 2 -3 -1.5z\n",a,c),c-=3;else for(;0<=--f;)Y("MX Yl7 3.2 0 3.2 -7 -3.2z\n",a,c),c-=5.4;else if(e)if(G+='<path d="',1==f)Y("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",a,c);else for(;0<=--f;)Y("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",a,c),c-=3.5;else{ca(a,c,"flu"+f);return}else if(g){if(G+='<path d="',!e)for(;0<=--f;)Y("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",a,c),c+=5.4}else if(e)if(G+='<path d="',
1==f)Y("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",a,c);else for(;0<=--f;)Y("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",a,c),c+=3.5;else{ca(a,c,"fld"+f);return}G+='"/>\n'}}function dd(a,c,d){Y('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',a,c+3,d)}function je(a,c,d,e){if("fng"==d)Y('<text x="X" y="Y" style="font-size:14px" text-anchor="middle">A</text>\n',a,c,hc(e));else{var f=Af[d];f?(a+=f.dx,c+=f.dy,f.def||(yb+="\n."+d+" {"+f.style+"}",f.def=!0),Y('<text x="X" y="Y" class="A"B>',
a,c,d,f.anchor||""),V("annotation"),G+=xb(e),G+="</text>\n"):ca(a,c,d)}}function ke(a,c,d){Jb(a,c,270);a=0;for(d=Math.ceil(d/6);0<=--d;)ca(a,6,"ltr"),a+=6;Ob()}function le(a,c,d){c+=4;for(d=Math.ceil(d/6);0<=--d;)ca(a,c,"ltr"),a+=6}function ed(a,c,d,e,f){if(me[d])me[d](a,c,e,f);else u(1,null,"No function for decoration '$1'",d)}function ne(a,c){c=jc(a,c);switch(c[0]){case m.OVAL:a="\ueca2";break;case m.EMPTY:a="\ueca3";break;default:switch(c[2]){case 2:a="\ueca9";break;case 1:a="\ueca7";break;default:a=
"\ueca5"}}c[1]&&(a+='<tspan dx=".1em">\uecb7</tspan>');return a}function oe(a){var c,d=0,e=[];if(!a.tempo_str){r.musicfont.used||Ga("music");V("tempo");a.tempo_str1&&(e.push(a.tempo_str1),d+=sa(a.tempo_str1)[0]);if(a.tempo_notes){var f=' dy="-1"';for(c=0;c<a.tempo_notes.length;c++){var g=ne(a,a.tempo_notes[c]);e.push('<tspan\nclass="'+bb(r.musicfont)+'" style="font-size:'+(1.3*H.curfont.size).toFixed(1)+'px"'+f+">"+g+"</tspan>");g=1<g.length?2:1;d+=g*H.curfont.swfac;f=""}e.push('<tspan dy="1">=</tspan>');
d+=Rb("=");a.tempo_ca&&(e.push(a.tempo_ca),d+=sa(a.tempo_ca)[0]);a.tempo?(e.push(a.tempo),d+=sa(a.tempo.toString())[0]):(g=ne(a,a.new_beat),e.push('<tspan\nclass="'+bb(r.musicfont)+'" style="font-size:'+(1.3*H.curfont.size).toFixed(1)+'px" dy="-1">'+g+"</tspan>"),g=1<g.length?2:1,d+=g*H.curfont.swfac,f="y")}a.tempo_str2&&(f?e.push('<tspan\n\tdy="1">'+a.tempo_str2+"</tspan>"):e.push(a.tempo_str2),d+=sa(a.tempo_str2)[0]);a.tempo_str=e.join(" ");d+=Rb(" ")*(e.length-1);a.tempo_wh=[d,13]}}function xd(a,
c,d){V("tempo");if(H.curfont.box){H.curfont.box=!1;var e=c}G+='<text class="'+bb(H.curfont)+'" x="';Oa(c,'" y="',d+.2*H.curfont.size);G+='">'+a.tempo_str+"</text>\n";e&&(H.curfont.box=!0,bh=H.curfont.size+4,G+='<rect class="stroke" x="',Oa(e-2,'" y="',d+bh-1),G+='" width="'+(a.tempo_wh[0]+2).toFixed(1)+'" height="'+bh.toFixed(1)+'"/>\n');a.invis=!0}function ma(a){aa+=a}function Pb(){if(!ja&&G&&q.img_out&&0!=aa){var a='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tcolor="',
c="";fb();a=r.fgcolor?a+(r.fgcolor+'" fill="'+r.fgcolor+'"'):a+'black"';a+=' stroke-width=".7"';r.bgcolor&&(a+=' style="background-color: '+r.bgcolor+'"');var d=Ga("music");a+=' class="'+bb(d)+" tune"+Nc.length+'"\n';aa*=r.scale;a=q.imagesize?a+(q.imagesize+' viewBox="0 0 '+da.width.toFixed(0)+" "+aa.toFixed(0)+'">\n'):a+(' viewBox="0 0 '+da.width.toFixed(0)+" "+aa.toFixed(0)+'" width="'+da.width.toFixed(0)+'px" height="'+aa.toFixed(0)+'px">\n');a+=bd;if(yb||zb)a+="<style>\n."+bb(d)+" text,tspan{fill:currentColor}"+
zb+yb+"\n</style>\n";Ac&&(a+="<defs>"+Ac+"\n</defs>\n");1!=r.scale&&(a+='<g class="g" transform="scale('+r.scale.toFixed(2)+')">\n',c="</g>\n");pe&&pe.ps_flush(!0);0<Ua&&(q.img_out(1==Ua?'<div class="nobrk">':'<div class="nobrk newpage">'),Ua=-1);q.img_out(a+G+c+"</svg>");zb=G="";if(r.fullsvg&&"undefined"==typeof document)for(ad={},d=0;d<gb.length;d++)gb[d].used=!1;else bd=yb="";Ac="";aa=0}}function hb(){Pb();0>Ua&&(!t.state||r.splittune)&&(q.img_out("</div>"),Ua=0)}function Bf(){function a(a,c){c=
new RegExp(c);if(c.test(n.id)||c.test(n.nm))for(c=0;c<a.length;c++)X.do_pscom(a[c])}var c;if(t.voice_opts)for(c in t.voice_opts)t.voice_opts.hasOwnProperty(c)&&a(t.voice_opts[c],c);if(t.tune_v_opts)for(c in t.tune_v_opts)t.tune_v_opts.hasOwnProperty(c)&&a(t.tune_v_opts[c],c)}function va(a){a.fname||cc(a);t.last_sym=a;(a.prev=n.last_sym)?n.last_sym.next=a:n.sym=a;n.last_sym=a;a.v=n.v;a.p_v=n;a.st=n.cst;a.time=n.time;a.dur&&!a.grace&&(n.time+=a.dur);t.ufmt=!0;a.fmt=r;a.pos=n.pos;n.second&&(a.second=
!0);n.floating&&(a.floating=!0);n.eoln&&(a.soln=!0,n.eoln=!1)}function Od(a,c){c={type:c,dur:0};var d=n;n=a;va(c);n=d;a=c.prev;a||(a=c.next);a&&(c.fname=a.fname,c.istart=a.istart,c.iend=a.iend);return c}function Fd(a){var c,d;n&&n.clone&&(t.istart=t.eol,qe());if((c=oa.tempo)&&0>=ob){var e=P.top_voice;var f=D[e];!f.sym||f.sym.type==m.TEMPO||f.sym.next&&f.sym.next.type==m.TEMPO||(c=x(c),c.v=e,c.p_v=f,c.st=f.st,c.time=0,c.prev=f.sym,c.next=f.sym.next,c.next&&(c.next.prev=c),f.sym.next=c,c.fmt=r)}for(e=
0;e<D.length;e++){f=D[e];if(!a)for(delete f.eoln;;){var g=f.sls.shift();if(!g)break;c=g.note.s;for(d=c.next;d&&(!d.bar_type||":"!=d.bar_type[0]);d=d.next);d?(c.sls||(c.sls=[]),c.sls.push({ty:g.ty,note:{s:d}})):u(1,c,"Lack of ending slur(s)")}for(c=f.sym;c&&!(c.time>=ob);c=c.next);for(;c;c=c.next){switch(c.type){case m.GRACE:c.next&&c.next.type==m.BAR&&c.time--;if(!r.graceword)continue;for(d=c.next;d;d=d.next){switch(d.type){case m.SPACE:continue;case m.NOTE:d.a_ly&&(c.a_ly=d.a_ly,d.a_ly=null)}break}continue;
case m.MREST:for(d=c.next;d;d=d.next){switch(d.type){case m.BAR:case m.GRACE:break;default:if(!d.dur)continue}break}d&&d.type==m.BAR||(u(1,c,"Lack of bar after multi-measure rest"),d=x(c),d.type=m.BAR,d.bar_type="|",d.dur=0,d.time=c.next.time,d.prev=c,d.next=c.next,d.next.prev=d,c.next=d);continue}if(c.feathered_beam){var h;var l=c;g=l.dur;var k=1;for(h=l;h&&!h.beam_end&&h.next;h=h.next)k++;if(1>=k)delete l.feathered_beam;else{var p=h;d=g/2;f=g/(k-1);var q=l.time;if(0<l.feathered_beam)for(h=l,l=k-
1;h!=p;h=h.next,l--)g=(f*l|0)+d,h.dur=g,h.time=q,q+=g;else for(h=l,l=0;h!=p;h=h.next,l++)g=(f*l|0)+d,h.dur=g,h.time=q,q+=g;h.dur=h.time+h.dur-q;h.time=q}}}}}function re(a){var c={voices:[],staves:[],top_voice:0};if(a)L=P=c;else{for(a=0;a<D.length;a++)if(P.voices[a]){var d=P.voices[a].st;d=P.staves[d];var e=D[a];d.staffnonote=e.staffnonote;e.staffscale&&(d.staffscale=e.staffscale)}for(d=0;d<P.staves.length;d++)c.staves[d]=x(P.staves[d]),c.staves[d].flags=0;P=P.next=c}}function se(a,c){var d="";if(c&&
3!=c)if("object"!=typeof c)d=["__","_","","^","^^"][c+2];else{var e=c[0];0<e?d+="^":(d+="_",e=-e);d+=e+"/"+c[1]}d+=wb[(a+75)%7];for(e=a;21<=e;e-=7)d+="'";for(e=a;14>e;e+=7)d+=",";return d}function Cc(){var a;if(!n.ckey.k_bagpipe&&!n.ckey.k_drum){r.transp&&n.shift&&y(0,"Mix of old and new transposition syntaxes");if(void 0!=r.transp||void 0!=n.transp||void 0!=n.shift)var c=(r.transp||0)+(n.transp||0)+(n.shift||0);if(void 0!=n.sndtran||void 0!=n.sndsh)var d=(n.sndtran||0)+(n.sndsh||0);if(void 0==c){if(void 0==
d)return}else n.vtransp=c;if(vc())n.okey.fmt=r,n.key=a=x(n.okey);else for(a=n.last_sym;a.type!=m.KEY;)if(a=a.prev,!a){a=n.key;break}void 0!=c&&(a.k_transp=c);void 0!=d&&(a.k_sndtran=d);n.ckey=x(a);n.key.k_none&&(a.k_sf=0)}}function Hd(a,c,d){var e=d.pit;var f=d.acc;!f&&c.k_a_acc&&(f=c.k_map[(e+19)%7]);e=abc2svg.pab40(e,f)+c.k_transp;d.pit=abc2svg.b40p(e);if(f||c.k_a_acc||c.k_none){e=abc2svg.b40a(e);if(f)c.k_a_acc&&(a=c.k_map[(d.pit+19)%7],a==e&&(e=0)),e||(e=3);else if(c.k_none){if(te(a,d.pit))return}else if(c.k_a_acc){if(te(a,
d.pit))return;(a=c.k_map[(d.pit+19)%7])&&(e=3)}else return;d.acc=e}}function ue(a){if("0"==a[0])return 0;if(0<="123456789-+".indexOf(a[0])){var c=parseInt(a);if(isNaN(c)||-36>c||36<c)y(1,J.bad_transp);else return c+=36,40*((c/12|0)-3)+("b"==a.slice(-1)?abc2svg.ifb40:abc2svg.isb40)[c%12]}}function Gd(a){if(!a.k_a_acc&&!a.k_none){var c,d=(a.k_b40+200+a.k_transp)%40;if(c=abc2svg.b40k[d]-d)a.k_transp=0<a.k_transp?a.k_transp+c:a.k_transp-c,d+=c;a.k_b40=d;c=abc2svg.b40sf[d];a.k_old_sf=a.k_sf;a.k_sf=c;a.k_map=
abc2svg.keys[c+7]}}function te(a,c){var d,e=a.time;for(a=a.prev;a;a=a.prev)switch(a.type){case m.BAR:if(a.time<e)return;for(;;){a=a.prev;if(!a)return;if(a.type==m.NOTE){if(a.time+a.dur==e)break;return}if(a.time<e)return}for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==c&&a.notes[d].tie_ty)return a.notes[d].acc;return;case m.NOTE:for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==c)return a.notes[d].acc}}function Zd(a){var c;for(c=0;c<D.length;c++){var d=D[c];if(d.id==a)return d}d=x(n);d.v=D.length;d.id=a;d.sym=d.last_sym=
null;d.key=x(n.key);d.sls=[];delete d.nm;delete d.snm;delete d.new_name;delete d.lyric_restart;delete d.lyric_cont;delete d.sym_restart;delete d.sym_cont;delete d.have_ly;delete d.tie_s;D.push(d);return d}function bc(a){var c;if("|"==a||")"==a)n.last_note?(n.last_note.beam_end=!0,ea?(n.time!=ea.p_voice.time&&(y(1,"Wrong duration in voice overlay"),n.time>ea.p_voice.time&&(ea.p_voice.time=n.time)),n.acc=[],n=ea.p_voice,ea=null):y(1,"Erroneous end of voice overlay")):y(1,J.nonote_vo);else if("("==a)ea?
y(1,"Voice overlay already started"):ea={p_voice:n,time:n.time};else if(n.last_note){n.last_note.beam_end=!0;var d=n.voice_down;if(!d){d=Zd(n.id+"o");n.voice_down=d;d.time=0;d.second=!0;var e=d.v;P.voices[e]={st:n.st,second:!0};var f=P.voices[n.v].range;for(c=0;c<P.voices.length;c++)P.voices[c]&&P.voices[c].range>f&&P.voices[c].range++;P.voices[e].range=f+1}d.ulen=n.ulen;d.dur_fact=n.dur_fact;d.acc=[];if(ea)n!=ea.p_voice&&n.time!=ea.p_voice.time&&(y(1,"Wrong duration in voice overlay"),n.time>ea.p_voice.time&&
(ea.p_voice.time=n.time));else{ea={bar:!0,p_voice:n};c=d.time;for(f=n.last_sym;!(f.type==m.BAR||f.time<=c);f=f.prev);ea.time=f.time}d.time=ea.time;n=d;ea.bar&&ea.time&&va({type:m.BAR,bar_type:a,dur:0,multi:0})}else y(1,J.nonote_vo)}function vc(){var a;if(0!=n.time)return!1;for(a=n.last_sym;a;a=a.prev)if(0!=Pa[a.type])return!1;return!0}function ve(a){if(vc())n.clef=a,a.fmt=r;else{va(a);a.clef_small=!0;var c=a.prev;c&&c.type==m.BAR&&":"!=c.bar_type[0]&&(a.next=c,a.prev=c.prev,a.prev&&(a.prev.next=a),
c.prev=a,c.next=null,n.last_sym=c,a.soln&&(delete a.soln,n.eoln=!0))}}function fd(a){var c,d=D.length;if(1==d&&D[0].default&&(delete D[0].default,0==D[0].time)){var e=D[0];e.id=a;r.transp&&2<=t.state&&(a=n,n=e,Cc(),n=a);return e}for(c=0;c<d;c++)if(e=D[c],e.id==a)return e;e={v:c,id:a,time:0,new:!0,pos:{},scale:1,ulen:oa.ulen,dur_fact:1,key:x(t.ckey),ckey:x(t.ckey),okey:x(t.ckey),meter:x(oa.meter),wmeasure:oa.meter.wmeasure,staffnonote:1,clef:{type:m.CLEF,clef_auto:!0,clef_type:"a",time:0},acc:[],sls:[],
hy_st:0};D.push(e);return e}function Id(){U=-1;D=[];n=null;re(!0);ob=-1;H={};ia=[];Gb={}}function qe(){var a=n.clone;var c=a.vs,d=a.a,e=a.bol,f=t.istart,g=t,h=t.file;delete n.clone;"["==h[f-1]&&f--;Lb++;for(a=0;a<c.length;a++)t=Object.create(g),t.line=Object.create(g.line),Wc(c[a],d),Mc(t.fname,h,e,f);Lb--;t=g}function Wc(a){var c=dc(a),d=c.shift();if(d)if(n&&n.clone&&qe(),a=0<d.indexOf(",")?d.split(","):[d],2>t.state)for(;;){d=a.shift();if(!d)break;c.length&&Kc(d,c);"*"!=d&&1==t.state&&(n=fd(d))}else"*"==
d?y(1,"Cannot have V:* in tune body"):(n=fd(a[0]),1<a.length&&(a.shift(),n.clone={vs:a,a:c,bol:t.iend},"]"!=t.file[n.clone.bol-1]&&n.clone.bol++),mc(c),2==t.state&&Fa(),Cc(),a=n.v,n.new&&(delete n.new,0>ob&&(n.st=n.cst=++U,P.nstaff=U,P.voices[a]={st:U,range:a},P.staves[U]={stafflines:n.stafflines||"|||||",staffscale:1})),!n.filtered&&P.voices[a]&&(t.voice_opts||t.tune_v_opts)&&(n.filtered=!0,Bf()))}function Fa(a){var c={type:m.STAVES,dur:0,sy:P};wa();var d;var e=Wb();ma(r.topspace);if(r.titleformat){var f,
g,h;var l={};var k=x(Cf);var p={A:r.infospace,C:r.composerspace,O:r.composerspace,R:r.infospace};var q={};var B="";var z=r.titleformat;for(d=0;;){for(;" "==z[d];)d++;var v=z[d++];if(!v)break;if("A">v||"Z"<v)switch(v){case "+":var u="+";v=z[d++];break;case ",":B+="\n";default:continue;case "<":u="l";v=z[d++];break;case ">":u="r",v=z[d++]}else switch(z[d]){case "-":u="l";d++;break;case "1":u="r";d++;break;case "0":d++;default:u="c"}if(l[v])q[v]++;else{if(!S[v])continue;l[v]=S[v].split("\n");q[v]=1}B+=
u+v}var y={l:r.titlespace,c:r.titlespace,r:r.titlespace};e={l:0,c:.5*e,r:e};var A={},F;z=B+"\n";for(d=0;;){A.l=A.c=A.r=h=0;for(g=d;;){u=z[g++];if("\n"==u)break;v=z[g++];if("+"!=u&&!A[u]&&(F=l[v])){(f=k[v])||(f="history");B=Ga(f);var G=1.1*B.size;p[v]&&(G+=p[v]);h<G&&(h=G);A[u]=G}}y.l+=h-A.l;y.c+=h-A.c;for(y.r+=h-A.r;;){u=z[d++];if("\n"==u)break;v=z[d++];if(l[v].length){F=l[v].shift();"+"==z[d]&&(q[v]--,d++,v=z[d++],l[v].length&&(F=F?F+(" "+l[v].shift()):" "+l[v].shift()));(f=k[v])||(f="history");
B=Ga(f);G=1.1*B.size;p[v]&&(G+=p[v]);V(B);g=e[u];h=y[u]+G;"Q"==v?(X.set_width(oa.tempo),oa.tempo.invis||("l"!=u&&(oe(oa.tempo),w=oa.tempo.tempo_wh[0],"c"==u&&(w*=.5),g-=w),xd(oa.tempo,g,-h))):F&&("T"==v&&(F=de(F,"s"==k.T[0])),na(g,-h,F,u));"T"==v&&(f=k.T="subtitle",p.T=r.subtitlespace);if(1>=q[v])for("T"==v&&(B=Ga(f),G=1.1*B.size,p[v]&&(G+=p[v]),V(B));0<l[v].length;)h+=G,F=l[v].shift(),na(g,-h,F,u);q[v]--;y[u]=h}}y.c>y.l&&(y.l=y.c);y.r>y.l&&(y.l=y.r);if(d>=z.length)break;y.c=y.r=y.l}ma(y.l);ma(r.musicspace)}else{if(S.T&&
0<=r.writefields.indexOf("T"))for(v=0;;){u=S.T.indexOf("\n",v);if(0>u){$c(S.T.substring(v),0!=v);break}$c(S.T.slice(v,u),0!=v);v=u+1}z=0;t.ckey.k_bagpipe&&!r.infoline&&0<=r.writefields.indexOf("R")&&(q=S.R);q&&(V("composer"),na(0,-r.composerspace,q),z=r.composerspace);l=S.A;0<=r.writefields.indexOf("C")&&(k=S.C);0<=r.writefields.indexOf("O")&&(p=S.O);if(k||p||r.infoline){V("composer");ma(r.composerspace);0>r.aligncomposer?(y=0,A=" "):0==r.aligncomposer?(y=.5*e,A="c"):(y=e,A="r");d=z;if(k||p){0<=r.aligncomposer&&
z!=d&&ma(z-d);for(v=0;;){ma(H.curfont.size);u=k?k.indexOf("\n",v):-1;if(0>u){ee(y,0,k?k.substring(v):null,p,A);break}na(y,0,k.slice(v,u),A);z+=H.curfont.size;v=u+1}d>z&&ma(d-z)}((q=q?null:S.R)||l)&&r.infoline&&(V("info"),ma(H.curfont.size+r.infospace),ee(e,0,q,l,"r"),z+=H.curfont.size+r.infospace)}else d=r.composerspace;S.P&&0<=r.writefields.indexOf("P")&&(V("parts"),z=r.partsspace+H.curfont.size-z,0<z&&(d+=z),.01<d&&ma(d),na(0,0,S.P),d=0);ma(d+r.musicspace)}Zb=0<=r.writefields.indexOf("M")?3:2;oa.new_nbar?
(H.nbar=oa.new_nbar,oa.new_nbar=0):H.nbar=1;t.state=3;D.length?n||(n=D[0>ob?0:P.top_voice]):(Wc("1"),n.clef.istart=n.key.istart,n.clef.iend=n.key.iend,n.default=!0);n.init||a||(mc([]),Cc());for(a=0;a<D.length;a++)e=D[a],e.ulen=oa.ulen,e.ckey.k_bagpipe&&!e.pos.stm&&(e.pos=x(e.pos)&-8,e.pos.stm|=m.SL_BELOW);if(0>ob){U=D.length-1;for(a=0;a<=U;a++)e=D[a],delete e.new,e.st=e.cst=a,P.voices[a]={st:a,range:a},P.staves[a]={stafflines:e.stafflines||"|||||",staffscale:1};P.nstaff=U}e=n;n=D[P.top_voice];va(c);
n=e}function jf(a,c){var d;if(!n.ignore){if(c){if(c=n.sym_cont,!c){y(1,"+: symbol line without music");return}}else if(n.sym_restart?(n.sym_start=c=n.sym_restart,n.sym_restart=null):c=n.sym_start,c||(c=n.sym),!c){y(1,"s: without music");return}for(d=0;;){for(;" "==a[d]||"\t"==a[d];)d++;var e=a[d];if(!e)break;switch(e){case "|":for(;c&&c.type!=m.BAR;)c=c.next;if(!c){y(1,"Not enough measure bars for symbol line");return}c=c.next;d++;continue;case "!":case '"':var f=++d;d=a.indexOf(e,f);if(0>d){y(1,
"!"==e?"No end of decoration":"No end of guitar chord");d=a.length;continue}var g=a.slice(f-1,d+1);break;case "*":break;default:g=e.charCodeAt(0);if(128>g&&(g=La[g],1<g.length&&("!"==g[0]||'"'==g[0]))){e=g[0];break}y(1,J.bad_char,e)}for(;c&&(c.type!=m.NOTE||c.grace);)c=c.next;if(!c){y(1,"Too many elements in symbol line");return}switch(e){case "!":Hb([g.slice(1,-1)],c,c.prev);break;case '"':ae(g),Xa&&wc(c)}c=c.next;d++}n.sym_cont=c}}function kf(a,c){var d;if(!n.ignore){(n.pos.voc&7)!=m.SL_HIDDEN&&
(n.have_ly=!0);if(c){c=n.lyric_cont;if(!c){y(1,"+: lyric without music");return}var e=Ga("vocal");H.deffont!=e&&(H.curfont==H.deffont&&(H.curfont=e),H.deffont=e)}else if(V("vocal"),n.lyric_restart?(n.lyric_start=c=n.lyric_restart,n.lyric_restart=null,n.lyric_line=0):(n.lyric_line++,c=n.lyric_start),c||(c=n.sym),!c){y(1,"w: without music");return}e=0;for(d=H.curfont;;){for(;" "==a[e]||"\t"==a[e];)e++;if(!a[e])break;var f=0;var g=t.istart+e+2;switch(a[e]){case "|":for(;c&&c.type!=m.BAR;)c=c.next;if(!c){y(1,
"Not enough measure bars for lyric line");return}c=c.next;e++;continue;case "-":case "_":var h=a[e];f=2;break;case "*":h="";break;default:for(h="";a[e];){switch(a[e]){case "_":case "*":case "|":e--;case " ":case "\t":break;case "~":h+="\u00a0";e++;continue;case "-":f=1;break;case "\\":if(!a[++e])continue;h+=a[e++];continue;case "$":h+=a[e++];var l=a[e];"0"==l?H.curfont=H.deffont:"1"<=l&&"9">=l&&(H.curfont=Ga("u"+l));default:h+=a[e++];continue}break}}for(;c&&(c.type!=m.NOTE||c.grace);)c=c.next;if(!c){y(1,
"Too many words in lyric line");return}h&&(c.pos.voc&7)!=m.SL_HIDDEN&&(h={t:h,font:d,istart:g,iend:g+h.length},f&&(h.ln=f),c.a_ly||(c.a_ly=[]),c.a_ly[n.lyric_line]=h,d=H.curfont);c=c.next;e++}n.lyric_cont=c}}function pc(a){var c,d,e,f,g=a,h=0,l=0,k=0,n=0,t=a.a_ly,B=0;for(e=a.ts_next;e;e=e.ts_next){e.shrink&&(n+=e.shrink,k++);if(e.bar_type){n+=3;break}if(e.a_ly){for(c=e.a_ly.length;0<=--c&&(!(d=e.a_ly[c])||2==d.ln););if(0<=c)break}}for(c=0;c<t.length;c++)if(d=t[c])if(H.curfont=d.font,d.t=f=xb(d.t),
2==d.ln)d.shift=0;else{var u=Zc(" ")*d.font.swfac;var v=f.wh[0]+1.5*u;if(a.type==m.GRACE)var r=a.wl;else"0"<=f[0]&&"9">=f[0]&&2<f.length||":"==f[1]||"("==f[0]||")"==f[0]?("("!=f[0]&&(u=f.indexOf("\u00a0"),V(d.font),u=0<u?sa(f.slice(0,u))[0]:.2*v),v-=u,r=.4*v,14<r&&(r=14),r+=u,"0"<=f[0]&&"9">=f[0]&&r>B&&(B=r)):(r=.4*v,14<r&&(r=14));d.shift=r;r>l&&(l=r);v-=r;v>h&&(h=v)}for(;!g.seqst;)g=g.ts_prev;g.ts_prev.bar_type&&(l-=4);g.wl<l&&(g.shrink+=l-g.wl,g.wl=l);n-=6;if(n<h)for(n=(h-n)/k,a=a.ts_next;;){a.shrink&&
(a.shrink+=n,g.wr+=n,g=a);if(a==e)break;a=a.ts_next}if(0<B)for(c=0;c<t.length;c++)(d=t[c])&&"0"<=d.t[0]&&"9">=d.t[0]&&(d.shift=B)}function we(a,c,d){var e,f,g;if(a.hy_st&1<<c){var h=!0;a.hy_st&=~(1<<c)}for(e=a.sym;e.type==m.CLEF||e.type==m.KEY||e.type==m.METER;e=e.next);var l=e.prev?e.prev.x:N.x;for(g=0;e;e=e.next)if(f=e.a_ly?e.a_ly[c]:null){f.font!=H.curfont&&(H.curfont=f.font);var k=f.t;var n=k.wh[0];var t=f.shift;h&&(2==f.ln&&"_"==k?k="-":2!=f.ln&&(ie(l,d,e.x-t-l),h=!1,l=e.x+e.wr));if(u&&(2!=f.ln||
"_"!=k)){dd(l+3,d,g-l+3);var u=!1;l=e.x+e.wr}if(2==f.ln)0==g&&l>e.x-18&&(l=e.x-18),"-"==k?h=!0:u=!0,g=e.x-t;else{g=e.x-t;f.ln&&(h=!0);if(q.anno_start||q.anno_stop){var r={st:e.st,istart:f.istart,iend:f.iend,x:g,y:d,ymn:d,ymx:d+H.curfont.size,wl:0,wr:n};ta(r,"lyrics")}na(g,d,k);Wa(r,"lyrics");l=g+n}}else switch(e.type){case m.REST:case m.MREST:u&&(dd(l+3,d,g-l),u=!1,l=e.x+e.wr)}h&&(g=ua-10,g<l+10&&(g=l+10),ie(l,d,g-l),a.s_next&&a.s_next.fmt.hyphencont&&(a.hy_st|=1<<c));for(a.s_next;e;e=e.next)if(e.type==
m.NOTE){if(!e.a_ly)break;(f=e.a_ly[c])&&f.ln&&"_"==f.t&&(u=!0,g=ua-15,g<l+12&&(g=l+12));break}u&&dd(l+3,d,g-l+3)}function xe(a,c,d,e,f){var g=A[a.st].staffscale;V("vocal");if(0<f){e>-N.fmt.vocalspace&&(e=-N.fmt.vocalspace);e*=g;for(f=0;f<c;f++)e-=1.1*d[f],we(a,f,e);return(e-d[f-1]/6)/g}f=A[a.st].topbar+N.fmt.vocalspace;e<f&&(e=f);e*=g;for(f=c;0<=--f;)we(a,f,e),e+=1.1*d[f];return e/g}function Ye(){var a,c,d,e,f,g=Array(U+1),h=D.length,l=Array(h),k=Array(h),n=Array(h),t=Array(h),u=0,r=0,v=-1;for(c=
0;c<h;c++){var q=D[c];if(q.sym){q.st!=v&&(r=u=0,v=q.st);var y=0;if(q.have_ly)for(l[c]||(l[c]=[]),a=q.sym;a;a=a.next){if(e=a.a_ly){var x=a.x;var A=10;for(d=0;d<e.length;d++)if(f=e[d]){x-=f.shift;A=f.t.wh[0];break}d=Q(q.st,1,x,A);u<d&&(u=d);d=Q(q.st,0,x,A);for(r>d&&(r=d);y<e.length;)l[c][y++]=0;for(d=0;d<e.length;d++)(f=e[d])&&(!l[c][d]||f.t.wh[1]>l[c][d])&&(l[c][d]=f.t.wh[1])}}else d=Q(q.st,1,0,ua),u<d&&(u=d),d=Q(q.st,0,0,ua),r>d&&(r=d);g[v]||(g[v]={});g[v].top=u;g[v].bot=r;k[c]=y;0!=y&&(n[c]=q.pos.voc?
(q.pos.voc&7)==m.SL_ABOVE:D[c+1]&&D[c+1].st==v&&D[c+1].have_ly?!0:!1,n[c]?g[v].a=!0:g[v].b=!0)}}for(c=d=0;c<h;c++)q=D[c],q.sym&&q.have_ly&&(n[c]?t[d++]=c:(v=q.st,za(v,!0),0<k[c]&&(g[v].bot=xe(q,k[c],l[c],g[v].bot,1))));for(;0<=--d;)c=t[d],q=D[c],v=q.st,za(v,!0),g[v].top=xe(q,k[c],l[c],g[v].top,-1);for(c=0;c<h;c++)if(q=D[c],q.sym){v=q.st;if(g[v].a)for(u=g[v].top+2,a=q.sym.next;a;a=a.next)a.a_ly&&R(v,1,a.x-2,10,u);if(g[v].b)if(r=g[v].bot-2,0<k[q.v])for(a=q.sym.next;a;a=a.next)a.a_ly&&R(v,0,a.x-2,10,
r);else R(v,0,0,ua,r)}}function ae(a){function c(){for(var a="";;){p=l[d++];if(0>"1234567890.-".indexOf(p))return parseFloat(a);a+=p}}var d,e=Ga("annotation"),f=e.size;var g=t.line;var h=t.bol+g.index;if(1<a.length){var l=a.slice(1,-1);var k=h+1}else{for(d=++g.index;;){a=g.buffer.indexOf('"',d);if(0>a){y(1,"No end of guitar chord");return}if("\\"!=g.buffer[a-1])break;d=a+1}l=Ed(g.buffer.slice(g.index,a));g.index=a;k=t.bol+g.index+1}e.pad&&(f+=e.pad);d=0;for(a="g";;){var p=l[d];if(!p)break;g={text:"",
istart:h,iend:k,font:e};switch(p){case "@":a=p;d++;var u=c();if(","!=p){y(1,"',' lacking in annotation '@x,y'");var r=0}else r=c()," "!=p&&d--;g.x=u;g.y=r-f/2;break;case "^":g.pos=m.SL_ABOVE;case "_":"_"==p&&(g.pos=m.SL_BELOW);case "<":case ">":d++;a=p;break;default:switch(a){case "g":g.font=Ga("gchord");g.pos=n.pos.gch||m.SL_ABOVE;break;case "^":g.pos=m.SL_ABOVE;break;case "_":g.pos=m.SL_BELOW;break;case "@":g.x=u,r-=f,g.y=r-f/2}}for(g.type=a;;){p=l[d];if(!p)break;switch(p){case "\\":p=l[++d];if(!p||
"n"==p)break;g.text+="\\";default:g.text+=p;d++;continue;case "&":for(;;){g.text+=p;p=l[++d];switch(p){default:continue;case ";":case void 0:case "\\":}break}if(";"==p){d++;g.text+=p;continue}case ";":}d++;break}g.otext=g.text;Xa||(Xa=[]);Xa.push(g)}}function ye(a,c){var d,e,f=a.split("/");for(d=0;d<f.length;d++){a=f[d];var g=a.search(/[A-G]/);if(!(0>g)){var h=g+1;for(e=0;"#"==a[h]||"\u266f"==a[h];)e++,h++;for(;"b"==a[h]||"\u266d"==a[h];)e--,h++;var l=ze.indexOf(a[g])+16;l=(abc2svg.pab40(l,e)+c+200)%
40;l=abc2svg.b40k[l];f[d]=a.slice(0,g)+ze[abc2svg.b40_p[l]]+Df[abc2svg.b40_a[l]+2]+a.slice(h)}}return f.join("/")}function wc(a){a.a_gch=a.a_gch?a.a_gch.concat(Xa):Xa;Xa=null;if(n.vtransp)for(var c,d=a.a_gch.length;0<=--d;)c=a.a_gch[d],"g"==c.type&&(c.text=ye(c.text,n.vtransp))}function Qe(){function a(a){var c,d,f;for(d=e;d;d=d.ts_next)if(c=d.a_gch){var g=c.length-a-1;if(c=c[g]){if(c.pos==m.SL_ABOVE){var h=d.x+c.x;(f=c.text.wh[0])&&h+f>ua&&(h=ua-f);f=Q(d.st,1,h,f);"g"==c.type&&f<l[d.st].yup&&(f=
l[d.st].yup)}else if(c.pos==m.SL_BELOW||c.pos==m.SL_HIDDEN)continue;else h=d.x+c.x,f=c.y;X.draw_gchord(g,d,h,f)}}}function c(a){for(var c,d,f,g=e;g;g=g.ts_next)(c=g.a_gch)&&(c=c[a])&&c.pos==m.SL_BELOW&&(d=g.x+c.x,(f=c.text.wh[0])&&d+f>ua&&(d=ua-f),f=Q(g.st,0,d,f),"g"==c.type&&f>l[g.st].ydn&&(f=l[g.st].ydn),X.draw_gchord(a,g,d,f))}var d,e,f,g,h=0,l=Array(U+1);for(g=0;g<=U;g++)l[g]={ydn:A[g].botbar-3,yup:A[g].topbar+4};for(d=N;d;d=d.ts_next)if(f=d.a_gch)for(e||(e=d),g=f.length,g>h&&(h=g);0<=--g;)if("g"==
f[g].type){f=f[g];g=f.text.wh[0];f.pos==m.SL_ABOVE?(f=Q(d.st,!0,d.x,g),f>l[d.st].yup&&(l[d.st].yup=f)):f.pos==m.SL_BELOW&&(f=Q(d.st,!1,d.x,g),f<l[d.st].ydn&&(l[d.st].ydn=f));break}if(e)for(za(-1),g=0;g<h;g++)a(g),c(g)}function hf(){function a(a){for(var c=0;c<a.length;c++)a[c](X)}var c=abc2svg.modules.hooks,d=abc2svg.modules.g_hooks;Ae?c.length&&(a(c),d.push.apply(d,c),abc2svg.modules.hooks=[]):(c.length&&(d.push.apply(d,c),abc2svg.modules.hooks=[]),a(d),Ae=!0)}var m=abc2svg.C,Da,J={bad_char:"Bad character '$1'",
bad_grace:"Bad character in grace note sequence",bad_transp:"Bad transpose value",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%score",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",not_ascii:"Not an ASCII character",not_enough_n:"Not enough notes/rests for %%repeat",not_enough_m:"Not enough measures for %%repeat",not_enough_p:"Not enough parameters in %%map",
not_in_tune:"Cannot have '$1' inside a tune",notransp:"Cannot transpose with a temperament"},X=this,oa={meter:{type:m.METER,wmeasure:1,a_meter:[]}},S={},t={ctx:{},prefix:"%",state:0,ottava:[],line:new O},Nc=[],pe,qb={},ia,Gb,Ec={dot:"0 stc 5 1 1",tenuto:"0 emb 5 3 3",slide:"1 sld 3 7 0",arpeggio:"2 arp 12 10 0",roll:"3 roll 3,3 6 6",fermata:"3 hld 5,5 7 7",emphasis:"3 accent 3.5,3.5 4 4",lowermordent:"3 lmrd 4,4 5 5",coda:"3 coda 24 10 10",uppermordent:"3 umrd 4,4 5 5",segno:"3 sgno 22 8 8",trill:"3 trl 14 5 5",
upbow:"3 upb 10 5 5",downbow:"3 dnb 9 5 5",gmark:"3 grm 6 5 5",wedge:"0 wedge 7 3 3",turnx:"3 turnx 5,5 6 6",breath:"3 brth 0 1 20",longphrase:"3 lphr 0 1 1",mediumphrase:"3 mphr 0 1 1",shortphrase:"3 sphr 0 1 1",invertedfermata:"3 hld 5,5 7 7",invertedturn:"3 turn 5,5 6 6",invertedturnx:"3 turnx 5,5 6 6",0:"3 fng 5,5 3 3 0",1:"3 fng 5,5 3 3 1",2:"3 fng 5,5 3 3 2",3:"3 fng 5,5 3 3 3",4:"3 fng 5,5 3 3 4",5:"3 fng 5,5 3 3 5",plus:"3 dplus 7 3 3","+":"3 dplus 7 3 3",accent:"3 accent 3.5,3.5 4 4",">":"3 accent 3.5,3.5 4 4",
marcato:"3 marcato 9 3 3","^":"3 marcato 9 3 3",mordent:"3 lmrd 4,4 5 5",open:"3 opend 10 3 3",snap:"3 snap 14 3 3",thumb:"3 thumb 14 3 3",dacapo:"3 dacs 16 20 20 Da Capo",dacoda:"3 dacs 16 20 20 Da Coda","D.C.":"3 dcap 16 10 10","D.S.":"3 dsgn 16 10 10","D.C.alcoda":"3 dacs 16 38 38 D.C. al Coda","D.S.alcoda":"3 dacs 16 38 38 D.S. al Coda","D.C.alfine":"3 dacs 16 38 38 D.C. al Fine","D.S.alfine":"3 dacs 16 38 38 D.S. al Fine",fine:"3 dacs 16 10 10 Fine",turn:"3 turn 5,5 6 6","trill(":"3 ltr 8 4 0",
"trill)":"3 ltr 8 4 0",f:"6 f 18 4 4",ff:"6 ff 18 6 6",fff:"6 fff 18 9 9",ffff:"6 ffff 18 12 12",mf:"6 mf 18 9 9",mp:"6 mp 18 10 10",p:"6 p 18 5 5",pp:"6 pp 18 9 9",ppp:"6 ppp 18 13 13",pppp:"6 pppp 18 17 17",pralltriller:"3 umrd 4,4 5 5",sfz:"6 sfz 18 8 8",ped:"4 ped 18 6 10","ped-up":"4 pedoff 12 4 4","ped(":"4 lped 20 5 5","ped)":"4 lped 20 5 5","crescendo(":"6 cresc 18 0 0","crescendo)":"6 cresc 18 0 0","<(":"6 cresc 18 0 0","<)":"6 cresc 18 0 0","diminuendo(":"6 dim 18 0 0","diminuendo)":"6 dim 18 0 0",
">(":"6 dim 18 0 0",">)":"6 dim 18 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0","~)":"8 glisq 0 0 0","8va(":"3 8va 10 0 0","8va)":"3 8va 10 0 0","8vb(":"4 8vb 10 0 0","8vb)":"4 8vb 10 0 0","15ma(":"3 15ma 10 0 0","15ma)":"3 15ma 10 0 0","15mb(":"4 15mb 10 0 0","15mb)":"4 15mb 10 0 0",invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",rbstop:"37 0 0 0 0",
"/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0",editorial:"42 0 0 0 0","sacc-1":"3 sacc-1 6,4 4 4",sacc3:"3 sacc3 6,5 4 4",sacc1:"3 sacc1 6,4 4 4",courtesy:"43 0 0 0 0","cacc-1":"3 cacc-1 0 0 0",cacc3:"3 cacc3 0 0 0",cacc1:"3 cacc1 0 0 0","tie(":"44 0 0 0 0","tie)":"44 0 0 0 0"},md=[function(a){var c,d=a.s,e=a.dd;if(!e.str){if(c="^"==e.ty?1:"_"==e.ty?0:d.multi?0<d.multi:0>d.stem)var f=d.ymx|0;else"w"==
e.name[0]?(a.inv=!0,f=d.ymn):f=d.ymn-e.h;-6<f&&24>f&&(c&&(f+=3),f=6*((f+6)/6|0)-6);c?d.ymx=f+e.h:d.ymn="w"==e.name[0]?f-e.h:f;a.y=f;d.type==m.NOTE&&(a.x+=d.notes[0<=d.stem?0:d.nhd].shhd);"d"==e.name[0]&&-1<=d.nflags&&(c?0<d.stem&&(a.x+=3.5):0>d.stem&&(a.x-=3.5))}},function(a){var c,d=a.s,e=d.notes[0].pit,f=5;for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=4+d.notes[c].shac;else switch(g=5-d.notes[c].shhd,d.head){case m.SQUARE:g+=3.5;break;case m.OVALBARS:case m.OVAL:g+=2}d.notes[c].pit<=e+3&&g>f&&(f=
g)}a.x-=f;a.y=3*(e-18)},function(a){var c,d=a.s,e=a.dd,f=5;if(d.type==m.NOTE)for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=5+d.notes[c].shac;else switch(g=6-d.notes[c].shhd,d.head){case m.SQUARE:g+=3.5;break;case m.OVALBARS:case m.OVAL:g+=2}g>f&&(f=g)}g=3*(d.notes[d.nhd].pit-d.notes[0].pit)+4;c=e.h;g<c&&(g=c);a.has_val=!0;a.val=g;a.x-=f;a.y=3*(d.notes[0].pit-18)-3}],nd=[null,null,null,Dc,Dc,kd],Fb=[null,null,null,null,null,null,function(a){var c,d=a.s,e=a.dd;if(!a.ldst)if((a.pos&m.SL_ALI_MSK)==m.SL_CLOSE||
0==(a.pos&m.SL_ALI_MSK)&&0>d.fmt.dynalign)Dc(a);else if(a.start)jd(a);else{a.val=e.wl+e.wr;if(c=fc(d,a.pos))a.up=!0;var f=d.x;if(0<a.ix){var g=ia[a.ix-1];if(g.s==d&&(a.up&&!g.up||!a.up&&g.up)){var h=g.dd;Fb[h.func]&&(h=g.x+g.val+4,h>f&&(f=h))}}a.x=f;a.y=Q(d.st,c,f,a.val);c||(a.y-=e.h)}},jd];Abc.prototype.draw_all_deco=function(){if(ia.length){var a,c,d=[],e=[];var f=U;for(c=A[f].y;0<=--f;){var g=A[f].y;e[f]=.5*(c+24+g);c=g}for(;;){var h=ia.shift();if(!h)break;if((a=h.dd)&&!a.dd_en){var l=h.s;var k=
a.glyph;var n=k.indexOf("/");0<n&&(k=0<=l.stem?k.slice(0,n):k.slice(n+1));Fb[a.func]?Aa(l.st):jb(l);f=h.st;if(A[f].topbar){n=h.x;c=h.y+A[f].y;if(void 0!=h.m)f=l.notes[h.m],f.shhd&&(n+=f.shhd*I.scale);else if(Fb[a.func]&&((h.pos&m.SL_ALI_MSK)==m.SL_CENTER||0==(h.pos&m.SL_ALI_MSK)&&!l.fmt.dynalign)&&(h.up&&0<f||!h.up&&f<U)){var t=h.up?e[--f]:e[f++];t-=.5*a.h;if(h.up&&c<t||!h.up&&c>t)if(g=Q(f,!h.up,h.x,h.val)+A[f].y,h.up&&(g-=a.h),h.up&&g>t||!h.up&&g<t)c=t}if((f=q[k])&&"function"==typeof f)f(n,c,h);
else if(!X.psdeco(k,n,c,h)){ta(l,"deco");h.inv&&(Jb(n,c,0,1,-1),n=c=0);if(h.has_val)2!=a.func||0>I.st?ed(n,c,k,h.val/I.scale,h.defl):ed(n,c,k,h.val,h.defl),h.cont&&d.push(h.start);else if(void 0!=a.str)h=a.str,"@"==h[0]&&(a=h.match(/^@([0-9.-]+),([0-9.-]+);?/),n+=Number(a[1]),c+=Number(a[2]),h=h.replace(a[0],"")),je(n,c,k,h);else if(h.lden)if(k=h.dd.glyph,Be[k])Be[k](n,c,h);else u(1,null,"No function for decoration '$1'",k);else ca(n,c,k);I.g&&Ob();Wa(l,"deco")}}}}ia=d}};var $b,cb=[],Ef=[[16,16,14,
12,10,10],[14,14,10,9,9,9]];Abc.prototype.calculate_beam=function(a,c){var d,e,f,g,h,l;if(!c.beam_st){var k=od(c);oc(k,c);Sb(k,c);k.x-=12;k.x>c.prev.x+12&&(k.x=c.prev.x+12);k.beam_st=!0;delete k.beam_end;k.tmp=!0;delete k.sls;c=k}var n=e=0;var t=f=!1;var u=c.st;var r=c.v;var v=c.grace?2.3:3.5;for(d=c;d.type!=m.NOTE||(d.nflags>e&&(e=d.nflags),n++,d.st!=u&&(t=!0),d.stem!=c.stem&&(f=!0),g||d.invis||d.stemless&&!d.trem2||(g=!0),!d.beam_end);d=d.next)if(!d.next){for(;d.type!=m.NOTE;d=d.prev);k=od(d);k.next=
d.next;k.next&&(k.next.prev=k);d.next=k;k.prev=d;k.ts_next=d.ts_next;k.ts_next&&(k.ts_next.ts_prev=k);d.ts_next=k;k.ts_prev=d;delete k.beam_st;k.beam_end=!0;k.tmp=!0;delete k.sls;k.x+=12;k.x<ua-12&&(k.x=ua-12);d=k;n++;break}if(!g)return!1;a.s2=d;if(0==A[u].y){if(t)return!1}else if(!t)return a.s1=c,a.a=(c.ys-d.ys)/(c.xs-d.xs),a.b=c.ys-c.xs*a.a+A[u].y,a.nflags=e,!0;var q=c;var y=100;var x=0;for(k=c;k.type!=m.NOTE||(1==(l=k.p_v.scale)&&(l=A[k.st].staffscale),0<=k.stem?(g=v+k.notes[0].shhd,k.notes[k.nhd].pit>
x&&(x=k.notes[k.nhd].pit,q=k)):(g=-v+k.notes[k.nhd].shhd,k.notes[0].pit<y&&(y=k.notes[0].pit,q=k)),k.xs=k.x+g*l,k!=d);k=k.next);k.grace&&c.fmt.flatbeams?h=0:!f&&3<=n&&q!=c&&q!=d&&(h=0);g=c.ys+A[u].y;void 0==h&&(h=(d.ys+A[d.st].y-g)/(d.xs-c.xs));0!=h&&(h=c.fmt.beamslope*h/(c.fmt.beamslope+Math.abs(h)));n=(g+d.ys+A[d.st].y)/2-h*(d.xs+c.xs)/2;v=0;k=c;if(f)g=.5*((c.grace?3.5:5)*(e-1)+3.2),n=c.stem!=d.stem&&c.nflags<d.nflags?n+g*d.stem:n+g*c.stem;else if(c.grace)for(;g=h*k.xs+n-A[k.st].y,x=13,x=0<k.stem?
x-(g-3*(k.notes[k.nhd].pit-18)):x+(g-3*(k.notes[0].pit-18)),x+=3*(k.nflags-1),x>v&&(v=x),k!=d;k=k.next);else{for(y=3.2+5*(e-1);k.ts_prev&&k.ts_prev.type==m.NOTE&&k.ts_prev.time==k.time&&k.ts_prev.x>c.xs;)k=k.ts_prev;for(;k&&k.time<=d.time;k=k.ts_next)if(!(k.type!=m.NOTE||k.invis||k.st!=u&&k.v!=r)){g=k.v==r?k.xs:k.x;g=h*g+n-A[k.st].y;if(k.v==r)x=Ef[0==k.nhd?0:1][k.nflags],0<k.stem?(26<k.notes[k.nhd].pit&&(x-=2,28<k.notes[k.nhd].pit&&(x-=2)),x-=g-3*(k.notes[k.nhd].pit-18)):(18>k.notes[0].pit&&(x-=2,
16>k.notes[0].pit&&(x-=2)),x-=3*(k.notes[0].pit-18)-g),x+=3.2+5*(k.nflags-1);else{if(0<c.stem)if(0<k.stem){if(k.ymn>g+4||k.ymx<g-y-2)continue;x=k.v>r?k.ymx-g:k.ymn+8-g}else x=k.ymx-g;else if(0>k.stem){if(k.ymx<g-4||k.ymn>g-y-2)continue;x=k.v<r?g-k.ymn:g-k.ymx+8}else x=g-k.ymn;x+=2+y}x>v&&(v=x)}}0<v&&(n+=c.stem*v);if(!t&&!f)for(k=c.next;;k=k.next){switch(k.type){case m.REST:if(r=k.ts_next,!r||r.st!=u||r.type!=m.NOTE&&r.type!=m.REST)break;case m.BAR:if(k.invis)break;case m.CLEF:g=h*k.x+n;0<c.stem?(g=
k.ymx-g+3.2+5*(e-1)+2,0<g&&(n+=g)):(g=k.ymn-g-3.2-5*(e-1)-2,0>g&&(n+=g));break;case m.GRACE:for(r=k.extra;r;r=r.next)g=h*r.x+n,0<c.stem?(g=r.ymx-g+3.2+5*(e-1)+2,0<g&&(n+=g)):(g=r.ymn-g-3.2-5*(e-1)-2,0>g&&(n+=g))}if(k==d)break}0==h&&(n+=Se(c.grace,c.stem,e,n-A[u].y));for(k=c;;k=k.next){switch(k.type){case m.NOTE:k.ys=h*k.xs+n-A[k.st].y;0<k.stem?(k.ymx=k.ys+2.5,k.ts_prev&&0<k.ts_prev.stem&&k.ts_prev.st==k.st&&k.ts_prev.ymn<k.ymx&&k.ts_prev.x==k.x&&0==k.notes[0].shhd&&(k.ts_prev.x-=3,k.ts_prev.xs-=3)):
k.ymn=k.ys-2.5;break;case m.REST:g=h*k.x+n-A[k.st].y;r=3.2+5*(e-1)+(k.head!=m.FULL?4:9);if(0<c.stem){if(g-=r,0==c.multi&&12<g&&(g=12),k.y<=g)break}else if(g+=r,0==c.multi&&12>g&&(g=12),k.y>=g)break;k.head!=m.FULL&&(g=6*((g+3+12)/6|0)-12);k.y=g}if(k==d)break}if(0==A[u].y)return!1;a.s1=c;a.a=h;a.b=n;a.nflags=e;return!0};var sd={};Abc.prototype.draw_hl=function(a){var c,d,e=[],f=A[a.st];if(f.hll){for(c=0;c<=a.nhd;c++){var g=a.notes[c];f.hlmap[g.pit-f.hll]||e.push([g.pit-18,g.shhd*I.scale])}if(d=e.length){var h=
f.stafflines,l=h.length-1,k=l,m=f.botline/6,n=m,r=a.grace?4:1.3*Ce[a.head];g=a.notes[0>a.stem?a.nhd:0];var t=g.shhd;for(c=0;c<e.length;c++){var u=e[c][0];g=(e[c][1]<t?e[c][1]:t)-r;var q=(e[c][1]>t?e[c][1]:t)+r;u<2*m?(u<2*n&&(n=++u>>1),d--):u>2*l&&(k=u>>1,d--);Nb(f,u>>1,a.x,g,q)}g=t-r;for(q=t+r;++n<m;)Nb(f,n,a.x,g,q);for(;--k>l;)Nb(f,k,a.x,g,q);if(d){c=n;for(d=k;c>m&&"-"==h[c];)c--;for(;d<l&&"-"==h[d];)d++;for(;c<d;c++)"-"==h[c]&&Nb(f,c,a.x,g,q)}}}};var De=new Int8Array([24,9,15,21,6,12,18]),Ee=new Int8Array([12,
18,24,9,15,21,6]),Fe=new Int8Array([-9,12,-9,-9,12,-9]),Ge=new Int8Array([12,-9,12,-9,12,-9]),He=new Int8Array([9,-12,9,-12,9,-12]),Ie=new Int8Array([-12,9,-12,9,-12,9]);Abc.prototype.draw_keysig=function(a,c){var d=c.k_old_sf,e=A[c.st].y,f,g=c.k_y_clef;g&1&&(g+=7);for(g/=2;0>g;)g+=7;g%=7;if(!c.k_a_acc){if(c.fmt.cancelkey||0==c.k_sf)if(0==c.k_sf||0>d*c.k_sf){var h=De[g];var l=9<h?Fe:Ge;for(f=0;f<d;f++)ca(a,e+h,"acc3"),h+=l[f],a+=5.5;h=Ee[g];l=18>h?He:Ie;for(f=0;f>d;f--)ca(a,e+h,"acc3"),h+=l[-f],a+=
5.5;0!=c.k_sf&&(a+=3)}if(0<c.k_sf){h=De[g];l=9<h?Fe:Ge;for(f=0;f<c.k_sf;f++)ca(a,e+h,"acc1"),h+=l[f],a+=5.5;if(c.fmt.cancelkey&&f<d)for(a+=2;f<d;f++)ca(a,e+h,"acc3"),h+=l[f],a+=5.5}if(0>c.k_sf){h=Ee[g];l=18>h?He:Ie;for(f=0;f>c.k_sf;f--)ca(a,e+h,"acc-1"),h+=l[-f],a+=5.5;if(c.fmt.cancelkey&&f>d)for(a+=2;f>d;f--)ca(a,e+h,"acc3"),h+=l[-f],a+=5.5}}else if(c.k_a_acc.length){l=c.k_a_acc[0].acc;g=100;var k=[{}];for(f=0;f<c.k_a_acc.length;f++){d=c.k_a_acc[f];for(h=3*(c.k_y_clef+d.pit-18);-3>h;)h+=21;for(;27<
h;)h-=21;0!=f&&(h>g+18||h<g-18)?a-=5.5:d.acc!=l&&(a+=3);l=d.acc;k[0].pit=h/3+18;g=h;Hc(a,e+h,d.acc);a+=5.5}}};var Ff="r128 r64 r32 r16 r8 r4 r2 r1 r0 r00".split(" ");Abc.prototype.draw_symbols=function(a){var c={},d;for(d=a.sym;d;d=d.next){if(d.invis)switch(d.type){case m.KEY:a.ckey=d;default:continue;case m.NOTE:}var e=d.st;var f=d.x;Ha(d.color);switch(d.type){case m.NOTE:jb(d);d.beam_st&&!d.beam_end&&X.calculate_beam(c,d)&&pd(c);d.invis||(ta(d),ic(d,!c.s2),cb.push(d));d==c.s2&&(c.s2=null);break;
case m.REST:if(!A[e].topbar)break;var g,h;e=d;var l=A[e.st];if(e.dur_orig==e.p_v.meter.wmeasure||e.rep_nb&&0<=e.rep_nb){e.nflags=e.dur<2*m.BLEN?-2:e.dur<4*m.BLEN?-3:-4;e.dots=0;for(g=e.ts_next;g.time!=e.time+e.dur&&g.ts_next;)g=g.ts_next;f=g.x-g.wl;for(g=e;!g.seqst;)g=g.ts_prev;g=g.ts_prev;f=(f+g.x+g.wr)/2;if(e.a_dd){var k=e;var n=f-e.x;var r=ia.length;for(h=0;h<r;h++)g=ia[h],g.s==k&&(g.x+=n)}e.x=f}else f=e.x,e.notes[0].shhd&&(f+=e.notes[0].shhd*I.scale);if(!e.invis){g=l.y;if(e.rep_nb)Aa(e.st),ta(e),
g="|||||"==l.stafflines?g+12:g+(l.topbar+l.botbar)/2,0>e.rep_nb?ca(f,g,"srep"):(ca(f,g,"mrep"),2<e.rep_nb&&e.v==L.top_voice&&0<e.fmt.measrepnb&&!(e.rep_nb%e.fmt.measrepnb)&&td(f,g+l.topbar,e.rep_nb));else{jb(e);ta(e);e.notes[0].color&&Ha(e.notes[0].color);h=e.y;n=5-e.nflags;7==n&&12==h&&2>=l.stafflines.length&&(h-=6);e.notes[0].invis||ca(f,h+g,Ff[n]);if(6<=n){k=h/6;switch(n){default:switch(l.stafflines[k+1]){case "|":case "[":break;default:Nb(l,k+1,f,-7,7)}9==n&&(h-=6,k--);break;case 7:h+=6,k++;case 6:}switch(l.stafflines[k]){case "|":case "[":break;
default:Nb(l,k,f,-7,7)}}if(e.dots)for(f+=8,h+=g+3,k=e.dots,n=e.dur_orig/12>>5-e.nflags-k;0<k--;)ca(f,h,n&1<<k?"dot":"dot+"),f+=3.5;Ha()}cb.push(e)}break;case m.BAR:break;case m.CLEF:d.time>=A[e].clef.time&&(A[e].clef=d);if(d.second||!A[e].topbar)break;Ha();Aa(e);ta(d);e=A[e].y;d.clef_name?ca(f,e+d.y,d.clef_name):d.clef_small?ca(f,e+d.y,"s"+d.clef_type+"clef"):ca(f,e+d.y,d.clef_type+"clef");d.clef_octave&&(0<d.clef_octave?(e+=d.ymx-10,d.clef_small&&--e):(e+=d.ymn+6,d.clef_small&&(e+=1)),ca(f-2,e,"oct"));
cb.push(d);break;case m.METER:a.meter=d;if(d.second||!A[d.st].topbar)break;Ha();Aa(d.st);ta(d);rd(d);cb.push(d);break;case m.KEY:a.ckey=d;if(d.second||!A[d.st].topbar)break;Ha();Aa(d.st);ta(d);X.draw_keysig(f,d);cb.push(d);break;case m.MREST:jb(d);f+=32;ta(d);ca(f,A[d.st].y+12,"mrest");Y('<text style="font:bold 15px text,serif"\n\tx ="X" y="Y" text-anchor="middle">A</text>\n',f,A[d.st].y+28,d.nmes);cb.push(d);break;case m.GRACE:jb(d);f=d;l={};for(e=f.extra;;){e.beam_st&&!e.beam_end&&X.calculate_beam(l,
e)&&pd(l);ta(e);ic(e,!l.s2);e==l.s2&&(l.s2=null);cb.push(f);if(!e.next)break;e=e.next}f.sappo&&(e=f.extra,e.next?(g=.5*(e.next.x-e.x)+4,l=.5*(e.ys+e.next.ys)-e.y,l=0<e.stem?l-1:l+1):(g=9,l=0<e.stem?5:-5),k=e.notes[0>e.stem?0:e.nhd],h=e.x+k.shhd*I.scale,k=A[e.st].y+3*(k.pit-18),0<e.stem?(--h,k+=4):(h-=5,k-=4),Y('<path class="stroke" d="mX YlF G"/>\n',h,k,g,-l));if(e=f.slur)ta(f,"slur"),Ib(e.x0,e.y0+A[f.st].y),G+="c"+e.x1.toFixed(1)+" "+e.y1.toFixed(1)+" "+e.x2.toFixed(1)+" "+e.y2.toFixed(1)+" "+e.x3.toFixed(1)+
" "+e.y3.toFixed(1)+'"/>\n',Wa(f,"slur");break;case m.SPACE:case m.STBRK:break;case m.CUSTOS:jb(d);ic(d,0);break;case m.BLOCK:case m.PART:case m.REMARK:case m.STAVES:case m.TEMPO:break;default:u(2,d,"draw_symbols - Cannot draw symbol "+d.type)}}jb(a.sym)};var gb=[],Dd={},zd={serif:1,serifBold:1,"sans-serif":1,"sans-serifBold":1,Palatino:1.1,monospace:1.35},Je={},r={"abc-version":"1",annotationfont:{name:"text,sans-serif",size:12},aligncomposer:1,beamslope:.4,bardef:{"[":"","[]":"","|:":"[|:","|::":"[|::",
"|:::":"[|:::",":|":":|]","::|":"::|]",":::|":":::|]","::":":][:"},breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerfont:{name:"text,serif",style:"italic",size:14},composerspace:6,decoerr:!0,dynalign:!0,footerfont:{name:"text,serif",size:16},fullsvg:"",gchordfont:{name:"text,sans-serif",size:12},gracespace:new Float32Array([4,8,11]),graceslurs:!0,headerfont:{name:"text,serif",size:16},historyfont:{name:"text,serif",size:16},hyphencont:!0,indent:0,infofont:{name:"text,serif",style:"italic",size:14},
infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:1.4*37.8,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2E3,maxsysstaffsep:2E3,measrepnb:1,measurefont:{name:"text,serif",style:"italic",size:10},measurenb:-1,musicfont:{name:"music",src:'url("data:application/octet-stream;base64,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NQd1bmlFMDg2B3VuaUUwODcHdW5pRTA4OAd1bmlFMDg5B3VuaUUwOEEHdW5pRTA4Qgd1bmlFMDhDB3VuaUUwOTQHdW5pRTA5NQd1bmlFMEEwB3VuaUUwQTEHdW5pRTBBMgd1bmlFMEEzB3VuaUUwQTQHdW5pRTBBOQd1bmlFMEIzB3VuaUUxMDEHdW5pRTFCOQd1bmlFMUJCB3VuaUUxRTcHdW5pRTFGMgd1bmlFMUY0B3VuaUUxRjcHdW5pRTFGOQd1bmlFMUZDB3VuaUUxRkUHdW5pRTFGRgd1bmlFMjAwB3VuaUUyNDAHdW5pRTI0MQd1bmlFMjQyB3VuaUUyNDMHdW5pRTI0NAd1bmlFMjQ1B3VuaUUyNDYHdW5pRTI0Nwd1bmlFMjQ4B3VuaUUyNDkHdW5pRTI2MAd1bmlFMjYxB3VuaUUyNjIHdW5pRTI2Mwd1bmlFMjY0B3VuaUUyODAHdW5pRTI4MQd1bmlFMjgyB3VuaUUyODMHdW5pRTRBMAd1bmlFNEEyB3VuaUU0QTQHdW5pRTRBOAd1bmlFNEFDB3VuaUU0QzAHdW5pRTRDRQd1bmlFNEUxB3VuaUU0RTIHdW5pRTRFMwd1bmlFNEU0B3VuaUU0RTUHdW5pRTRFNgd1bmlFNEU3B3VuaUU0RTgHdW5pRTRFOQd1bmlFNEVBB3VuaUU0RUUHdW5pRTUwMAd1bmlFNTAxB3VuaUU1MjAHdW5pRTUyMQd1bmlFNTIyB3VuaUU1MjMHdW5pRTUyNAd1bmlFNTI1B3VuaUU1MjkHdW5pRTUyQQd1bmlFNTJCB3VuaUU1MkMHdW5pRTUyRAd1bmlFNTJGB3VuaUU1MzAHdW5pRTUzMQd1bmlFNTM5B3VuaUU1NjYHdW5pRTU2Nwd1bmlFNTY5B3VuaUU1NkMHdW5pRTU2RAd1bmlFNTgyB3VuaUU1RDAHdW5pRTVFMgd1bmlFNjEwB3VuaUU2MTIHdW5pRTYxNAd1bmlFNjE4B3VuaUU2MjQHdW5pRTYzMAd1bmlFNjUwB3VuaUU2NTUHdW5pRTkxMAd1bmlFOTExB3VuaUU5MTIHdW5pRTkxNAd1bmlFOTE1B3VuaUU5MTgHdW5pRTkyMAd1bmlFOTI1B3VuaUU5NUQHdW5pRUEwMgd1bmlFQUE0B3VuaUVDQTIHdW5pRUNBMwd1bmlFQ0E1B3VuaUVDQTcHdW5pRUNBOQd1bmlFQ0I3AAAAAAAAAf//AAIAAQAAAAAAAAAMABQABAAAAAIAAAABAAAAAQAAAAAAAQAAAADZahNDAAAAANGXIhcAAAAA2dy6gQ==") format("truetype")',
size:24},musicspace:6,partsfont:{name:"text,serif",size:15},parskipfac:.4,partsspace:8,pagewidth:793.8,printmargin:0,rightmargin:1.4*37.8,rbmax:4,rbmin:2,repeatfont:{name:"text,serif",size:13},scale:1,slurheight:1,staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlefont:{name:"text,serif",size:16},subtitlespace:3,sysstaffsep:34,tempofont:{name:"text,serif",weight:"bold",size:12},textfont:{name:"text,serif",size:16},textspace:14,tieheight:1,titlefont:{name:"text,serif",size:20},titlespace:6,
titletrim:!0,topspace:22,tuplets:[0,0,0,0],tupletfont:{name:"text,serif",style:"italic",size:12},vocalfont:{name:"text,serif",weight:"bold",size:13},vocalspace:10,voicefont:{name:"text,serif",weight:"bold",size:13},writefields:"CMOPQsTWw",wordsfont:{name:"text,serif",size:16},wordsspace:5},Ke={bardef:!0,barsperstaff:!0,beamslope:!0,breaklimit:!0,bstemdown:!0,cancelkey:!0,dynalign:!0,flatbeams:!0,gracespace:!0,hyphencont:!0,keywarn:!0,maxshrink:!0,maxstaffsep:!0,measrepnb:!0,rbmax:!0,rbmin:!0,shiftunison:!0,
slurheight:!0,squarebreve:!0,staffsep:!0,stemheight:!0,stretchlast:!0,stretchstaff:!0,tieheight:!0,timewarn:!0,vocalspace:!0},Le={align:"j",center:"c",fill:"f",justify:"j",ragged:"f",right:"r",skip:"s"},gd={above:m.SL_ABOVE,auto:0,below:m.SL_BELOW,down:m.SL_BELOW,hidden:m.SL_HIDDEN,opposite:m.SL_HIDDEN,under:m.SL_BELOW,up:m.SL_ABOVE};Abc.prototype.set_format=function(a,c){if(/.+font(-[\d])?$/.test(a))"soundfont"==a?r.soundfont=c:rb(a,c);else{Ke[a]&&t.ufmt&&(r=Object.create(r));switch(a){case "aligncomposer":case "barsperstaff":case "infoline":case "measurenb":case "rbmax":case "rbmin":case "measrepnb":case "shiftunison":var d=
parseInt(c);if(isNaN(d)){y(1,"Bad integer value");break}r[a]=d;break;case "abc-version":case "bgcolor":case "fgcolor":case "titleformat":r[a]=c;break;case "beamslope":case "breaklimit":case "lineskipfac":case "maxshrink":case "pagescale":case "parskipfac":case "scale":case "slurheight":case "stemheight":case "stretchlast":case "tieheight":d=parseFloat(c);if(isNaN(d)){y(1,J.bad_val,"%%"+a);break}switch(a){case "scale":d/=.75;case "pagescale":a="scale",da.chg=!0}r[a]=d;break;case "annotationbox":case "gchordbox":case "measurebox":case "partsbox":rb(a.replace("box",
"font"),"* * "+(Ta(c)?"box":"nobox"));break;case "bstemdown":case "breakoneoln":case "cancelkey":case "checkbars":case "contbarnb":case "custos":case "decoerr":case "flatbeams":case "graceslurs":case "graceword":case "hyphencont":case "keywarn":case "linewarn":case "quiet":case "singleline":case "squarebreve":case "splittune":case "straightflags":case "stretchstaff":case "timewarn":case "titlecaps":case "titleleft":r[a]=Ta(c);break;case "dblrepbar":c=":: "+c;case "bardef":d=c.split(/\s+/);2!=d.length?
y(1,J.bad_val,"%%bardef"):(t.ufmt&&(r.bardef=Object.create(r.bardef)),r.bardef[d[0]]=d[1]);break;case "chordalias":d=c.split(/\s+/);d.length?abc2svg.ch_alias[d[0]]=d[1]||"":y(1,J.bad_val,"%%chordalias");break;case "composerspace":case "indent":case "infospace":case "maxstaffsep":case "maxsysstaffsep":case "musicspace":case "partsspace":case "staffsep":case "subtitlespace":case "sysstaffsep":case "textspace":case "titlespace":case "topspace":case "vocalspace":case "wordsspace":d=Ea(c);isNaN(d)?y(1,
J.bad_val,"%%"+a):r[a]=d;break;case "page-format":q.page_format=Ta(c);break;case "print-leftmargin":y(0,"$1 is deprecated - use %%printmargin instead","%%"+a),a="printmargin";case "printmargin":case "leftmargin":case "pagewidth":case "rightmargin":d=Ea(c);if(isNaN(d)){y(1,J.bad_val,"%%"+a);break}r[a]=d;da.chg=!0;break;case "concert-score":"play"!=r.sound&&(r.sound="concert");break;case "writefields":var e=c.split(/\s+/);if(Ta(e[1]))for(d=0;d<e[0].length;d++)c=e[0][d],0>r.writefields.indexOf(c)&&(r.writefields+=
c);else for(d=0;d<e[0].length;d++)c=e[0][d],0<=r.writefields.indexOf(c)&&(r.writefields=r.writefields.replace(c,""));break;case "dynamic":case "gchord":case "gstemdir":case "ornament":case "stemdir":case "vocal":case "volume":Ad(a,c);break;case "font":c=dc(c);1>=c.length||(d=parseFloat(c[c.length-1]),isNaN(d)||.5>=d?y(1,"Bad scale value in %%font"):zd[c[0]]=d);break;case "fullsvg":if(0!=t.state){y(1,J.not_in_tune,"%%fullsvg");break}r[a]=c;break;case "gracespace":d=c.split(/\s+/);for(c=0;3>c;c++)if(isNaN(Number(d[c]))){y(1,
J.bad_val,"%%gracespace");break}t.ufmt&&(r[a]=new Float32Array(3));for(c=0;3>c;c++)r[a][c]=Number(d[c]);break;case "tuplets":r[a]=c.split(/\s+/);(d=r[a][3])&&gd[d]&&(r[a][3]=gd[d]);break;case "infoname":a:{d=r.infoname.split("\n");e=c[0];for(var f=0;f<d.length;f++)if(d[f][0]==e){1==c.length?d.splice(f,1):d[f]=c;r.infoname=d.join("\n");break a}r.infoname+="\n"+c}break;case "notespacingfactor":d=parseFloat(c);if(isNaN(d)||1>d||2<d){y(1,J.bad_val,"%%"+a);break}c=5;for(e=vb[c];0<=--c;)e/=d,vb[c]=e;c=
5;for(e=vb[c];++c<vb.length;)e*=d,vb[c]=e;break;case "play":r.sound="play";break;case "pos":a=c.match(/(\w*)\s+(.*)/);if(!a||!a[2]){y(1,"Error in %%pos");break}Ad(a[1],a[2]);break;case "sounding-score":"play"!=r.sound&&(r.sound="sounding");break;case "staffwidth":d=Ea(c);if(isNaN(d)){y(1,J.bad_val,"%%"+a);break}if(100>d){y(1,"%%staffwidth too small");break}d=r.pagewidth-d-r.leftmargin;if(2>d){y(1,"%%staffwidth too big");break}r.rightmargin=d;da.chg=!0;break;case "textoption":r[a]=Le[c];break;case "dynalign":case "titletrim":d=
Number(c);isNaN(d)?r[a]=Ta(c):r[a]=d;break;case "combinevoices":y(1,"%%combinevoices is deprecated - use %%voicecombine instead");break;case "voicemap":ac("map",c);break;case "voicescale":ac("scale",c);break;case "rbdbstop":(d=Ta(c))&&"2.2"<=r["abc-version"]?r["abc-version"]="1":!d&&"2.2">r["abc-version"]&&(r["abc-version"]="2.2");break;default:0==t.state&&(r[a]=c)}Ke[a]&&t.ufmt&&(t.ufmt=!1)}};Abc.prototype.style_font=Lc;var Ka={},ub={},nc={},ef={"=D":"\u0110","=H":"\u0126","=T":"\u0166","=d":"\u0111",
"=h":"\u0127","=t":"\u0167","/O":"\u00d8","/o":"\u00f8","/L":"\u0141","/l":"\u0142",vL:"\u013d",vl:"\u013e",vd:"\u010f",".i":"\u0131",AA:"\u00c5",aa:"\u00e5",AE:"\u00c6",ae:"\u00e6",DH:"\u00d0",dh:"\u00f0",OE:"\u0152",oe:"\u0153",ss:"\u00df",TH:"\u00de",th:"\u00fe"},df={1:"\u266f",2:"\u266d",3:"\u266e",4:"&#x1d12a;",5:"&#x1d12b;"},Lb=0;Abc.prototype.tosvg=Mc;var H,A,U,Sa,ua,Zb,ec,vb=new Float32Array([8.4,11.2,14.9,19.8,26.3,35,46.6,61.9,82.3,109.5]),Pc,Ld=new Float32Array([10,10,11,13,15]),Ce=new Float32Array([4.7,
5,6,7.2,7.5]),tc=new Float32Array([3.5,3.7,5,6,7]);Abc.prototype.set_width=function(a){var c,d,e;if(!a.play)switch(a.type){case m.NOTE:case m.REST:a.wr=e=Ce[a.head];0<a.xmx&&(a.wr+=a.xmx+4);for(c=a.prev;c&&0==Pa[c.type];c=c.prev);if(c)switch(c.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:e+=3}for(d=0;d<=a.nhd;d++){var f=a.notes[d];var g=f.shhd;0>g&&e<-g+5&&(e=-g+5);if(g=f.acc)g=f.shac+("object"==typeof g?5.5:3.5),e<g&&(e=g);if(f.a_dd){g=e;var h=0;var l=f.a_dd.length;for(e=0;e<l;e++){var k=
f.a_dd[e];"<"==k.ty&&(k=k.wl+k.wr+8,k>h&&(h=k))}e=g+h}}if(c)switch(c.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:e-=3}a.a_dd&&(e+=Fc(a));a.beam_st&&a.beam_end&&0<a.stem&&0<a.nflags&&a.wr<a.xmx+9&&(a.wr=a.xmx+9);if(a.dots){if(void 0==a.wl)switch(a.head){case m.SQUARE:case m.OVALBARS:a.xmx+=3;break;case m.OVAL:a.xmx+=1}a.wr<a.xmx+8&&(a.wr=a.xmx+8);2<=a.dots&&(a.wr+=3.5*(a.dots-1))}a.trem2&&a.beam_end&&20>e&&(e=20);f=e;if(c)switch(c.type){case m.NOTE:0<c.stem&&0>a.stem&&7>f&&(f=7);(27<a.y&&
27<c.y||-3>a.y&&-3>c.y)&&6>f&&(f=6);c.tie&&14>f&&(f=14);break;case m.CLEF:if(c.second||c.clef_small)break;f+=8;break;case m.KEY:f+=4}a.a_gch&&(f=Pd(a,e,f));a.wl=c&&c.type==m.GRACE?e-4.5:f;return;case m.SPACE:g=a.width/2;a.wr=g;a.a_gch&&(g=Pd(a,g,g));a.a_dd&&(g+=Fc(a));a.wl=g;return;case m.BAR:d=a.bar_type;switch(d){case "|":g=5;break;case "[":g=0;break;default:for(g=2+2.8*d.length,c=0;c<d.length;c++)switch(d[c]){case "[":case "]":g+=1;case ":":g+=2}}a.wl=g;a.wr=a.next&&a.next.type!=m.METER?7:5;for(c=
a.prev;c;c=c.prev)if(0!=Pa[c.type]){c.type==m.GRACE&&(a.wl-=8);break}a.a_dd&&(a.wl+=Fc(a));a.text&&4>a.text.length&&a.next&&a.next.a_gch&&(V("repeat"),a.wr+=sa(a.text)[0]+2,0<r.measurenb&a.bar_num&&a.bar_num%r.measurenb&&(a.wr+=4));return;case m.CLEF:if(a.invis){a.wl=a.wr=1;return}a.wl=a.clef_small?11:12;a.wr=a.clef_small?10:12;a.next&&a.next.type==m.BAR&&(a.wr-=4);return;case m.KEY:if(a.invis){a.wl=a.wr=0;return}a.wl=3;h=4;if(a.k_a_acc){if(f=e=a.k_a_acc.length)d=a.k_a_acc[0].acc;for(c=1;c<e;c++)g=
a.k_a_acc[c],g.pit>a.k_a_acc[c-1].pit+6||g.pit<a.k_a_acc[c-1].pit-6?f--:g.acc!=d&&(h+=3),d=g.acc}else f=a.k_sf,e=a.k_old_sf&&(a.fmt.cancelkey||0==f)?a.k_old_sf:0,0<=f*e?(0>f&&(f=-f),0>e&&(e=-e),e>f&&(f=e)):(f-=e,0>f&&(f=-f),h+=3);a.wr=5.5*f+h;return;case m.METER:f=0;a.x_meter=[];for(c=0;c<a.a_meter.length;c++)switch(e=a.a_meter[c],e.top[0]){case "C":case "c":case "o":a.x_meter[c]=f+6;f+=12;break;case ".":case "|":a.x_meter[c]=a.x_meter[c-1];break;default:g=0;e=!e.bot||e.top.length>e.bot.length?e.top:
e.bot;for(d=0;d<e.length;d++)switch(e[d]){case "(":f+=4;case ")":case "1":g+=4;break;default:g+=12}a.x_meter[c]=f+g/2;f+=g}a.wl=0;a.wr=f+6;return;case m.MREST:a.wl=6;a.wr=66;return;case m.GRACE:if(a.invis)break;g=a.fmt.gracespace[0];d=a.fmt.gracespace[1];c=a.fmt.gracespace[2];f=a.extra;a.prev&&a.prev.type==m.BAR&&(g-=3);for(f.beam_st=!0;;f=f.next){Kd(f);Md(f.notes,7);h=0;for(e=f.nhd;0<=e;e--)f.notes[e].shac>h&&(h=f.notes[e].shac);g+=h;f.x=g;0>=f.nflags&&(f.beam_st=!0,f.beam_end=!0);e=f.next;if(!e){f.beam_end=
!0;break}0>=e.nflags&&(f.beam_end=!0);f.beam_end&&(e.beam_st=!0,g+=d/4);0>=f.nflags&&(g+=d/4);f.y>e.y+8&&(g-=1.5);g+=d}(e=a.next)&&e.type==m.NOTE&&(f.y>=3*(e.notes[e.nhd].pit-18)?--c:f.beam_st&&f.y<3*(e.notes[e.nhd].pit-18)-4&&(c+=2));a.wl=g+c;a.wr=0;a.a_ly&&pc(a);return;case m.STBRK:a.wl=a.xmx;a.next&&a.next.type==m.CLEF?(a.wr=2,delete a.next.clef_small):a.wr=8;return;case m.CUSTOS:a.wl=a.wr=4;return;case m.TEMPO:oe(a);break;case m.BLOCK:case m.PART:case m.REMARK:case m.STAVES:break;default:u(2,
a,"set_width - Cannot set width for symbol $1",a.type)}a.wl=a.wr=0};var hd={t:-4,c:0,b:4,p:-6},Me=[[18,18],[12,18],[12,12],[0,12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,10]];Abc.prototype.set_pitch=function(a){var c,d,e=m.BLEN,f=U+1,g=new Int16Array(Array(2*f));for(c=0;c<=U;c++){var h=A[c].clef;g[c]=hd[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);r.sound?h.clef_octave&&!h.clef_oct_transp&&(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave)}for(h=N;h!=a;h=h.ts_next)switch(c=h.st,
h.type){case m.CLEF:g[c]=hd[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);r.sound?h.clef_octave&&!h.clef_oct_transp&&(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave);Rc(h);break;case m.GRACE:for(c=h.extra;c;c=c.next){if((d=g[c.st])&&!h.p_v.ckey.k_drum)for(f=0;f<=c.nhd;f++){var l=c.notes[f];l.opit=l.pit;l.pit+=d}c.ymn=3*(c.notes[0].pit-18)-2;c.ymx=3*(c.notes[c.nhd].pit-18)+2}Rc(h);break;case m.KEY:h.k_y_clef=g[c];default:Rc(h);break;case m.MREST:if(h.invis)break;h.y=12;h.ymx=
39;h.ymn=-2;break;case m.REST:if(1==D.length){h.y=12;h.ymx=24;h.ymn=0;break}case m.NOTE:if((d=g[c])&&!h.p_v.ckey.k_drum)for(f=h.nhd;0<=f;f--)l=h.notes[f],l.opit=l.pit,l.pit+=d;h.type==m.REST&&(h.y=6*((h.notes[0].pit-18)/2|0),h.ymx=h.y+Me[5-h.nflags][0],h.ymn=h.y-Me[5-h.nflags][1]);h.dur<e&&(e=h.dur)}a||(Pc=e)};Abc.prototype.set_stem_dir=function(){for(var a,c,d,e,f,g,h,l=[],k=N,n=L,r=n.nstaff;k;){for(a=0;a<=r;a++)l[a]=[];h=[];for(c=k;c&&c.type!=m.BAR;c=c.ts_next)if(c.type==m.STAVES){if(c!=k)break;
n=k.sy;for(a=r;a<=n.nstaff;a++)l[a]=[];r=n.nstaff}else if(!(c.type!=m.NOTE&&c.type!=m.REST||c.invis)){a=c.st;if(a>r)throw c="*** fatal set_stem_dir(): bad staff number "+a+" max "+r,u(2,null,c),Error(c);d=c.v;e=h[d];e||(e={st1:-1,st2:-1},h[d]=e);0>e.st1?e.st1=a:e.st1!=a&&(a>e.st1?a>e.st2&&(e.st2=a):(e.st1>e.st2&&(e.st2=e.st1),e.st1=a));f=l[a];e=n.voices[d].range;for(d=f.length;0<=--d&&(g=f[d],g.v!=e););if(0>d){g={v:e,ymx:0,ymn:24};for(d=0;d<f.length;d++)if(e<f[d].v){f.splice(d,0,g);break}d==f.length&&
f.push(g)}c.type==m.NOTE&&(c.ymx>g.ymx&&(g.ymx=c.ymx),c.ymn<g.ymn&&(g.ymn=c.ymn),c.xstem&&(c.ts_prev.st!=a-1||c.ts_prev.type!=m.NOTE?(u(1,k,"Bad !xstem!"),c.xstem=!1):(c.ts_prev.multi=1,c.multi=1,c.stemless=!0)))}for(;k!=c;k=k.ts_next)if(!k.multi){switch(k.type){default:continue;case m.REST:if(void 0!=k.combine&&0>k.combine||!k.ts_next||k.ts_next.type!=m.REST||k.ts_next.st!=k.st||k.time!=k.ts_next.time||k.dur!=k.ts_next.dur||k.a_dd&&k.ts_next.a_dd||k.a_gch&&k.ts_next.a_gch||k.invis)break;k.ts_next.a_dd&&
(k.a_dd=k.ts_next.a_dd);k.ts_next.a_gch&&(k.a_gch=k.ts_next.a_gch);sb(k.ts_next);case m.NOTE:case m.GRACE:}a=k.st;d=k.v;e=h[d];f=l[a];if(e&&0<=e.st2)a==e.st1?k.multi=-1:a==e.st2&&(k.multi=1);else if(1>=f.length)k.floating&&(k.multi=a==D[d].st?-1:1);else{e=n.voices[d].range;for(d=f.length;0<=--d&&f[d].v!=e;);0>d||(d==f.length-1?k.multi=-1:(k.multi=1,0!=d&&d+2==f.length&&(f[d].ymn-k.fmt.stemheight>=f[d+1].ymx&&(k.multi=-1),a=k.ts_next,k.ts_prev&&k.ts_prev.time==k.time&&k.ts_prev.st==k.st&&k.notes[k.nhd].pit==
k.ts_prev.notes[0].pit&&k.beam_st&&k.beam_end&&(!a||a.st!=k.st||a.time!=k.time)&&(k.multi=-1))))}}for(;k&&k.type==m.BAR;)k=k.ts_next}};Abc.prototype.set_stems=function(){var a,c,d,e;for(a=N;a;a=a.ts_next)if(a.type!=m.NOTE){if(a.type==m.GRACE){var f=e=a.mid;for(c=a.extra;c;c=c.next){var g=jc(a,c.dur);c.head=g[0];c.dots=g[1];c.nflags=g[2];g=15;1<c.nflags&&(g+=1.2*(c.nflags-1));var h=3*(c.notes[0].pit-18);var l=3*(c.notes[c.nhd].pit-18);0<=a.stem?(c.y=h,c.ys=l+g,l=Math.round(c.ys)):(c.y=l,c.ys=h-g,h=
Math.round(c.ys));l+=2;h-=2;h<f?f=h:l>e&&(e=l);c.ymx=l;c.ymn=h}a.ymx=e;a.ymn=f}}else{Kd(a);c=a.nflags;if(a.beam_st&&!a.beam_end){a.feathered_beam&&(c=++a.nflags);for(g=a.next;g.type!=m.NOTE||(a.feathered_beam&&g.nflags++,!g.beam_end);g=g.next);g.nflags>c&&(c=g.nflags)}else if(!a.beam_st&&a.beam_end){for(g=a.prev;!g.beam_st;g=g.prev);g.nflags>c&&(c=g.nflags)}g=a.fmt.stemheight;switch(c){case 2:g+=0;break;case 3:g+=4;break;case 4:g+=8;break;case 5:g+=12}1!=(d=a.p_v.scale)&&(g*=.5*(d+1));h=3*(a.notes[0].pit-
18);0<a.nhd?(g-=2,l=3*(a.notes[a.nhd].pit-18)):l=h;a.ntrem&&(g+=2*a.ntrem);a.stemless?(0<=a.stem?(a.y=h,a.ys=l):(a.ys=h,a.y=l),a.ymx=l+4,a.ymn=h-4):0<=a.stem?(26<a.notes[a.nhd].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(g-=2,28<a.notes[a.nhd].pit&&(g-=2)),a.y=h,a.notes[0].tie&&(h-=3),a.ymn=h-4,a.ys=l+g,a.ys<a.mid&&(a.ys=a.mid),a.ymx=a.ys+2.5|0):(18>a.notes[0].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(g-=2,16>a.notes[0].pit&&(g-=2)),a.ys=h-g,a.ys>a.mid&&(a.ys=a.mid),a.ymn=a.ys-2.5|0,a.y=l,a.notes[a.nhd].tie&&
(l+=3),a.ymx=l+4)}};var uc=[];Abc.prototype.block_gen=function(a){switch(a.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":hb();X.set_format(a.subtype,a.param);break;case "mc_start":ja={posy:aa,maxy:aa,lmarg:r.leftmargin,rmarg:r.rightmargin};break;case "mc_new":if(!ja){u(1,a,"%%multicol new without start");break}aa>ja.maxy&&(ja.maxy=aa);r.leftmargin=ja.lmarg;r.rightmargin=ja.rmarg;da.chg=!0;wa();aa=ja.posy;break;case "mc_end":if(!ja){u(1,
a,"%%multicol new without start");break}aa<ja.maxy&&(aa=ja.maxy);r.leftmargin=ja.lmarg;r.rightmargin=ja.rmarg;ja=void 0;hb();da.chg=!0;wa();break;case "ml":hb();q.img_out(a.text);break;case "newpage":Pb();if(!q.page_format)break;0>Ua&&q.img_out("</div>");Ua=2;break;case "sep":wa();ma(a.sk1);G+='<path class="stroke"\n\td="M';Oa((da.width-a.l)/2-da.lm," ",0);G+="h"+a.l.toFixed(1)+'"/>\n';ma(a.sk2);break;case "text":V(a.font);zc(a.text,a.opt);break;case "title":$c(a.text,!0);break;case "vskip":ma(a.sk)}};
Abc.prototype.set_sym_glue=function(a){var c,d,e=0,f=0,g=0,h=0,l=0;for(c=N;c;c=c.ts_next)c.type!=m.GRACE||d||(d=c),c.seqst&&(e+=c.shrink,c.space?c.space<c.shrink?(l+=c.shrink,f+=c.shrink):f+=c.space:h+=c.shrink);if(f){var k=!Sa||Sa.type==m.BLOCK&&!Sa.play||uc.length;c=N;if(e>=a){e>a&&u(1,c,"Line too much shrunk $1 $2 $3",e.toFixed(1),f.toFixed(1),a.toFixed(1));for(g=0;c;c=c.ts_next)c.seqst&&(g+=c.shrink),c.x=g;ec=0}else if(k&&f+h>a*(1-c.fmt.stretchlast)||!k&&(f+h>a||c.fmt.stretchstaff)){f==l&&(f+=
5);for(k=4;0<=--k;){var n=(a-h-l)/(f-l);g=l=f=0;for(c=N;c;c=c.ts_next)c.seqst&&(c.space?c.space*n<=c.shrink?(l+=c.shrink,f+=c.shrink,g+=c.shrink):(f+=c.space,g+=c.space*n):g+=c.shrink),c.x=g;if(.1>Math.abs(g-a))break}ec=n}else for(n=(a-h-l)/f,ec<n&&(n=ec);c;c=c.ts_next)c.seqst&&(g+=c.space*n<=c.shrink?c.shrink:c.space*n),c.x=g;ua=g;for(c=d;c;c=c.ts_next)if(c.type==m.GRACE)for(g=c.gr_shift?c.prev.x+c.prev.wr:c.x-c.wl,a=c.extra;a;a=a.next)a.x+=g}else ua=0};Abc.prototype.output_music=function(){for(var a,
c,d,e,f,g,h,l=D.length,k,n,t=D.length,u=L,q=u.nstaff;;){u=u.next;if(!u)break;u.nstaff>q&&(q=u.nstaff)}U=q;for(var v,y=N;y.ts_next;)y=y.ts_next;y.type!=m.BAR&&(v=Rd(y),v.seqst=!0,v.invis=!0,v.time=y.time+(y.dur||0),v.ts_prev=y,y.next=y.ts_next=v);for(n=0;n<t;n++){k=D[n];var F=void 0,H=void 0,I=void 0,J=void 0,K=void 0,O=!0,P=127;for(K=k.sym;K;K=K.next)if(K.type==m.NOTE){P=K.notes[0].pit;break}for(K=k.sym;K;K=K.next){K.a_gch&&X.gch_build(K);switch(K.type){case m.MREST:O=!0;break;case m.BAR:if(F=K.fmt.bardef[K.bar_type])K.bar_type=
F;K.beam_on||(O=!0);K.next||!K.prev||K.invis||K.prev.head!=m.OVALBARS||(K.prev.head=m.SQUARE);break;case m.GRACE:for(J=K.extra;J;J=J.next)J.notes.sort(abc2svg.pitcmp);break;case m.NOTE:case m.REST:if(F=jc(K,K.dur_orig),K.head=F[0],K.dots=F[1],K.nflags=F[2],-2>=K.nflags&&(K.stemless=!0),K.xstem&&(K.nflags=0),K.trem1&&(K.nflags=0<K.nflags?K.nflags+K.ntrem:K.ntrem),!K.next||!K.next.trem2)if(K.trem2)K.prev.trem2=!0,K.prev.nflags=--K.nflags,K.prev.head=++K.head,0<K.nflags?K.nflags+=K.ntrem:(-2>=K.nflags&&
(K.stemless=!0,K.prev.stemless=!0),K.nflags=K.ntrem),K.prev.nflags=K.nflags;else{I=K.nflags;K.ntrem&&(I+=K.ntrem);K.type==m.REST&&K.beam_end&&!K.beam_on&&(K.beam_end=!1,O=!0);if(O||0>=I)if(H&&(H.beam_end=!0,H=null),0>=I)K.beam_st=!0,K.beam_end=!0;else if(K.type==m.NOTE||K.beam_on)K.beam_st=!0,O=!1;K.beam_end&&(O=!0);if(K.type==m.NOTE||K.beam_on)H=K}}if(K.type==m.NOTE)for(K.nhd&&K.notes.sort(abc2svg.pitcmp),P=K.notes[0].pit,J=K.prev;J&&J.type==m.REST;J=J.prev)J.notes[0].pit=P;else K.notes||(K.notes=
[],K.notes[0]={},K.nhd=0),K.notes[0].pit=P}H&&(H.beam_end=!0);k.ckey=k.key;for(var S=void 0,Y=void 0,R=k.sym;R;)if(R.type!=m.BAR||!R.rbstart||R.norepbra)R=R.next;else for(S=0,Y=null,R=R.next;R;R=R.next)if(R.type==m.BAR){if(R.rbstop)break;if(!R.next){R.rbstop=2;break}S++;S==R.fmt.rbmin&&(Y=R);if(S==R.fmt.rbmax){Y&&(R=Y);R.rbstop=1;break}}}if(1<t){var ca,Q,V;for(ca=0;ca<D.length;ca++){var ia=D[ca];var aa=!1;var na=ia.st;for(Q=ia.sym;Q;Q=Q.next){if(!Q.floating){for(;Q&&!Q.floating;)Q=Q.next;if(!Q)break;
aa=!1}if(Q.dur)if(19<=Q.notes[0].pit)aa=!1;else if(12>=Q.notes[Q.nhd].pit)aa=!0,Q.st++;else{var la=127;for(V=Q.ts_prev;V&&V.st==na&&V.v!=Q.v;V=V.ts_prev)V.type==m.NOTE&&V.notes[0].pit<la&&(la=V.notes[0].pit);if(127==la)aa&&Q.st++;else if(Q.notes[Q.nhd].pit>la-3)aa=!1;else{var ja=-127;for(V=Q.ts_next;V&&V.st==na+1&&V.v!=Q.v;V=V.ts_next)V.type==m.NOTE&&V.notes[V.nhd].pit>ja&&(ja=V.notes[V.nhd].pit);if(-127==ja)aa&&Q.st++;else{if(Q.notes[0].pit<ja+3)aa=!0;else if(la-=Q.notes[Q.nhd].pit,ja=Q.notes[0].pit-
ja,!aa){if(la<ja+3)continue;aa=!0}else if(la<ja-3){aa=!1;continue}Q.st++}}}else aa&&Q.st++}}if(oa.mrest_p){var ea;for(ea=N;ea;ea=ea.ts_next)if(ea.type==m.MREST){if(!ea.seqst&&Pa[ea.ts_prev.type])var sa=ea;else for(sa=ea.ts_next;!sa.seqst&&sa.type==m.MREST&&sa.nmes==ea.nmes;)sa=sa.ts_next;if(sa.seqst)ea=sa.ts_prev;else for(;ea.type==m.MREST;){for(var Aa,va,Ba,fa,Fa,Qa=ea,Ja=Qa.nmes,Va=Qa.dur/Ja,qa=Qa.next;!qa.bar_type;)qa=qa.next;for(Fa=qa;!qa.bar_num;)qa=qa.ts_prev;Aa=qa.bar_num-Qa.nmes;Qa.type=m.REST;
Qa.dur=Qa.dur_orig=Va;Qa.nflags=-2;Qa.head=m.FULL;va=Qa.time+Va;for(fa=Qa;0<--Ja;){qa=x(Fa);delete qa.soln;delete qa.a_gch;delete qa.a_dd;delete qa.text;delete qa.rbstart;delete qa.rbstop;oc(qa,Fa);for(qa.time=va;fa.time<va;)fa=fa.ts_next;for(;fa&&fa.v<Qa.v&&fa.type==m.BAR;)fa=fa.ts_next;if(fa)Sb(qa,fa),fa.type==m.BAR&&delete fa.bar_num;else{for(fa=Qa;fa.ts_next;)fa=fa.ts_next;fa.ts_next=qa;qa.ts_prev=fa;qa.ts_next=null}Aa++;qa.seqst?(qa.bar_num=Aa,Ba=qa.ts_next):(delete qa.bar_num,Ba=qa.ts_prev);
qa.bar_type=Ba.bar_type||"|";Ba.bar_num&&!Ba.seqst&&delete Ba.bar_num;Ba=x(Qa);delete Ba.a_dd;delete Ba.soln;delete Ba.a_gch;qa.next?(Ba.next=qa.next,Ba.next.prev=Ba):Ba.next=null;qa.next=Ba;Ba.prev=qa;for(Ba.time=va;fa&&!fa.dur&&fa.time==va;)fa=fa.ts_next;for(;fa&&fa.v<Qa.v&&(!(fa=fa.ts_next)||!fa.seqst););if(fa)Sb(Ba,fa);else{for(fa=Qa;fa.ts_next;)fa=fa.ts_next;fa.ts_next=Ba;Ba.ts_prev=fa;Ba.ts_next=null}va+=Va;Qa=fa=Ba}ea=ea.ts_next}}}}oa.ottava&&"play"!=r.sound&&nf();var T,Z,xa,Ma=Array(U+1),
ka=L,Ga=[];A=Array(U+1);for(T=0;T<=U;T++)Ma[T]={autoclef:!0},A[T]={output:"",sc_out:""};for(Z=0;Z<D.length;Z++){var Ca=D[Z];ka.voices[Z]&&(T=ka.voices[Z].st,ka.voices[Z].second||(ka.staves[T].staffnonote=Ca.staffnonote,Ca.staffscale&&(ka.staves[T].staffscale=Ca.staffscale),ka.voices[Z].sep&&(ka.staves[T].sep=ka.voices[Z].sep),ka.voices[Z].maxsep&&(ka.staves[T].maxsep=ka.voices[Z].maxsep),Ca.clef.clef_auto||delete Ma[T].autoclef))}for(Z=0;Z<D.length;Z++)if(Ca=D[Z],ka.voices[Z]&&!ka.voices[Z].second){T=
ka.voices[Z].st;var ba=Ca.clef;Ma[T].autoclef&&(ba.clef_type=Sc(T,N,ba.clef_type),ba.clef_line="t"==ba.clef_type?2:4);Ma[T].clef=A[T].clef=ba}for(T=0;T<=ka.nstaff;T++)Ga[T]=3*(ka.staves[T].stafflines.length-1);for(ba=N;ba;ba=ba.ts_next){ba.repeat_n&&lf(ba);switch(ba.type){case m.STAVES:ka=ba.sy;for(T=0;T<=U;T++)Ma[T].autoclef=!0;for(Z=0;Z<D.length;Z++)if(ka.voices[Z]){Ca=D[Z];T=ka.voices[Z].st;ka.voices[Z].second||(ka.staves[T].staffnonote=Ca.staffnonote,Ca.staffscale&&(ka.staves[T].staffscale=Ca.staffscale),
ka.voices[Z].sep&&(ka.staves[T].sep=ka.voices[Z].sep),ka.voices[Z].maxsep&&(ka.staves[T].maxsep=ka.voices[Z].maxsep));var ta=Ca.clef;ta.clef_auto||(Ma[T].autoclef=!1)}for(T=0;T<=ka.nstaff;T++)Ga[T]=3*(ka.staves[T].stafflines.length-1);for(Z=0;Z<D.length;Z++)if(ka.voices[Z]&&!ka.voices[Z].second){Ca=D[Z];T=ka.voices[Z].st;ta=Ca.clef;if(ta.clef_auto){var Da=Sc(T,ba,Ma[T].clef?Ma[T].clef.clef_type:"a");var Ha="t"==Da?2:4}else Da=ta.clef_type,Ha=ta.clef_line;if(!Ma[T].clef)ta.clef_auto&&("a"!=ta.type&&
(Ca.clef=x(Ca.clef)),Ca.clef.clef_type=Da,Ca.clef.clef_line=Ha),A[T].clef=Ma[T].clef=Ca.clef;else if(Da!=Ma[T].clef.clef_type||Ha!=Ma[T].clef.clef_line){for(xa=ba.ts_prev;xa&&xa.time==ba.time&&(xa.v!=Z||xa.st!=T);)xa=xa.ts_prev;if(!xa||xa.time!=ba.time){for(xa=ba.ts_next;xa&&(xa.v!=Z||xa.st!=T);)xa=xa.ts_next;xa&&xa.time==ba.time||(xa=ba)}xa.type!=m.CLEF&&(xa=Nd(xa,Da,Ha),ta.clef_auto&&(xa.clef_auto=!0));Ma[T].clef=Ca.clef=xa}}continue;default:ba.mid=Ga[ba.st];continue;case m.CLEF:}"a"==ba.clef_type&&
(ba.clef_type=Sc(ba.st,ba.ts_next,Ma[ba.st].clef.clef_type),ba.clef_line="t"==ba.clef_type?2:4);Ca=ba.p_v;Ca.clef=ba;if(ba.second)sb(ba);else{T=ba.st;if(Ma[T].clef){if(ba.clef_type==Ma[T].clef.clef_type&&ba.clef_line==Ma[T].clef.clef_line)continue}else A[T].clef=ba;Ma[T].clef=ba}}ka=L;for(Z=0;Z<D.length;Z++)if(ka.voices[Z]&&(ta=D[Z].sym)&&127==ta.notes[0].pit){T=ka.voices[Z].st;switch(A[T].clef.clef_type){default:var Ka=22;break;case "c":Ka=16;break;case "b":Ka=10}for(ba=ta;ba;ba=ba.next)ba.notes[0].pit=
Ka}X.set_pitch(null);1<l&&X.set_stem_dir();for(a=0;a<l;a++){var wa,za,La=void 0,Ua=void 0,W,Oa=-1;for(W=D[a].sym;W;W=W.next)if(W.type!=m.NOTE){if(W.type==m.GRACE){var ha=W.extra;if(2==ha.stem)La=W;else for(W.stem||0!=(W.stem=W.multi)||(W.stem=1);ha;ha=ha.next)ha.stem=W.stem,ha.multi=W.multi}}else{if(W.stem||0!=(W.stem=W.multi))W.beam_st&&!W.beam_end&&(Ua=!0);else{var Ea=W.mid/3+18;if(Ua)W.stem=Oa;else if(W.beam_st&&!W.beam_end){Ua=!0;var Ia=wa=0;for(ha=W;ha;ha=ha.next)if(ha.type==m.NOTE){if(ha.stem||
ha.multi){W.stem=ha.stem||ha.multi;break}Ia+=ha.nhd+1;for(za=0;za<=ha.nhd;za++)ha.notes[za].pit>=Ea&&wa++;if(ha.beam_end)break}if(!W.stem)if(wa*=2,wa>Ia)W.stem=-1;else if(wa<Ia)W.stem=1;else{wa=W.notes[W.nhd].pit;var Xa=W.notes[0].pit;for(ha=W.next;ha&&(ha.type!=m.NOTE||(ha.notes[ha.nhd].pit>wa&&(wa=ha.notes[ha.nhd].pit),ha.notes[0].pit<Xa&&(Xa=ha.notes[0].pit),!ha.beam_end));ha=ha.next);ha.beam_end&&(wa+Xa<2*Ea?W.stem=1:wa+Xa>2*Ea?W.stem=-1:W.fmt.bstemdown&&(W.stem=-1))}W.stem||(W.stem=Oa)}else{Ia=
(W.notes[W.nhd].pit+W.notes[0].pit)/2;if(Ia==Ea){for(za=0;za<=W.nhd&&!(W.notes[za].pit>=Ea);za++);Ia=2*za<W.nhd?Ea-1:Ea+1}W.stem=Ia<Ea?1:Ia>Ea||W.fmt.bstemdown?-1:Oa}}W.beam_end&&(Ua=!1);Oa=W.stem;if(La){for(ha=La.extra;ha;ha=ha.next)ha.stem=-Oa;La.stem=-Oa;La=null}}}X.set_stems();Ud();if(N){var Ya,Ab,ab,bb;for(Ya=N;Ya;)if(Ya.type!=m.NOTE||Ya.invis)Ya=Ya.ts_next;else{var vb=Ya.st;var xb=Ya.time;var jb=!1;for(Ab=Ya;Ab&&Ab.time==xb&&Ab.type==m.NOTE&&Ab.st==vb;Ab=Ab.ts_next)if(!jb)for(ab=0;ab<=Ab.nhd;ab++)if(Ab.notes[ab].acc){jb=
!0;break}if(jb){var Fb=Ld[Ya.head];for(bb=[];Ya!=Ab;Ya=Ya.ts_next)Array.prototype.push.apply(bb,Ya.notes);bb.sort(abc2svg.pitcmp);Md(bb,Fb)}else Ya=Ab}if(1<l){var M,Wa,Ta,gb=[],cb=L;for(M=N;M;M=M.ts_next)if(!M.invis&&(M.type==m.STAVES&&(cb=M.sy),M.dur)){var Bb=gb[M.v];Bb||(Bb={},gb[M.v]=Bb);Bb.s=M;Bb.st=M.st;Bb.end_time=M.time+M.dur;if(M.type==m.REST){var Cb=-127;var Db=127;var ob=Ta=!1;for(Wa=0;Wa<=gb.length;Wa++)if((Bb=gb[Wa])&&Bb.s&&Bb.st==M.st&&Wa!=M.v&&!(Bb.end_time<=M.time)){ob=!0;var pa=Bb.s;
cb.voices[Wa].range<cb.voices[M.v].range?pa.time==M.time?pa.ymn<Db&&(Db=pa.ymn,pa.dots&&(Ta=!0)):pa.y<Db&&(Db=pa.y):pa.time==M.time?pa.ymx>Cb&&(Cb=pa.ymx,pa.dots&&(Ta=!0)):pa.y>Cb&&(Cb=pa.y)}var Nb=M.time+M.dur;for(pa=M.ts_next;pa&&!(pa.time>=Nb);pa=pa.ts_next)pa.st==M.st&&pa.dur&&!pa.invis&&(ob=!0,cb.voices[pa.v].range<cb.voices[M.v].range?pa.time==M.time?pa.ymn<Db&&(Db=pa.ymn,pa.dots&&(Ta=!0)):pa.y<Db&&(Db=pa.y):pa.time==M.time?pa.ymx>Cb&&(Cb=pa.ymx,pa.dots&&(Ta=!0)):pa.y>Cb&&(Cb=pa.y));if(ob){if(127==
Db&&12>M.y){var ya=12-M.y;M.y+=ya;M.ymx+=ya;M.ymn+=ya}-127==Cb&&12<M.y&&(ya=M.y-12,M.y-=ya,M.ymx-=ya,M.ymn-=ya);ya=Db-M.ymx;if(0>ya)if(ya=6*Math.ceil(-ya/6),M.ymn-ya>=Cb)M.y-=ya,M.ymx-=ya,M.ymn-=ya;else{var fb=Ta?15:10;M.notes[0].shhd=fb;M.xmx=fb}else ya=Cb-M.ymn,0<ya&&(ya=6*Math.ceil(ya/6),M.ymx+ya<=Db?(M.y+=ya,M.ymx+=ya,M.ymn+=ya):(fb=Ta?15:10,M.notes[0].shhd=fb,M.xmx=fb))}else M.y=12,M.ymx=24,M.ymn=0}}rf()}for(var tb,Za,mb,$a,kb=N,ra=kb,nb=0,pb=[],Xb=[],qb=nb,Gb=kb.time;;){do!kb.a_gch&&!kb.a_ly||
mb||(mb=kb),X.set_width(kb),Za=kb.st,void 0==pb[Za]&&(pb[Za]=0),void 0==Xb[Za]&&(Xb[Za]=0),tb=pb[Za]+Xb[Za]+kb.wl,tb>qb&&(qb=tb),kb=kb.ts_next;while(kb&&!kb.seqst);ra.shrink=qb-nb;ra.space=ra.ts_prev?Qc(ra,Gb):0;0==ra.space&&ra.ts_prev&&ra.ts_prev.type==m.SPACE&&ra.ts_prev.seqst&&(ra.space=ra.ts_prev.space/=2);if(ra.dur&&ra.dur!=ra.notes[0].dur){if(!$a){for($a=ra;$a.prev&&$a.prev.dur&&$a.prev.dur!=$a.prev.notes[0].dur;)$a=$a.prev;for(;!$a.seqst;)$a=$a.ts_prev}}else if($a&&$a.v==ra.v){for(var Mb=$a,
Ib=ra,Jb=Mb.time,Ob=Ib.time-Jb,Kb=Qd(Mb,Ob),eb=Mb,Lb=0;eb=eb.ts_next,eb.seqst&&(Lb+=eb.space,eb.bar_type&&(Lb+=10)),eb!=Ib;);for(Kb=(Kb+Lb)/2/Ob;Mb=Mb.ts_next,Mb.seqst&&(Mb.space=Kb*(Mb.time-Jb),Jb=Mb.time),Mb!=Ib;);$a=null}ra.shrink||ra.space||ra.type!=m.CLEF||(delete ra.seqst,ra.time=Gb);Gb=ra.time;if(!kb)break;for(Za=0;Za<Xb.length;Za++)Xb[Za]=0;nb=qb;do Za=ra.st,pb[Za]=nb,ra.wr>Xb[Za]&&(Xb[Za]=ra.wr),ra=ra.ts_next;while(!ra.seqst)}if(mb)for(var db=mb,ub,ib,wb,Tb,Pb,yb=0,zb=0;db;db=db.ts_next)if(db.shrink&&
(yb+=db.shrink,zb++),db.a_ly&&pc(db),db.a_gch)for(ub=0;ub<db.a_gch.length;ub++)if(ib=db.a_gch[ub],!("g"!=ib.type||0>ib.y)){if(wb&&wb>yb+ib.x)for(db.prev&&db.prev.type==m.BAR&&zb--,Pb=(wb-yb-ib.x)/zb;Tb=Tb.ts_next,Tb.shrink&&(Tb.shrink+=Pb),Tb!=db&&Tb.type!=m.BAR;);Tb=db;wb=ib.text.wh[0];yb=zb=0;break}d=Tc(!0);if(r.singleline)a=Sd(),c=d+a[0]+a[1]+Td(N,null)[0],da.width=c*r.scale+da.lm+da.rm+2;else{var Hb=c=Wb(),rb=d,Na,Ra=N;if(rb){var Ub=Tc();Hb-=Ub;rb-=Ub}Ub=Sd();Hb-=Ub[0];rb+=Ub[1];r.custos&&1==
D.length&&(Hb-=12);if(Ub=Ra.fmt.barsperstaff)for(Na=Ra;Na;Na=Na.ts_next)if(Na.type==m.BAR&&Na.bar_num&&!(0<--Ub)){for(;Na.ts_next&&Na.ts_next.type==m.BAR;)Na=Na.ts_next;Na.ts_next&&(Na.ts_next.soln=!0);Ub=Ra.fmt.barsperstaff}for(Na=Ra;Ra;Ra=Ra.ts_next){if(Ra.ts_next)if(Ra.soln){Ra.soln=!1;if(Ra.time==Na.time)continue;for(;!Ra.seqst;)Ra=Ra.ts_prev}else continue;else Ra=null;Na=mf(Na,Ra,Hb,rb);if(!Na)break;Ra=Na;rb=0}}f=N;for(a=l;0<=--a;)D[a].osym=D[a].sym;for(ec=1.2;;){tf();X.set_sym_glue(c-d);if(ua){d&&
(Vb+=d);We();e=$e();af(d);bf();var Eb;for(Eb=0;Eb<=U;Eb++)A[Eb].sc_out&&(G+="<g "+A[Eb].scale_str+">\n"+A[Eb].sc_out+"</g>\n",A[Eb].sc_out=""),A[Eb].output&&(G+='<g transform="translate(0,'+(-A[Eb].y).toFixed(1)+')">\n'+A[Eb].output+"</g>\n",A[Eb].output="");ma(e);d&&(Vb-=d,Zb&=-3);for(;uc.length;)X.block_gen(uc.shift())}hb();g&&(g.ts_next.ts_prev=g);if(!Sa)break;Sa.ts_prev.ts_next=N=Sa;Ud();if(!N)break;g=N.ts_prev;N.ts_prev=null;for(var Yb,Qb,Rb=D.length;0<=--Rb;)Qb=D[Rb],Qb.sym&&Qb.s_prev&&(Qb.sym.prev=
Qb.s_prev),Yb=Qb.s_next,(Qb.sym=Yb)?(Yb.prev&&(Yb.prev.next=Yb),Qb.s_prev=Yb.prev,Yb.prev=null):Qb.s_prev=null;c=Wb();d=Tc()}N=f;for(a=l;0<=--a;)h=D[a],h.sym&&h.s_prev&&(h.sym.prev=h.s_prev),h.sym=h.osym}};var Xa,la=[],ja,mb={},wf=new Int8Array([0,1,3,2,3,0,2,0,3,0]),wb="CDEFGABcdefgab";Abc.prototype.set_vp=function(a){for(var c,d,e,f,g;;){d=a.shift();if(!d)break;if("="==d.slice(-1)&&!a.length){y(1,J.bad_val,d);break}switch(d){case "clef=":c=a.shift();break;case "clefpitch=":if(d=a.shift())if(f=wb.indexOf(d[0]),
0<=f){switch(d[1]){case "'":f+=7;break;case ",":f-=7,","==d[2]&&(f-=7)}g=4-f;break}y(1,J.bad_val,d);break;case "octave=":f=parseInt(a.shift());isNaN(f)?y(1,J.bad_val,d):n.octave=f;break;case "cue=":n.scale="on"==a.shift()?.7:1;break;case "instrument=":d=a.shift();f=d.indexOf("/");0>f?(f=0,n.sndtran=nb("c"+d)):(n.sndtran=nb("c"+d.slice(f+1)),f=nb(d.replace("/","")));n.transp=r.sound?n.sndtran:f;break;case "map=":n.map=a.shift();break;case "name=":case "nm=":n.nm=a.shift();'"'==n.nm[0]&&(n.nm=n.nm.slice(1,
-1));n.new_name=!0;break;case "stem=":case "pos=":d="pos="==d?a.shift().slice(1,-1).split(" "):["stm",a.shift()];f=gd[d[1]];if(void 0==f){y(1,J.bad_val,"%%pos");break}switch(d[2]){case "align":f|=m.SL_ALIGN;break;case "center":f|=m.SL_CENTER;break;case "close":f|=m.SL_CLOSE}e||(e={});e[d[0]]=f;break;case "scale=":f=parseFloat(a.shift());isNaN(f)||.5>f||2<f?y(1,J.bad_val,"%%voicescale"):n.scale=f;break;case "score=":if(r.nedo){y(1,J.notransp);break}d=a.shift();if(r.sound)break;n.transp=nb(d,!0);break;
case "shift=":if(r.nedo){y(1,J.notransp);break}n.shift=n.sndsh=nb(a.shift());break;case "sound=":if(r.nedo){y(1,J.notransp);break}n.sndtran=nb(a.shift());r.sound&&(n.transp=n.sndtran);break;case "subname=":case "sname=":case "snm=":n.snm=a.shift();'"'==n.snm[0]&&(n.snm=n.snm.slice(1,-1));break;case "stafflines=":f=uf(a.shift());void 0==f?y(1,"Bad %%stafflines value"):void 0!=n.st?P.staves[n.st].stafflines=f:n.stafflines=f;break;case "staffnonote=":f=parseInt(a.shift());isNaN(f)?y(1,"Bad %%staffnonote value"):
n.staffnonote=f;break;case "staffscale=":f=parseFloat(a.shift());isNaN(f)||.3>f||2<f?y(1,"Bad %%staffscale value"):n.staffscale=f;break;case "transpose=":if(r.nedo){y(1,J.notransp);break}f=ue(a.shift());void 0==f?y(1,J.bad_transp):(n.sndtran=f,r.sound&&(n.transp=f));break;default:switch(d.slice(0,4)){case "treb":case "bass":case "alto":case "teno":case "perc":c=d;break;default:0<="GFC".indexOf(d[0])?c=d:"="==d.slice(-1)&&a.shift()}}}if(e)for(d in n.pos=x(n.pos),e)e.hasOwnProperty(d)&&(n.pos[d]=e[d]);
c&&(c=Vd(c))&&(g&&(c.clefpit=g),ve(c))};var Xc=/(\d*)(\/*)(\d*)/g;Abc.prototype.new_note=function(a,c){var d;var e=[];var f=t.line,g=la;la=[];t.stemless=!1;var h={type:m.NOTE,fname:t.fname,stem:0,multi:0,nhd:0,xmx:0};h.istart=t.bol+f.index;n.color&&(h.color=n.color);if(n.tie_s){var l=n.tie_s;n.tie_s=null}a?h.grace=!0:(Xa&&wc(h),t.repeat_n&&(h.repeat_n=t.repeat_n,h.repeat_k=t.repeat_k,t.repeat_n=0));var k=f.char();switch(k){case "X":h.invis=!0;case "Z":h.type=m.MREST;k=f.next_char();h.nmes="0"<k&&
"9">=k?f.get_int():1;h.dur=n.wmeasure*h.nmes;if(n.second){delete n.eoln;n.time+=h.dur;return}1==h.nmes?(h.type=m.REST,h.dur_orig=h.dur,h.notes=[{pit:18,dur:h.dur}]):oa.mrest_p=!0;break;case "y":h.type=m.SPACE;h.invis=!0;h.dur=0;k=f.next_char();h.width="0"<=k&&"9">=k?f.get_int():10;l&&(n.tie_s=l,l=null);break;case "x":h.invis=!0;case "z":h.type=m.REST;f.index++;var p=xc(f);h.dur_orig=(0>n.ulen?m.BLEN:n.ulen)*p[0]/p[1];h.dur=h.dur_orig*n.dur_fact;h.notes=[{pit:18,dur:h.dur_orig}];break;case "[":p=!0,
k=f.next_char();default:if(n.acc_tie){var r=n.acc_tie;n.acc_tie=null}for(h.notes=[];;){if(p)for(;k;){k=k.charCodeAt(0);if(128<=k){y(1,J.not_ascii);return}var q=La[k];switch(q[0]){case "(":e.push(yc());k=f.char();continue;case "!":if(1<q.length)la.push(q.slice(1,-1));else{for(q="";;){k=f.next_char();if(!k){y(1,"No end of decoration");return}if("!"==k)break;q+=k}la.push(q)}k=f.next_char();continue}break}k=f;q=h.grace?m.BLEN/4:0>n.ulen?m.BLEN:n.ulen;(d=ib(k))?("0"==k.char()&&(t.stemless=!0,k.index++),
k=xc(k),d.dur=q*k[0]/k[1],q=d):q=void 0;if(!q)return;n.octave&&(q.pit+=7*n.octave);d=q.pit+19;(k=q.acc)?n.acc[d]=k:(k=n.acc[d],!k&&r&&(k=r[d]),k||(k=n.ckey.k_map[d%7]||0));if(n.map&&mb[n.map])a:{var z=q,v=z.pit,x=se(v,k),A=mb[n.map];if(!(A[x]||(x="o"+x.replace(/[',]+/,""),A[x]||(x="k"+wb[(v+75-11*n.ckey.k_sf)%7],A[x]||(x="all",A[x])))))break a;z.map=A=A[x];A[1]&&(z.pit=A[1].pit,z.acc=A[1].acc);A[2]&&(z.color=A[2]);if(x=A[3])z.midi=Yd(x.pit+19,x.acc)}q.midi||(q.midi=Yd(d,k));n.ckey.k_sndtran&&(q.midi+=
abc2svg.b40m(n.ckey.k_sndtran+122)-36);if(e.length){for(;;){k=e.shift();if(!k)break;n.sls.push({is_note:!0,note:q,ty:k})}q.s=h}if(la.length){q.a_dcn=la;la=[];k=void 0;A=h;var D=q,F=D.a_dcn.length;for(x=0;x<F;x++){v=D.a_dcn[x];if(0<="<>^_@".indexOf(v[0])&&!/^(\^|>|<\(|<\)|>\(|>\))$/.test(v)){k=v[0];if("@"==k){k=v.match(/@[-\d]+,[-\d]+/);if(!k){u(1,A,"Bad position in !$1!",v);continue}k=k[0]}v=v.replace(k,"")}z=qb[v];if(!z&&(z=gc(v),!z))continue;k&&(z=Object.create(z),z.ty=k);switch(z.func){case 0:case 1:case 3:case 4:case 8:break;
default:u(1,A,"Cannot have !$1! on a head",v);continue;case 9:case 32:D.invis=!0;break;case 10:D.color=v;continue;case 40:A.stemless=!0;continue;case 44:ld(v,A,D);continue}D.a_dd||(D.a_dd=[]);D.a_dd.push(z)}}h.notes.push(q);if(!p)break;for(k=f.char();;){switch(k){case ")":q.s=h;Yc(q,!0);k=f.next_char();continue;case "-":q.tie_ty=yc();q.s=h;n.tie_s=h;if(n.acc[d]||r&&r[d])n.acc_tie||(n.acc_tie=[]),n.acc_tie[d]=n.acc[d]||r[d];k=f.char();continue;case ".":k=f.next_char();switch(k){case "-":case "(":la.push("dot");
continue}y(1,"Misplaced dot")}break}if("]"==k){f.index++;p=xc(f);h.nhd=h.notes.length-1;for(k=0;k<=h.nhd;k++)q=h.notes[k],q.dur=q.dur*p[0]/p[1];break}}if(c.length)for(;;){k=c.shift();if(!k)break;h.notes[0].s=h;n.sls.push({note:h.notes[0],ty:k});a&&(n.sls[n.sls.length-1].grace=a)}h.dur_orig=h.notes[0].dur;h.dur=h.notes[0].dur*n.dur_fact}if(h.grace&&h.type!=m.NOTE)y(1,J.bad_grace);else{if(h.notes){if(a){c=n.ckey.k_bagpipe?8:4;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=c;h.dur/=c;h.dur_orig/=c;a.stem&&(h.stem=
a.stem)}else{switch(n.pos.stm&7){case m.SL_ABOVE:h.stem=1;break;case m.SL_BELOW:h.stem=-1;break;case m.SL_HIDDEN:h.stemless=!0}if(e=n.brk_rhythm){n.brk_rhythm=0;p=n.last_note;if(0<e){c=2*e-1;h.dur=h.dur*c/e;h.dur_orig=h.dur_orig*c/e;for(k=0;k<=h.nhd;k++)h.notes[k].dur=h.notes[k].dur*c/e;p.dur/=e;p.dur_orig/=e;for(k=0;k<=p.nhd;k++)p.notes[k].dur/=e}else{e=-e;c=2*e-1;h.dur/=e;h.dur_orig/=e;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=e;p.dur=p.dur*c/e;p.dur_orig=p.dur_orig*c/e;for(k=0;k<=p.nhd;k++)p.notes[k].dur=
p.notes[k].dur*c/e}n.time=p.time+p.dur;for(p=p.next;p;p=p.next)p.time=n.time}}n.last_note=h;for(k=f.char();;){switch(k){case "-":c=yc();for(k=0;k<=h.nhd;k++)h.notes[k].tie_ty=c,h.notes[k].s=h;a?a.tie_s=n.tie_s=a:n.tie_s=h;for(k=0;k<=h.nhd;k++)if(q=h.notes[k],d=q.pit+19,n.acc[d]||r&&r[d])n.acc_tie||(n.acc_tie=[]),n.acc_tie[d]=n.acc[d]||r[d];k=f.char();continue;case ")":h.notes[0].s=h;Yc(h.notes[0]);k=f.next_char();continue;case ".":la.push("dot");k=f.next_char();continue}break}if(l){for(r=0;r<=h.nhd;r++)if(c=
h.notes[r],p=c.midi,l.type!=m.GRACE)for(e=0;e<=l.nhd;e++){if(l.notes[e].tie_ty&&l.notes[e].midi==p){l.notes[e].tie_n=c;c.s=h;l.tie_s=h;break}}else for(e=l.extra;e;e=e.next)if(e.notes[0].tie_ty&&e.notes[0].midi==p){e.tie_s=h;e.notes[0].tie_n=c;c.s=h;e.notes[0].s=e;l.tie_s=h;break}l.tie_s?l.time+l.dur!=(h.time||n.time)&&(h.ti2=l):u(1,l,"Bad tie")}}va(h);a||(n.lyric_restart||(n.lyric_restart=h),n.sym_restart||(n.sym_restart=h));g.length&&Hb(g,h,h.prev);t.ottava.length&&(a?a.ottava=t.ottava:h.ottava=
t.ottava,t.ottava=[]);t.stemless&&(h.stemless=!0);h.iend=t.bol+f.index;return h}};var La='0;0;0;0;0;0;0;0;0; ;\n;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0; ;!;";i;\n;0;&;0;(;);i;0;0;-;!dot!;0;0;0;0;0;0;0;0;0;0;0;|;i;<;n;<;i;i;n;n;n;n;n;n;n;!fermata!;d;d;d;!emphasis!;!lowermordent!;d;!coda!;!uppermordent!;d;d;!segno!;!trill!;d;d;d;n;d;n;[;\\;|;n;n;i;n;n;n;n;n;n;n;d;d;d;d;d;d;d;d;d;d;d;d;d;!upbow!;!downbow!;d;n;n;n;{;|;};!gmark!;0'.split(";"),$d={"8va(":1,"8va)":0,"15ma(":2,"15ma)":0,"8vb(":-1,"8vb)":0,
"15mb(":-2,"15mb)":0},pb,Cd="undefined"!=typeof document?function(a){var c;r.fullsvg&&(zb+="\n"+a);if(!pb)if(abc2svg.sheet)for(pb=abc2svg.sheet,c=pb.cssRules.length;0<=--c;)pb.deleteRule(c);else c=document.createElement("style"),document.head.appendChild(c),abc2svg.sheet=pb=c.sheet;for(a=a.match(/[^{]+{[^}]+}/g);;){c=a.shift();if(!c)break;pb.insertRule(c,pb.cssRules.length)}}:function(a){zb+="\n"+a},ce=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,
.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),xf=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278,.278,.355,
.556,.556,.889,.667,.191,.333,.333,.389,.584,.278,.333,.278,.278,.556,.556,.556,.556,.556,.556,.556,.556,.556,.556,.278,.278,.584,.584,.584,.556,1.015,.667,.667,.722,.722,.667,.611,.778,.722,.278,.5,.667,.556,.833,.722,.778,.667,.778,.722,.667,.611,.722,.667,.944,.667,.667,.611,.278,.278,.278,.469,.556,.333,.556,.556,.5,.556,.556,.278,.556,.556,.222,.222,.5,.222,.833,.556,.556,.556,.556,.333,.5,.278,.556,.5,.722,.5,.5,.5,.334,.26,.334,.584,.512]),be=ce,sa="undefined"!=typeof document?function(){var a=
document.createElement("text");a.style.position="absolute";a.style.top="-1000px";a.style.padding="0";document.body.appendChild(a);return function(c){if(c.wh)return c.wh;var d=H.curfont,e=d.size,f=0,g=0,h=0;a.className=bb(d);a.style.lineHeight=1;if("object"==typeof c)return a.innerHTML=c,c.wh=[a.clientWidth,a.clientHeight],c.wh;for(c=c.replace(/<|>|&[^&]*?;|&|  /g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case "  ":return" \u00a0"}return a});;){h=c.indexOf("$",
h);if(0>h)break;var l=c[h+1];if("0"==l)d=H.deffont;else if("1"<=l&&"9">=l)d=Ga("u"+l);else{h++;continue}a.innerHTML=c.slice(g,h);f+=a.clientWidth;d.size>e&&(e=d.size);a.style.font=Lc(d).slice(5);g=h+=2}a.innerHTML=c.slice(g);f+=a.clientWidth;H.curfont=d;return[f,e]}}():function(a){var c=H.curfont,d=c.swfac,e=c.size,f=0,g,h=a.length;for(g=0;g<h;g++){var l=a[g];switch(l){case "$":l=a[g+1];if("0"==l)c=H.deffont;else if("1"<=l&&"9">=l)c=Ga("u"+l);else{l="$";break}g++;d=c.swfac;c.size>e&&(e=c.size);continue;
case "&":var k=a.indexOf(";",g);0<k&&10>k-g&&(g=k,l="a")}f+=Zc(l)*d}H.curfont=c;return[f,e]},Cf={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},G="",yb="\n.stroke{stroke:currentColor;fill:none}\n.bW{stroke:currentColor;fill:none;stroke-width:1}\n.bthW{stroke:currentColor;fill:none;stroke-width:3}\n.slW{stroke:currentColor;fill:none;stroke-width:.7}\n.slthW{stroke:currentColor;fill:none;stroke-width:1.5}\n.sW{stroke:currentColor;fill:none;stroke-width:.7}\n.box{outline: 1px solid black;outline-offset: 1px}",
zb="",Vb=r.leftmargin/r.scale,aa=0,da={width:r.pagewidth,lm:r.leftmargin,rm:r.rightmargin},ad={},Ac="",bd="",I={scale:1,dy:0,st:-1,v:-1,g:0},Ua=0,Gc={"mtr ":{x:0,y:0,c:" "},brace:{x:0,y:0,c:"\ue000"},lphr:{x:0,y:24,c:"\ue030"},mphr:{x:0,y:24,c:"\ue038"},sphr:{x:0,y:27,c:"\ue039"},rdots:{x:-1,y:0,c:"\ue043"},dsgn:{x:-4,y:-4,c:"\ue045"},dcap:{x:-4,y:-4,c:"\ue046"},sgno:{x:-6,y:0,c:"\ue047"},coda:{x:-12,y:-6,c:"\ue048"},tclef:{x:-8,y:0,c:"\ue050"},cclef:{x:-8,y:0,c:"\ue05c"},bclef:{x:-8,y:0,c:"\ue062"},
pclef:{x:-6,y:0,c:"\ue069"},spclef:{x:-6,y:0,c:"\ue069"},stclef:{x:-8,y:0,c:"\ue07a"},scclef:{x:-8,y:0,c:"\ue07b"},sbclef:{x:-7,y:0,c:"\ue07c"},oct:{x:0,y:2,c:"\ue07d"},mtr0:{x:0,y:0,c:"\ue080"},mtr1:{x:0,y:0,c:"\ue081"},mtr2:{x:0,y:0,c:"\ue082"},mtr3:{x:0,y:0,c:"\ue083"},mtr4:{x:0,y:0,c:"\ue084"},mtr5:{x:0,y:0,c:"\ue085"},mtr6:{x:0,y:0,c:"\ue086"},mtr7:{x:0,y:0,c:"\ue087"},mtr8:{x:0,y:0,c:"\ue088"},mtr9:{x:0,y:0,c:"\ue089"},mtrC:{x:0,y:0,c:"\ue08a"},"mtr+":{x:0,y:0,c:"\ue08c"},"mtr(":{x:0,y:0,c:"\ue094"},
"mtr)":{x:0,y:0,c:"\ue095"},HDD:{x:-7,y:0,c:"\ue0a0"},breve:{x:-7,y:0,c:"\ue0a1"},HD:{x:-5.2,y:0,c:"\ue0a2"},Hd:{x:-3.8,y:0,c:"\ue0a3"},hd:{x:-3.7,y:0,c:"\ue0a4"},ghd:{x:2,y:0,c:"\ue0a4",sc:.66},pshhd:{x:-3.7,y:0,c:"\ue0a9"},pfthd:{x:-3.7,y:0,c:"\ue0b3"},x:{x:-3.7,y:0,c:"\ue0a9"},"circle-x":{x:-3.7,y:0,c:"\ue0b3"},srep:{x:-5,y:0,c:"\ue101"},"dot+":{x:-5,y:0,sc:.7,c:"\ue101"},diamond:{x:-4,y:0,c:"\ue1b9"},triangle:{x:-4,y:0,c:"\ue1bb"},dot:{x:-1,y:0,c:"\ue1e7"},flu1:{x:-.3,y:0,c:"\ue240"},fld1:{x:-.3,
y:0,c:"\ue241"},flu2:{x:-.3,y:0,c:"\ue242"},fld2:{x:-.3,y:0,c:"\ue243"},flu3:{x:-.3,y:3.5,c:"\ue244"},fld3:{x:-.3,y:-4,c:"\ue245"},flu4:{x:-.3,y:8,c:"\ue246"},fld4:{x:-.3,y:-9,c:"\ue247"},flu5:{x:-.3,y:12.5,c:"\ue248"},fld5:{x:-.3,y:-14,c:"\ue249"},"acc-1":{x:-1,y:0,c:"\ue260"},"cacc-1":{x:-18,y:0,c:"\ue26a\ue260\ue26b"},"sacc-1":{x:-1,y:0,sc:.7,c:"\ue260"},acc3:{x:-1,y:0,c:"\ue261"},cacc3:{x:-18,y:0,c:"\ue26a\ue261\ue26b"},sacc3:{x:-1,y:0,sc:.7,c:"\ue261"},acc1:{x:-2,y:0,c:"\ue262"},cacc1:{x:-18,
y:0,c:"\ue26a\ue262\ue26b"},sacc1:{x:-2,y:0,sc:.7,c:"\ue262"},acc2:{x:-3,y:0,c:"\ue263"},"acc-2":{x:-3,y:0,c:"\ue264"},"acc-1_2":{x:-2,y:0,c:"\ue280"},"acc-3_2":{x:-3,y:0,c:"\ue281"},acc1_2:{x:-1,y:0,c:"\ue282"},acc3_2:{x:-3,y:0,c:"\ue283"},accent:{x:-3,y:2.5,c:"\ue4a0"},stc:{x:-1,y:-2,c:"\ue4a2"},emb:{x:-4,y:-2,c:"\ue4a4"},wedge:{x:-1,y:0,c:"\ue4a8"},marcato:{x:-3,y:-2,c:"\ue4ac"},hld:{x:-7,y:2,c:"\ue4c0"},brth:{x:0,y:0,c:"\ue4ce"},r00:{x:-1.5,y:0,c:"\ue4e1"},r0:{x:-1.5,y:0,c:"\ue4e2"},r1:{x:-3.5,
y:-6,c:"\ue4e3"},r2:{x:-3.2,y:0,c:"\ue4e4"},r4:{x:-3,y:0,c:"\ue4e5"},r8:{x:-3,y:0,c:"\ue4e6"},r16:{x:-4,y:0,c:"\ue4e7"},r32:{x:-4,y:0,c:"\ue4e8"},r64:{x:-4,y:0,c:"\ue4e9"},r128:{x:-4,y:0,c:"\ue4ea"},mrest:{x:-10,y:0,c:"\ue4ee"},mrep:{x:-6,y:0,c:"\ue500"},mrep2:{x:-9,y:0,c:"\ue501"},p:{x:-4,y:-6,c:"\ue520"},f:{x:-2.5,y:-6,c:"\ue522"},pppp:{x:-15,y:-6,c:"\ue529"},ppp:{x:-11,y:-6,c:"\ue52a"},pp:{x:-8,y:-6,c:"\ue52b"},mp:{x:-8.5,y:-6,c:"\ue52c"},mf:{x:-8,y:-6,c:"\ue52d"},ff:{x:-6,y:-6,c:"\ue52f"},fff:{x:-9,
y:-6,c:"\ue530"},ffff:{x:-12,y:-6,c:"\ue531"},sfz:{x:-9,y:-6,c:"\ue539"},trl:{x:-4,y:-4,c:"\ue566"},turn:{x:-5,y:3,c:"\ue567"},turnx:{x:-5,y:3,c:"\ue569"},umrd:{x:-7,y:2,c:"\ue56c"},lmrd:{x:-7,y:2,c:"\ue56d"},dplus:{x:-4,y:0,c:"\ue582"},sld:{x:-8,y:12,c:"\ue5d0"},grm:{x:-2,y:0,c:"\ue5e2"},dnb:{x:-4,y:0,c:"\ue610"},upb:{x:-3,y:0,c:"\ue612"},opend:{x:-2,y:0,c:"\ue614"},roll:{x:0,y:2,c:"\ue618"},thumb:{x:0,y:0,c:"\ue624"},snap:{x:-2,y:0,c:"\ue630"},ped:{x:-10,y:0,c:"\ue650"},pedoff:{x:-5,y:0,c:"\ue655"},
mtro:{x:0,y:0,c:"\ue911"},mtrc:{x:0,y:0,c:"\ue915"},"mtr.":{x:0,y:0,c:"\ue920"},"mtr|":{x:0,y:0,c:"\ue925"},longa:{x:-4.7,y:0,c:"\ue95d"},custos:{x:-4,y:3,c:"\uea02"},ltr:{x:2,y:6,c:"\ueaa4"}},Kb={},ta=q.anno_start?yf:Bc,Wa=q.anno_stop?zf:Bc;Abc.prototype.out_svg=function(a){G+=a};Abc.prototype.sx=ab;Abc.prototype.sy=eb;Abc.prototype.sh=function(a){return 0>I.st?a/I.scale:a};Abc.prototype.ax=function(a){return a+Vb};Abc.prototype.ay=function(a){return 0>I.st?aa-a:aa+(I.dy-a)*I.scale-I.dy};Abc.prototype.ah=
function(a){return 0>I.st?a:a*I.scale};Abc.prototype.out_sxsy=Oa;Abc.prototype.xypath=Ib;var Ja=[[],[],"",[],[],[]],Af={crdc:{dx:0,dy:5,style:"font:italic 14px text,serif"},dacs:{dx:0,dy:3,style:"font:16px text,serif",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font:italic bold 16px text,serif"},"@":{dx:0,dy:5,style:"font:12px text,sans-serif"}};Abc.prototype.out_lped=function(a,c,d,e){c+=4;e.nost||ca(a,c,"ped");e.noen||ca(a+d+6,c,"pedoff")};var me={arp:ke,cresc:function(a,c,d,e){a+=d;d=
-d;Y('<path class="stroke"\n\td="mX YlA ',a,c+5,d);G=e.nost?G+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):G+("-4l"+(-d).toFixed(1)+' -4"/>\n')},dim:function(a,c,d,e){Y('<path class="stroke"\n\td="mX YlA ',a,c+5,d);G=e.noen?G+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):G+("-4l"+(-d).toFixed(1)+' -4"/>\n')},ltr:le,lped:function(a,c,d,e){X.out_lped(a,c,d,e)},"8va":function(a,c,d,e){e.nost?d-=5:(Y('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',
a-8,c),a+=12,d-=12);c+=6;Y('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||Y('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"8vb":function(a,c,d,e){e.nost?d-=5:(Y('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy=".5" style="font-size:10px">va</tspan></text>\n',a-8,c),a+=10,d-=10);Y('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||Y('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)},"15ma":function(a,c,d,e){e.nost?d-=5:(Y('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',
a-10,c),a+=20,d-=20);c+=6;Y('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||Y('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"15mb":function(a,c,d,e){e.nost?d-=5:(Y('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy="-.5" style="font-size:10px">ma</tspan></text>\n',a-10,c),a+=18,d-=18);Y('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||Y('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)}},Be={glisq:function(a,c,d){d=d.start;var e=
d.x,f=d.y+A[d.st].y;c=Math.atan2(f-c,a-e);a=(a-e)/Math.cos(c);Jb(e,f,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a=(a-e-6)/6|0;for(1>a&&(a=1);0<=--a;)ca(e,0,"ltr"),e+=6;Ob()},gliss:function(a,c,d){d=d.start;var e=d.x,f=d.y+A[d.st].y;c=-Math.atan2(c-f,a-e);a=(a-e)/Math.cos(c);Jb(e,f,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a-=e+8;Ib(e,0);G+="h"+a.toFixed(1)+'" stroke-width="1"/>\n';Ob()}};Abc.prototype.blk_flush=hb;var P,L,D,n,ob,ea,N,Pa=new Uint8Array([4,1,8,0,3,5,6,9,9,0,9,3,0,7,0,0,0,0]);Abc.prototype.set_bar_num=
function(){var a,c,d,e=H.nbar,f=0,g=0,h=D[L.top_voice].meter.wmeasure;for(a=N;;a=a.ts_next){if(!a)return;switch(a.type){case m.METER:h=a.wmeasure;case m.CLEF:case m.KEY:case m.STBRK:continue;case m.BAR:a.bar_num&&(e=a.bar_num)}break}for(c=a.ts_next;c;c=c.ts_next)if(c.type==m.BAR&&c.time){c.time<h&&(a=c,f=a.time);break}for(;a;a=a.ts_next)if(a.seqst)switch(a.type){case m.METER:e+=(a.time-f)/h;f=a.time;h=a.wmeasure;break;case m.BAR:if(!a.invis)if(c=a.time,a.bar_num)e=a.bar_num,g=f=c;else if(1==h)a.bar_dotted||
(a.text&&(r.contbarnb||("1"==a.text[0]?d=e:e=d)),a.bar_num=++e);else{var l=e+(c-f)/h;var k=l-(l|0);r.checkbars&&(k&&!a.bar_dotted&&a.next||c>g+h&&a.prev.type!=m.MREST)&&u(0,a,"Bad measure duration");c>g+h&&(l|=0,k=0,f=c,e=l);a.text?"1"==a.text[0]?(d=r.contbarnb?f+k*h:c,k||(a.bar_num=l)):(f=r.contbarnb?d:f+(c-d),l=e+(c-f)/h,l==(l|0)&&(a.bar_num=l)):(k&&(l-=k),a.bar_num=l);k||(g=c)}}};Abc.prototype.do_pscom=function(a){var c;if(c=a.match(/(\w|-)+/)){c=c[0];if(n&&n.ignore)switch(c){case "staves":case "score":break;
default:return}a=a.replace(c,"").trim();if(" lock"==a.slice(-5))Je[c]=!0,a=a.slice(0,-5).trim();else if(Je[c])return;"title"==c.slice(0,5)&&2==t.state&&Fa();switch(c){case "center":V("text");if(2<=t.state){c=Ia("text");c.text=a;c.opt="c";c.font=r.textfont;return}zc(a,"c");return;case "clef":2<=t.state&&(2==t.state&&Fa(),(c=Vd(a))&&ve(c));return;case "deco":c=a.match(/(\S*)\s+(.*)/);Ec[c[1]]=c[2];return;case "linebreak":for(c=0;128>c;c++)"\n"==La[c]&&(La[c]="0");a=a.split(/\s+/);for(c=0;c<a.length;c++){var d=
a[c];switch(d){case "!":case "$":case "*":case ";":case "?":case "@":break;case "<none>":continue;case "<EOL>":d="\n";break;default:y(1,"Bad value '$1' in %%linebreak - ignored",d);continue}La[d.charCodeAt(0)]="\n"}return;case "map":a:if(a){var e="";c=a.split(/\s+/);if(3>c.length)y(1,not_enough_p);else{var f=c[1];if("*"==f[0]||0==f.indexOf("all"))f="all";else{if(0==f.indexOf("octave,")||0==f.indexOf("key,"))e=f[0],f=f.split(",")[1],f=f.replace(/[,']+/,"").toUpperCase(),0==f.indexOf("key,")&&(f=f.replace(/[=^_]+/,
""));d=new O;d.buffer=f;d=ib(d);if(!d){y(1,"Bad note in %%map");break a}f=e+se(d.pit,d.acc)}(d=mb[c[0]])||(mb[c[0]]=d={});(a=d[f])||(d[f]=a=[]);c.shift();c.shift();if(c.length){c=dc(c.join(" "));f=0;if(0>c[0].indexOf("=")){"*"!=c[0][0]&&(d=new O,d.buffer=c[0],a[1]=ib(d));if(!c[1])break a;f++;0>c[1].indexOf("=")&&(a[0]=c[1].split(","),f++)}for(;f<c.length;f++)switch(c[f]){case "heads=":if(!c[++f]){y(1,not_enough_p);break}a[0]=c[f].split(",");break;case "print=":case "play=":if(!c[++f]){y(1,not_enough_p);
break}d=new O;d.buffer=c[f];d=ib(d);"r"==c[f-1][1]?a[1]=d:a[3]=d;break;case "color=":c[++f]?a[2]=c[f]:y(1,not_enough_p)}}}}return;case "maxsysstaffsep":case "sysstaffsep":if(3==t.state){d=Ea(a);if(isNaN(d)){y(1,J.bad_val,"%%"+c);return}P.voices[n.v]["m"==c[0]?"maxsep":"sep"]=d;return}break;case "multicol":if(2<=t.state){2==t.state&&Fa();n=D[0];Ia("mc_"+a);break}switch(a){case "start":ja={maxy:0,lmarg:r.leftmargin,rmarg:r.rightmargin};break;case "new":if(!ja){y(1,"%%multicol new without start");break}aa>
ja.maxy&&(ja.maxy=aa);r.leftmargin=ja.lmarg;r.rightmargin=ja.rmarg;da.chg=!0;wa();aa=0;break;case "end":if(!ja){y(1,"%%multicol end without start");break}aa<ja.maxy&&(aa=ja.maxy);r.leftmargin=ja.lmarg;r.rightmargin=ja.rmarg;ja=void 0;hb();da.chg=!0;wa();break;default:y(1,"Unknown keyword '$1' in %%multicol",a)}return;case "ottava":if(3!=t.state){if(2!=t.state)return;Fa()}c=parseInt(a);if(isNaN(c)||-2>c||2<c){y(1,J.bad_val,"%%ottava");return}oa.ottava=!0;t.ottava.push(c);return;case "repbra":n&&(n.norepbra=
!Ta(a));return;case "repeat":if(3!=t.state)return;if(!n.last_sym){y(1,"%%repeat cannot start a tune");return}if(a.length){a=a.split(/\s+/);c=parseInt(a[0]);a=parseInt(a[1]);if(isNaN(c)||1>c||n.last_sym.type==m.BAR&&2<c){y(1,"Incorrect 1st value in %%repeat");return}if(isNaN(a))a=1;else if(1>a){y(1,"Incorrect 2nd value in %%repeat");return}}else a=c=1;t.repeat_n=n.last_sym.type==m.BAR?c:-c;t.repeat_k=a;return;case "sep":wa();var g=da.width-da.lm-da.rm;d=f=e=0;if(a&&(a=a.split(/\s+/),d=Ea(a[0]),a[1]&&
(f=Ea(a[1]),a[2]&&(e=Ea(a[2]))),isNaN(d)||isNaN(f)||isNaN(e))){y(1,J.bad_val,"%%sep");return}1>d&&(d=14);1>f&&(f=d);1>e&&(e=90);if(2<=t.state){c=Ia(c);c.x=(g-e)/2/r.scale;c.l=e/r.scale;c.sk1=d;c.sk2=f;return}ma(d);G+='<path class="stroke"\n\td="M';Oa((g-e)/2/r.scale," ",0);G+="h"+(e/r.scale).toFixed(1)+'"/>\n';ma(f);hb();return;case "setbarnb":d=parseInt(a);if(isNaN(d)||1>d){y(1,"Bad %%setbarnb value");break}2==t.state&&Fa();oa.new_nbar=d;return;case "staff":if(3!=t.state){if(2!=t.state)return;Fa()}d=
parseInt(a);if(isNaN(d)){y(1,"Bad %%staff value '$1'",a);return}c="+"==a[0]||"-"==a[0]?n.cst+d:d-1;if(0>c||c>U){y(1,"Bad %%staff number $1 (cur $2, max $3)",c,n.cst,U);return}delete n.floating;n.cst=c;return;case "staffbreak":if(3!=t.state){if(2!=t.state)return;Fa()}c={type:m.STBRK,dur:0};"f"==a.slice(-1)&&(c.stbrk_forced=!0,a=a.replace(/\sf$/,""));if(a){d=Ea(a);if(isNaN(d)){y(1,J.bad_val,"%%staffbreak");return}c.xmx=d}else c.xmx=14;va(c);return;case "stafflines":case "staffscale":case "staffnonote":ac(c,
a);return;case "staves":case "score":if(0==t.state)return;t.scores&&0<t.scores.length&&(a=t.scores.shift(),c=a.match(/([^\s]+)\s*(.*)/),a=c[2],c=c[1]);var h;b:{d={};f=[];e=!1;var l=h=g=0,k=0,p=0,u=a.match(/[^[\]|{}()*+\s]+|[^\s]/g);if(u){for(;;){var A=u.shift();if(!A)break;switch(A){case "[":if(k||2<=h+l){y(1,J.misplaced,"[");e=!0;break}g|=0==h+l?4:1024;l++;p<<=8;p|=4;break;case "{":if(k||h||2<=l){y(1,J.misplaced,"{");e=!0;break}g|=l?256:1;h++;p<<=8;p|=1;break;case "(":if(k){y(1,J.misplaced,"(");
e=!0;break}g|=16;k++;p<<=8;p|=16;break;case "*":!h||k||g&257||(g|=128);break;case "+":g|=4096;break;case "]":case "}":case ")":y(1,"Bad voice ID in %%score");e=!0;break;default:for(a=A;;){A=u.shift();if(!A)break;switch(A){case "]":if(!(p&4)){y(1,J.misplaced,"]");e=!0;break}l--;g|=0==h+l?8:2048;p>>=8;continue;case "}":if(!(p&1)){y(1,J.misplaced,"}");e=!0;break}h--;g|=l?512:2;g&=-129;p>>=8;continue;case ")":if(!(p&16)){y(1,J.misplaced,")");e=!0;break}k--;g|=32;p>>=8;continue;case "|":g|=64;continue}break}d[a]?
(y(1,"Double voice in %%score"),e=!0):(d[a]=!0,f.push([a,g]));g=0;A&&u.unshift(A)}}0!=p&&(y(1,"'}', ')' or ']' missing in %%score"),e=!0);if(!e&&f.length){a=f;break b}}else y(1,J.bad_val,"%%score");a=void 0}if(a){D.length&&Fd(!0);g=0;f=!0;for(e=0;e<D.length;e++)d=D[e],d.time>g&&(g=d.time),d.sym&&(f=!1);if(f||0==g&&0>ob)P.staves=[],P.voices=[];else{for(e=0;e<P.voices.length;e++)if(P.voices[e]){n=D[e];break}n.time=g;d={type:m.STAVES,dur:0};va(d);P.nstaff=U;re();d.sy=P}ob=g;for(e=0;e<D.length;e++)d=
D[e],delete d.second,delete d.ignore,delete d.floating;for(f=h=0;f<a.length;f++)for(d=a[f][0],d=fd(d),d.time=g,e=d.v,a[f][0]=d;;){P.voices[e]={};P.voices[e].range=h++;d=d.voice_down;if(!d)break;e=d.v}P.top_voice=a[0][0].v;if("t"==c[1])for(f=0;f<a.length;f++)h=a[f][1],h&257&&3!=(h&3)&&768!=(h&768)&&0==a[f+1][1]&&!(h&16||a[f+2][1]&16)&&(a[f+2][1]&514?a[f+1][1]|=128:0==a[f+2][1]&&a[f+3][1]&514&&(a[f][1]|=16,a[f+1][1]|=32,a[f+2][1]|=16,a[f+3][1]|=32));g=-1;for(f=0;f<a.length;f++)if(h=a[f][1],48==(h&48)&&
(h&=-49,a[f][1]=h),d=a[f][0],h&128?(d.floating=!0,d.second=!0):(g++,P.staves[g]||(P.staves[g]={stafflines:d.stafflines||"|||||",staffscale:1}),P.staves[g].flags=0),e=d.v,d.st=d.cst=P.voices[e].st=g,P.staves[g].flags|=h,h&16){for(h=d;f<a.length-1&&!(d=a[++f][0],e=d.v,a[f][1]&4096?(h.second=!0,h=d):d.second=!0,d.st=d.cst=P.voices[e].st=g,a[f][1]&32););P.staves[g].flags|=a[f][1]}0>g&&(g=0);P.nstaff=U=g;if("c"==c[1])for(g=0;g<U;g++)P.staves[g].flags^=64;for(e=0;e<D.length;e++)if(d=D[e],P.voices[e]){for(h=
d.voice_down;h;)f=h.v,h.st=h.cst=P.voices[f].st=g,h=h.voice_down;P.voices[e].second=d.second;g=d.st;!(0<g)||d.norepbra||P.staves[g-1].flags&64||(d.norepbra=!0)}n=2<=t.state?D[P.top_voice]:null}return;case "text":V("text");if(2<=t.state){c=Ia(c);c.text=a;c.opt=r.textoption;c.font=r.textfont;return}zc(a,r.textoption);return;case "transpose":if(r.sound)return;d=ue(a);if(void 0==d&&(d=nb(a),void 0==d)){y(1,J.bad_transp);return}switch(t.state){case 0:r.transp=0;case 1:case 2:r.transp=(r.transp||0)+d;return}for(c=
n.last_sym;c;c=c.prev){switch(c.type){case m.NOTE:c=x(n.okey);c.k_old_sf=n.ckey.k_sf;va(c);break;case m.KEY:break;default:continue}break}n.transp=d;Cc();return;case "tune":return;case "user":Wd(a);return;case "voicecolor":n&&(n.color=a);return;case "vskip":d=Ea(a);if(isNaN(d)){y(1,J.bad_val,"%%vskip");return}if(0>d){y(1,"%%vskip cannot be negative");return}if(2<=t.state){c=Ia(c);c.sk=d;return}ma(d);return;case "newpage":case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "printmargin":case "scale":case "staffwidth":if(2<=
t.state){c=Ia(c);c.param=a;return}if("newpage"==c){hb();q.page_format&&(Ua=2);return}}X.set_format(c,a)}};Abc.prototype.do_begin_end=function(a,c,d){switch(a){case "js":Va(d);break;case "ml":2<=t.state?(a=Ia(a),a.text=d):(hb(),q.img_out&&q.img_out(d));break;case "svg":for(c=0;;){a=d.indexOf("<style",c);if(0>a)break;a=d.indexOf(">",a);c=d.indexOf("</style>",a);if(0>c){y(1,"No </style> in %%beginsvg sequence");break}yb+=d.slice(a+1,c).replace(/\s+$/,"")}for(c=0;;){a=d.indexOf("<defs>\n",c);if(0>a)break;
c=d.indexOf("</defs>",a);if(0>c){y(1,"No </defs> in %%beginsvg sequence");break}ge(d.slice(a+6,c))}break;case "text":c=Le[c],c||(c=r.textoption),V("text"),2<=t.state?(a=Ia(a),a.text=d,a.opt=c,a.font=r.textfont):zc(d,c)}};var ze="CDEFGAB",Df=["bb","b","","#","##"];Abc.prototype.gch_build=function(a){var c,d=0,e=0;for(c=0;c<a.a_gch.length;c++){var f=a.a_gch[c];if("g"==f.type)f.text=f.text.replace(/##|#|=|bb|b|  /g,function(a){switch(a){case "##":return"&#x1d12a;";case "#":return"\u266f";case "=":return"\u266e";
case "b":return"\u266d";case "  ":return" \u00a0"}return"&#x1d12b;"});else if("@"==f.type&&!q.anno_start&&!q.anno_stop){V(f.font);f.text=xb(f.text);f.text.wh=[0,0];continue}V(f.font);f.text=xb(f.text);var g=f.text.wh;g[1]+=2*f.font.pad;switch(f.type){case "@":break;case "^":case "_":g=.4*g[0];8<g&&(g=8);f.x=-g;break;case "<":f.x=-(g[0]+6);d-=g[1];f.y=d+g[1]/2;break;case ">":f.x=6;e-=g[1];f.y=e+g[1]/2;break;default:g=.4*g[0],8<g&&(g=8),f.x=-g}}d/=2;e/=2;for(c=0;c<a.a_gch.length;c++)switch(f=a.a_gch[c],
f.type){case "<":f.y-=d;break;case ">":f.y-=e}};Abc.prototype.draw_gchord=function(a,c,d,e){a=c.a_gch[a];var f=a.text.wh[1];var g=a.font.pad;var h=a.text.wh[0]+2*g,l=0;a.font.figb&&(f*=2.4,l=1.3*a.font.size);switch(a.type){case "_":e-=f+g;R(c.st,0,d,h,e-g);break;case "^":e=Q(c.st,1,d,h);e+=g;R(c.st,1,d,h,e+f+g);break;case "<":case ">":"<"==a.type?(c.notes[0].acc&&(d-=c.notes[0].shac),d-=g):(c.xmx&&(d+=c.xmx),c.dots&&(d+=1.5+3.5*c.dots),d+=g);e+=(c.type==m.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>
1)-18):12)-f/2;24<e&&R(c.st,1,d,h,e+f+g);0>e&&R(c.st,0,d,h,e-g);break;default:0<=e?(e+=g,R(c.st,1,d,h,e+f+g)):(e-=f+g,R(c.st,0,d,h,e-g));break;case "@":e+=(c.type==m.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)+.2*f,0<e?(g=e+.8*f,g>A[c.st].ann_top&&(A[c.st].ann_top=g)):(g=e,g<A[c.st].ann_bot&&(A[c.st].ann_bot=g))}tb(a.font);V(a.font);za(c.st);q.anno_start&&q.anno_start("annot",a.istart,a.iend,d-2,e+f+2,h+4,f+4,c);na(d,e+l,a.text);q.anno_stop&&q.anno_stop("annot",a.istart,a.iend,d-2,e+f+
2,h+4,f+4,c)};Id();Abc.prototype.a_de=function(){return ia};Abc.prototype.add_style=function(a){yb+=a};Abc.prototype.cfmt=function(){return r};Abc.prototype.clone=x;Abc.prototype.deco_cnv=Hb;Abc.prototype.defs_add=ge;Abc.prototype.draw_meter=rd;Abc.prototype.draw_note=ic;Abc.prototype.errs=J;Abc.prototype.font_class=bb;Abc.prototype.gch_tr1=ye;Abc.prototype.get_bool=Ta;Abc.prototype.get_cur_sy=function(){return L};Abc.prototype.get_curvoice=function(){return n};Abc.prototype.get_delta_tb=function(){return hd};
Abc.prototype.get_decos=function(){return Ec};Abc.prototype.get_font=Ga;Abc.prototype.get_font_style=function(){return zb};Abc.prototype.get_glyphs=function(){return Kb};Abc.prototype.get_img=function(){return da};Abc.prototype.get_maps=function(){return mb};Abc.prototype.get_multi=function(){return ja};Abc.prototype.get_newpage=function(){if(block.newpage)return block.newpage=!1,!0};Abc.prototype.get_posy=function(){var a=aa;aa=0;return a};Abc.prototype.get_staff_tb=function(){return A};Abc.prototype.get_top_v=
function(){return P.top_voice};Abc.prototype.get_tsfirst=function(){return N};Abc.prototype.get_unit=Ea;Abc.prototype.get_voice_tb=function(){return D};Abc.prototype.glout=fb;Abc.prototype.goto_tune=Fa;Abc.prototype.info=function(){return S};Abc.prototype.new_block=Ia;Abc.prototype.out_arp=ke;Abc.prototype.out_deco_str=je;Abc.prototype.out_deco_val=ed;Abc.prototype.out_ltr=le;Abc.prototype.param_set_font=rb;Abc.prototype.parse=t;Abc.prototype.psdeco=Bc;Abc.prototype.psxygl=Bc;Abc.prototype.set_cur_sy=
function(a){L=a};Abc.prototype.set_dscale=za;Abc.prototype.set_font=V;Abc.prototype.set_a_gch=function(a,c){Xa=c;wc(a)};Abc.prototype.set_hl=Nb;Abc.prototype.set_pagef=function(){Ua=1};Abc.prototype.set_scale=jb;Abc.prototype.set_tsfirst=function(a){N=a};Abc.prototype.set_v_param=ac;Abc.prototype.strwh=sa;Abc.prototype.stv_g=function(){return I};Abc.prototype.svg_flush=Pb;Abc.prototype.syntax=y;Abc.prototype.tunes=Nc;Abc.prototype.unlksym=sb;Abc.prototype.use_font=tb;Abc.prototype.vskip=ma;Abc.prototype.xy_str=
na;Abc.prototype.xygl=ca;var Ae};var Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc);abc2svg.loadjs||(abc2svg.loadjs=function(q,x,F){F&&F()});
abc2svg.modules={ambitus:{},begingrid:{fn:"grid3"},beginps:{fn:"psvg"},break:{},capo:{},chordnames:{},clip:{},clairnote:{fn:"clair"},voicecombine:{fn:"combine"},diagram:{fn:"diag"},equalbars:{},gamelan:{},grid:{},grid2:{},jazzchord:{},jianpu:{},mdnn:{},MIDI:{},pageheight:{fn:"page"},pedline:{},percmap:{fn:"perc"},soloffs:{},sth:{},strtab:{},temperament:{fn:"temper"},nreq:0,hooks:[],g_hooks:[],load:function(q,x,F){function u(){return"object"==typeof user&&user.errmsg?user.errmsg:"function"==typeof abc2svg.printErr?
abc2svg.printErr:"function"==typeof alert?function(q){alert(q)}:"object"==typeof console?console.log:function(){}}function O(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}var y=this.nreq;q=q.match(/(^|\n)(%%|I:).+?\b/g);if(!q)return!0;this.cbf=x||function(){};this.errmsg=F||u();for(F=0;F<q.length;F++){var Va=q[F].replace(/\n?(%%|I:)/,"");(x=abc2svg.modules[Va])&&!x.loaded&&(x.loaded=!0,x.fn&&(Va=x.fn),this.nreq++,abc2svg.loadjs(Va+"-1.js",O,function(){abc2svg.modules.errmsg("Error loading the module "+
Va);O()}))}return this.nreq==y}};abc2svg.version="1.21.0";abc2svg.vdate="2021-06-01";
abc2svg.MIDI={do_midi:function(q){var x,F=q.split(/\s+/);q=this.cfmt();if(x=this.get_curvoice()){if(x.ignore)return;void 0==x.chn&&(x.chn=9>x.v?x.v:x.v+1)}switch(F[1]){case "chordname":q.chord||(q.chord={});q.chord.names||(q.chord.names={});q.chord.names[F[2]]=F.slice(3);break;case "chordprog":q.chord||(q.chord={});q.chord.prog=F[2];F[3]&&"octave="==F[3].slice(0,7)&&(q.chord.trans=Number(F[3].slice(7)));break;case "chordvol":var u=Number(F[2]);if(isNaN(u)||0>u||127<u){this.syntax(1,this.errs.bad_val,
"%%MIDI chordvol");break}q.chord||(q.chord={});q.chord.vol=u/127;break;case "gchordon":case "gchordoff":q.chord||(q.chord={});2==this.parse.state&&this.goto_tune();if(2<=this.parse.state&&this.get_curvoice()){var O=this.new_block("midigch");O.play=!0;O.on="n"==F[1][7]}else q.chord.gchon="n"==F[1][7];break;case "channel":u=parseInt(F[2]);if(isNaN(u)||0>=u||16<u){this.syntax(1,this.errs.bad_val,"%%MIDI channel");break}if(9!=--u){3==this.parse.state?(O=this.new_block("midichn"),O.play=!0,O.chn=u):this.set_v_param("channel",
u);break}abc2svg.MIDI.do_midi.call(this,"MIDI control 0 1");abc2svg.MIDI.do_midi.call(this,"MIDI control 32 0");break;case "drummap":u=Number(F[3]);if(isNaN(u)){this.syntax(1,this.errs.bad_val,"%%MIDI drummap");break}for(x="C ^C D _E E F ^F G ^G A _B B".split(" ")[u%12];60>u;)x+=",",u+=12;for(;72<u;)x+="'",u-=12;this.do_pscom("map MIDIdrum "+F[2]+" play="+x);this.set_v_param("mididrum","MIDIdrum");break;case "program":void 0!=F[3]?(abc2svg.MIDI.do_midi.call(this,"MIDI channel "+F[2]),u=F[3]):u=F[2];
u=parseInt(u);if(isNaN(u)||0>u||127<u){this.syntax(1,this.errs.bad_val,"%%MIDI program");break}3==this.parse.state?(O=this.new_block("midiprog"),O.play=!0,O.instr=u):this.set_v_param("instr",u);break;case "control":x=parseInt(F[2]);if(isNaN(x)||0>x||127<x){this.syntax(1,"Bad controller number in %%MIDI");break}u=parseInt(F[3]);if(isNaN(u)||0>u||127<u){this.syntax(1,"Bad controller value in %%MIDI");break}3==this.parse.state?(O=this.new_block("midictl"),O.play=!0,O.ctrl=x,O.val=u):this.set_v_param("midictl",
F[2]+" "+F[3]);break;case "temperamentequal":if(x=parseInt(F[2]),isNaN(x)||5>x||255<x)this.syntax(1,this.errs.bad_val,"%%MIDI "+F[1]);else{53==x&&(O=this.get_glyphs(),O.acc12_53='<text id="acc12_53" x="-1">&#xe282;</text>',O.acc24_53='<text id="acc24_53" x="-1">&#xe282;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',O.acc36_53='<text id="acc36_53" x="-1">&#xe262;\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>',O.acc48_53='<text id="acc48_53" x="-1">&#xe262;</text>',O.acc60_53=
'<g id="acc60_53">\n\t<text style="font-size:1.2em" x="-1">&#xe282;</text>\n\t<path class="stroke" stroke-width="1.6" d="M-2 1.5l7 -3"/>\n</g>',O["acc-60_53"]='<text id="acc-60_53" x="-1">&#xe260;</text>',O["acc-48_53"]='<g id="acc-48_53">\n\t<text x="-1">&#xe260;</text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',O["acc-36_53"]='<g id="acc-36_53">\n\t<text x="-1">&#xe260;\t\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',
O["acc-24_53"]='<text id="acc-24_53" x="-2">&#xe280;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',O["acc-12_53"]='<text id="acc-12_53" x="-2">&#xe280;</text>');q.nedo=x;x=12*(7.019550008653874*x/12+.5|0)/x;(6.85>x||7.2<x)&&this.syntax(0,this.errs.bad_val,"%%MIDI "+F[1]);u=[2,25,8,31,14,37,20,3,26,9,32,15,38,21,4,27,10,33,16,39];O=[0,19,36,13,30,7,24,1,18,35,12,29,6,23,0,17];var y=21-3*x;b=new Float32Array(40);for(F=0;F<u.length;F++)b[u[F]]=(x*F+y)%12;for(F=1;F<=O.length;F++)b[O[F]]=
12-(x*F-y)%12;q.temper=b}}},set_vp:function(q,x){var F,u=this.get_curvoice();for(F=0;F<x.length;F++)switch(x[F]){case "channel=":u.chn=x[++F];break;case "instr=":u.instr=x[++F];break;case "midictl=":u.midictl||(u.midictl=[]);var O=x[++F].split(" ");u.midictl[O[0]]=Number(O[1]);break;case "mididrum=":u.map||(u.map={}),u.map=x[++F]}q(x)},do_pscom:function(q,x){"MIDI "==x.slice(0,5)?abc2svg.MIDI.do_midi.call(this,x):q(x)},set_hooks:function(q){q.do_pscom=abc2svg.MIDI.do_pscom.bind(q,q.do_pscom);q.set_vp=
abc2svg.MIDI.set_vp.bind(q,q.set_vp)}};abc2svg.modules.hooks.push(abc2svg.MIDI.set_hooks);abc2svg.modules.MIDI.loaded=!0;
abc2svg.perc={do_perc:function(q){new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]);new Int8Array([3,1,3,-1,3,3,1,3,-1,3,-1,3]);var x={"a-b-d":35,"a-s":38,"b-d-1":36,ca:69,cl:75,co:56,"c-c":52,"c-c-1":49,"c-c-2":57,"c-h-h":42,"e-s":40,"h-a":67,"h-b":60,"h-c":39,"h-f-t":43,"h-m-t":48,"h-ti":65,"h-to":50,"h-w-b":76,"l-a":68,"l-b":61,"l-c":64,"l-f-t":41,"l-g":74,"l-m-t":47,"l-ti":66,"l-to":45,"l-w":72,"l-w-b":77,m:70,"m-c":78,"m-h-c":62,"m-t":80,"o-c":79,"o-h-c":63,"o-h-h":46,"o-t":81,"p-h-h":44,"r-b":53,"r-c-1":51,
"r-c-2":59,"s-c":55,"s-g":73,"s-s":37,"s-w":71,t:54,v:58};q=q.split(/\s+/);var F=q[1].replace(/[=_^]/,"");this.do_pscom("map MIDIdrum "+q[1]+" play="+function(q){var u;if(/^[_^]*[A-Ga-g][,']*$/.test(q))return q;var y=Number(q);if(isNaN(y)){q=q.toLowerCase(q);var F=q[0];for(u=0;;){u=q.indexOf("-",u);if(0>u)break;u+=1;F+="-"+q[u]}y=x[F];if(!y){switch(q[0]){case "c":switch(q[1]){case "a":y=x.ca;break;case "l":y=x.cl;break;case "o":y=x.co}break;case "h":case "l":if(u=q.indexOf("-"),"t"==q[u+1])switch(q[u+
2]){case "i":case "o":y=x[F+q[u+2]]}}if(!y)return}}for(q="C ^C D _E E F ^F G ^G A _B B".split(" ")[y%12];60>y;)q+=",",y+=12;for(;72<=y;)q+="'",y-=12;return q}(q[2])+" print="+F+(q[3]?" heads="+q[3]:""));this.set_v_param("perc","MIDIdrum")},set_perc:function(q){var x,F=this.get_curvoice();for(x=0;x<q.length;x++)switch(q[x]){case "perc=":F.map||(F.map={}),F.map=q[x+1],F.midictl||(F.midictl=[]),F.midictl[0]=1}},do_pscom:function(q,x){"percmap "==x.slice(0,8)?abc2svg.perc.do_perc.call(this,x):q(x)},set_vp:function(q,
x){abc2svg.perc.set_perc.call(this,x);q(x)},set_hooks:function(q){q.do_pscom=abc2svg.perc.do_pscom.bind(q,q.do_pscom);q.set_vp=abc2svg.perc.set_vp.bind(q,q.set_vp)}};abc2svg.modules.hooks.push(abc2svg.perc.set_hooks);abc2svg.modules.percmap.loaded=!0;
abc2svg.pedline={draw_all_deco:function(q){var x,F=this.a_de();if(F.length){if(this.cfmt().pedline)for(x=0;x<F.length;x++){var u=F[x];"ped)"==u.dd.name&&(u.prev&&"ped)"==u.prev.dd.name?(u.defl.nost=!0,u.prev.defl.noen=!0,u.x=u.prev.s.x-5,u.val=u.s.x-u.x-5,u.prev.prev||(u.prev.val=u.x-u.prev.x)):(u.x-=3,u.val+=10))}q()}},out_lped:function(q,x,F,u,O){this.cfmt().pedline?(this.xypath(x,F+16),O.nost?(this.out_svg("l2.5 6"),u-=2.5):this.out_svg("v6"),O.noen?this.out_svg("h"+(u-2.5).toFixed(1)+'l2.5 -6"/>\n'):
this.out_svg("h"+u.toFixed(1)+'v-6"/>\n')):q(x,F,u,O)},set_fmt:function(q,x,F){"pedline"==x?this.cfmt().pedline=F:q(x,F)},set_hooks:function(q){q.draw_all_deco=abc2svg.pedline.draw_all_deco.bind(q,q.draw_all_deco);q.out_lped=abc2svg.pedline.out_lped.bind(q,q.out_lped);q.set_format=abc2svg.pedline.set_fmt.bind(q,q.set_format)}};abc2svg.modules.hooks.push(abc2svg.pedline.set_hooks);abc2svg.modules.pedline.loaded=!0;
